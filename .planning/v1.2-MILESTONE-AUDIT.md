---
milestone: v1.2
audited: 2026-02-21T00:00:00Z
status: gaps_found
scores:
  requirements: 4/12
  phases: 1/3
  integration: 2/6
  flows: 1/5
gaps:
  requirements:
    - id: "PANEL-01"
      status: "unsatisfied"
      phase: "12-steering-panel-frontend"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 12 has no directory. SettingsPage.tsx shows system info only — no toggle switches for HyDE or feedback flags."
    - id: "PANEL-02"
      status: "unsatisfied"
      phase: "12-steering-panel-frontend"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "No adminPost('/settings') call exists anywhere in frontend/src/. Phase 12 not built."
    - id: "PANEL-03"
      status: "unsatisfied"
      phase: "12-steering-panel-frontend"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "No threshold inputs (similarity threshold, HyDE sensitivity, feedback boost cap) exist anywhere in admin UI."
    - id: "PANEL-04"
      status: "unsatisfied"
      phase: "12-steering-panel-frontend"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "No POST call to /api/admin/settings from frontend, no inline success/error feedback pattern."
    - id: "LAB-01"
      status: "unsatisfied"
      phase: "13-search-lab-ab-comparison"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "SearchLabPage.tsx is single-run only. No Compare mode, no multi-configuration logic."
    - id: "LAB-02"
      status: "unsatisfied"
      phase: "13-search-lab-ab-comparison"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "SearchLabPage.tsx shows single result block. No side-by-side column layout."
    - id: "LAB-03"
      status: "unsatisfied"
      phase: "13-search-lab-ab-comparison"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "No diff computation or diff display exists anywhere."
    - id: "LAB-04"
      status: "unsatisfied"
      phase: "13-search-lab-ab-comparison"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "POST /api/chat has no override_flags param. Frontend sends {email, query} only. get_settings(db) always reads DB — no override path in backend."
  integration:
    - from: "frontend (Phase 12)"
      to: "GET /api/admin/settings"
      issue: "Endpoint is orphaned — no frontend consumer. adminFetch('/settings') is never called."
      requirements_affected: ["PANEL-01", "PANEL-03"]
    - from: "frontend (Phase 12)"
      to: "POST /api/admin/settings"
      issue: "Endpoint is orphaned — no adminPost('/settings') call exists in frontend/src/."
      requirements_affected: ["PANEL-02", "PANEL-04"]
    - from: "IntelligenceDashboardPage.tsx"
      to: "GET /api/admin/intelligence-stats"
      issue: "Pre-existing: intelligence-stats endpoint reads flags from os.getenv() not get_settings(db). Flag pills will show env-var state even after Phase 12 writes DB overrides."
      requirements_affected: ["PANEL-01"]
    - from: "SearchLabPage.tsx (Phase 13)"
      to: "POST /api/chat (multi-config)"
      issue: "POST /api/chat has no override_flags param. Per-run override requires backend changes."
      requirements_affected: ["LAB-04"]
  flows:
    - flow: "Admin flips HyDE/feedback toggle"
      breaks_at: "Step 2 — SettingsPage.tsx shows system info only, no toggle switches"
      requirements_affected: ["PANEL-01", "PANEL-02"]
    - flow: "Admin edits threshold inputs"
      breaks_at: "Step 2 — no numeric threshold inputs in any admin page"
      requirements_affected: ["PANEL-03", "PANEL-04"]
    - flow: "A/B comparison run"
      breaks_at: "Step 2 — SearchLabPage.tsx has no Compare mode selector"
      requirements_affected: ["LAB-01", "LAB-02", "LAB-03"]
    - flow: "Per-run override without changing global settings"
      breaks_at: "Step 2 — no override UI in Search Lab; backend has no override param"
      requirements_affected: ["LAB-04"]
tech_debt:
  - phase: "10-search-intelligence-layer"
    items:
      - "GET /api/admin/intelligence-stats reads QUERY_EXPANSION_ENABLED and FEEDBACK_LEARNING_ENABLED from os.getenv() instead of get_settings(db). Will show stale env-var state after Phase 12 activates DB overrides. Needs fix in Phase 12."
  - phase: "11-backend-settings-api"
    items:
      - "Human verification deferred: end-to-end flag-to-behavior test (POST a flag change, send a weak chat query, confirm HyDE triggers in structured log) requires a live Railway server with FAISS loaded."
---

# Milestone v1.2 Audit Report — Intelligence Activation & Steering Panel

**Audited:** 2026-02-21
**Status:** ⚠ GAPS FOUND
**Requirements:** 4/12 satisfied
**Phases complete:** 1/3 (Phase 11 only)

---

## Scope

v1.2 milestone phases:
- Phase 11: Backend Settings API (Phases 11) — **COMPLETE** ✓
- Phase 12: Steering Panel Frontend — **NOT BUILT** ✗
- Phase 13: Search Lab A/B Comparison — **NOT BUILT** ✗

Requirements: CONF-01 to CONF-04 (Phase 11), PANEL-01 to PANEL-04 (Phase 12), LAB-01 to LAB-04 (Phase 13)

---

## Phase Verification Summary

| Phase | Status | Must-Haves | Requirements |
|-------|--------|------------|--------------|
| 11: Backend Settings API | ✓ PASSED | 8/8 | CONF-01–04 all satisfied |
| 12: Steering Panel Frontend | ✗ UNVERIFIED | — | PANEL-01–04 unsatisfied (phase not built) |
| 13: Search Lab A/B | ✗ UNVERIFIED | — | LAB-01–04 unsatisfied (phase not built) |

---

## Requirements Coverage

| Requirement | Phase | Description | Status | Evidence |
|-------------|-------|-------------|--------|----------|
| CONF-01 | 11 | Backend reads QUERY_EXPANSION_ENABLED and FEEDBACK_LEARNING_ENABLED from settings table | ✓ SATISFIED | `get_settings(db)` in `search_intelligence.py:47`; called per-request at line 138 |
| CONF-02 | 11 | Backend reads SIMILARITY_THRESHOLD, STRONG_RESULT_MIN, FEEDBACK_BOOST_CAP from settings table | ✓ SATISFIED | All 3 keys in `get_settings(db)` return dict; passed as params to `_is_weak_query()` and `_apply_feedback_boost()` |
| CONF-03 | 11 | GET /api/admin/settings returns all current values labeled by source | ✓ SATISFIED | `@router.get("/settings")` at `admin.py:1080`; source is "db" / "env" / "default" |
| CONF-04 | 11 | POST /api/admin/settings writes to settings table (admin-auth required) | ✓ SATISFIED | `@router.post("/settings")` at `admin.py:1114`; mounted on `router` with `_require_admin` dep |
| PANEL-01 | 12 | Admin Intelligence tab shows HyDE/feedback flags as live toggle switches | ✗ UNSATISFIED | Phase 12 not built. SettingsPage.tsx shows system info only — no toggle switches. |
| PANEL-02 | 12 | Admin can flip toggle; change persists to DB, takes effect next request | ✗ UNSATISFIED | No `adminPost('/settings')` call exists in frontend/src/. Backend POST endpoint orphaned. |
| PANEL-03 | 12 | Admin Intelligence tab shows editable threshold inputs | ✗ UNSATISFIED | No numeric threshold inputs exist anywhere in admin UI. |
| PANEL-04 | 12 | Admin saves threshold changes; UI shows inline success/error without page reload | ✗ UNSATISFIED | No POST call, no success/error feedback pattern exists. |
| LAB-01 | 13 | Search Lab Compare mode runs query in up to 4 configurations simultaneously | ✗ UNSATISFIED | SearchLabPage.tsx is single-run only. No mode selector or multi-config logic. |
| LAB-02 | 13 | A/B results as side-by-side columns per mode | ✗ UNSATISFIED | Single result block only in SearchLabPage.tsx. No column layout. |
| LAB-03 | 13 | Diff view highlights rank changes, new/dropped experts | ✗ UNSATISFIED | No diff computation or diff display exists anywhere. |
| LAB-04 | 13 | Per-run flag overrides without changing global settings | ✗ UNSATISFIED | POST /api/chat has no override param. get_settings(db) always reads DB. No override path. |

---

## Cross-Phase Integration

### What Phase 11 Provides (Foundation Ready)

Phase 11 built a solid foundation that Phases 12 and 13 can immediately build on:

- **`GET /api/admin/settings`** — returns all 5 settings with `value`, `source` ("db"/"env"/"default"), `type`, `description`. Ready for Phase 12 to call on mount.
- **`POST /api/admin/settings`** — validated upsert. Returns updated setting. HTTP 400 on bad input. Ready for Phase 12 toggle/save interactions.
- **`adminFetch` and `adminPost`** — already in `useAdminData.ts:17-48`, auto-attaching `X-Admin-Key`. Phase 12 needs only `adminFetch('/settings')` and `adminPost('/settings', body)`.
- **Instant propagation** — `get_settings(db)` is called fresh on every `retrieve_with_intelligence()` invocation. No polling needed.

### Integration Gaps

| From | To | Issue | Requirements |
|------|----|-------|-------------|
| frontend (Phase 12) | GET /api/admin/settings | Orphaned — `adminFetch('/settings')` never called anywhere | PANEL-01, PANEL-03 |
| frontend (Phase 12) | POST /api/admin/settings | Orphaned — `adminPost('/settings')` never called anywhere | PANEL-02, PANEL-04 |
| IntelligenceDashboardPage | intelligence-stats endpoint | **Pre-existing tech debt:** stats reads flags from `os.getenv()`, not `get_settings(db)`. Flag pills will show env-var state even after Phase 12 writes DB overrides. Phase 12 must fix this. | PANEL-01 |
| SearchLabPage (Phase 13) | POST /api/chat | No `override_flags` param on chat endpoint. Per-run overrides require backend addition. | LAB-04 |

---

## Broken E2E Flows

### Flow 1: Admin flips HyDE/feedback toggle
```
Step 1: Admin navigates to /admin/settings          ✓ Route exists
Step 2: Steering panel renders toggle switches      ✗ BROKEN — SettingsPage.tsx shows system info
Step 3: Toggle click calls POST /api/admin/settings ✗ MISSING — no adminPost('/settings') in frontend
Step 4: DB row written, source becomes "db"         ✓ Backend ready
Step 5: Next chat request picks up new flag value   ✓ Backend ready
```
**Requirements affected:** PANEL-01, PANEL-02

### Flow 2: Admin edits threshold inputs
```
Step 1: Admin navigates to /admin/settings          ✓ Route exists
Step 2: Threshold inputs render with current values ✗ BROKEN — no numeric inputs in any admin page
Step 3: Admin saves, POST /api/admin/settings fires ✗ MISSING
Step 4: Inline success/error shown                  ✗ MISSING
Step 5: Backend uses new threshold next request     ✓ Backend ready
```
**Requirements affected:** PANEL-03, PANEL-04

### Flow 3: A/B comparison run
```
Step 1: Admin navigates to /admin/search-lab        ✓ Route exists
Step 2: Admin selects Compare mode, 4 configs       ✗ BROKEN — no mode selector in SearchLabPage.tsx
Step 3: Multiple API calls with different flags     ✗ BROKEN — single fetch only
Step 4: Results render as side-by-side columns      ✗ BROKEN — single result block only
Step 5: Diff view highlights rank changes           ✗ BROKEN — no diff logic
```
**Requirements affected:** LAB-01, LAB-02, LAB-03

### Flow 4: Per-run override without changing global settings
```
Step 1: Admin enters query in Search Lab            ✓ Input exists
Step 2: Admin sets per-run override flags           ✗ BROKEN — no override UI
Step 3: Request includes override flags to backend  ✗ BROKEN — POST /api/chat sends {email, query} only
Step 4: Backend applies overrides without DB write  ✗ BROKEN — no override path in get_settings(db)
Step 5: Global settings unchanged after run         ✗ N/A — mechanism absent
```
**Requirements affected:** LAB-04

---

## Tech Debt

### Phase 10 (Pre-existing, surfaces in Phase 12)
- `GET /api/admin/intelligence-stats` reads `QUERY_EXPANSION_ENABLED` and `FEEDBACK_LEARNING_ENABLED` from `os.getenv()` (admin.py lines 287–288), not from `get_settings(db)`. Phase 12 must update this to use the DB-backed settings, or the Intelligence Dashboard flag pills will contradict actual runtime state after a DB override is set.

### Phase 11 (Human verification deferred)
- End-to-end flag-to-behavior test (POST a flag change, send a weak chat query, confirm HyDE triggers in structured log) requires a live server with FAISS loaded. Not testable from static code.

---

## Conclusion

Phase 11 (Backend Settings API) is fully complete and verified — the DB-backed runtime settings layer works correctly. The two remaining phases (12 and 13) are entirely unbuilt. 8 of 12 milestone requirements are unsatisfied.

**Recommended next step:** Plan and execute Phase 12 (Steering Panel Frontend) and Phase 13 (Search Lab A/B Comparison) to complete the milestone.

---

_Audit generated: 2026-02-21_
_Auditor: Claude (gsd audit-milestone workflow)_
