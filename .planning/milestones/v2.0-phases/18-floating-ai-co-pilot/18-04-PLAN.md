---
phase: 18-floating-ai-co-pilot
plan: "04"
type: execute
wave: 4
depends_on: ["18-03"]
files_modified: []
autonomous: false
requirements: [PILOT-01, PILOT-02, PILOT-03]

must_haves:
  truths:
    - "FAB is visible in bottom-right corner at all times while panel is closed"
    - "Clicking FAB opens the Sage panel (slides in from right on desktop, full-screen on mobile)"
    - "Typing a natural language request and submitting updates the expert grid filters"
    - "Sage's response confirms what was found with a friendly message"
    - "Conversation history persists when closing and reopening the panel within the same session"
    - "Clicking outside the panel on mobile closes it"
    - "EmptyState CTA opens Sage panel"
  artifacts:
    - path: "frontend/src/components/pilot/SageFAB.tsx"
      provides: "Verified: FAB visible and opens panel"
    - path: "frontend/src/components/pilot/SagePanel.tsx"
      provides: "Verified: slide-in panel, conversation, filter updates"
    - path: "frontend/src/pages/MarketplacePage.tsx"
      provides: "Verified: FAB + panel integrated correctly"
  key_links:
    - from: "SageFAB click"
      to: "SagePanel open"
      via: "setOpen(true) in pilotSlice"
      pattern: "setOpen"
---

<objective>
Human verification of the complete Sage co-pilot — FAB visibility, panel animation, conversation flow, filter dispatch, mobile behavior.

Purpose: The co-pilot is the primary conversational UX of Phase 18. Visual correctness, animation feel, filter dispatch behavior, and mobile full-screen mode must be confirmed before Phase 19 builds lead capture on top.

Output: Human-approved Sage co-pilot ready for Phase 19.
</objective>

<execution_context>
@/Users/sebastianhamers/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sebastianhamers/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/phases/18-floating-ai-co-pilot/18-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Confirm build is clean and dev servers are running</name>
  <files></files>
  <action>
Confirm build is clean and both dev servers are accessible:
- npm run build from frontend/ — must exit 0
- curl -s http://localhost:8000/api/health — must return {"status":"ok",...}
- curl -s http://localhost:8000/api/pilot -X POST -H "Content-Type: application/json" -d '{"message":"hello","history":[],"current_filters":{}}' — must return JSON with "message" field
- Frontend dev server at http://localhost:5173 should be accessible

If backend is not running, start it: uvicorn app.main:app --reload --port 8000 (run in background)
If frontend dev server is not running, start it: from frontend/ run npm run dev (run in background)
  </action>
  <verify>
    npm run build exits 0 with no TypeScript errors.
    curl http://localhost:8000/api/health returns JSON.
    curl POST /api/pilot returns JSON with "message" field.
    Frontend accessible at http://localhost:5173.
  </verify>
  <done>Both servers running, pilot endpoint callable, build clean.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Human verify — Sage co-pilot visual and behavioral correctness</name>
  <action>
Present the verification checklist to the user and pause for their response.
  </action>
  <what-built>
    Complete Phase 18 Sage co-pilot: floating action button (bottom-right, brand-purple "S" mark), slide-in conversation panel (380px desktop / full-screen mobile), two-turn Gemini function calling backend, Zustand filter dispatch, first-visit tooltip, typing indicator, conversation persistence, mobile backdrop, and EmptyState CTA wiring.
  </what-built>
  <how-to-verify>
    Open http://localhost:5173 in browser.

    1. FAB VISIBILITY: Confirm a brand-purple circle button with "S" is visible in the bottom-right corner at all times while browsing. On first load, a tooltip saying "Try the AI assistant" should appear briefly (~4s) then dismiss.

    2. PANEL OPEN/CLOSE: Click the FAB. Confirm: (a) FAB disappears, (b) a panel slides in from the right, (c) on desktop it's 380px wide and doesn't cover the full grid, (d) panel shows Sage's greeting message and an input at the bottom.

    3. MOBILE BEHAVIOR: Resize browser to mobile width (<768px). Click FAB. Confirm panel is full-screen. Confirm clicking outside (tap the dark backdrop) closes the panel.

    4. FILTER DISPATCH — basic: Type "show marketing experts" and press Enter. Confirm: (a) your message appears as a purple bubble on the right, (b) typing indicator (3 dots) appears briefly, (c) Sage responds with a friendly message, (d) the expert grid updates to reflect the applied filters (sidebar filters may update visibly).

    5. FILTER DISPATCH — rate filter: Type "under 100 per hour" (follow-up after marketing query). Confirm: (a) Sage responds confirming the rate filter, (b) results update without resetting the marketing query — filters layer (follow-up behavior).

    6. RESET: Type "show everyone" or "start over". Confirm all filters clear and the full expert pool is shown again.

    7. CONVERSATION PERSISTENCE: Close the panel (X button). Reopen the FAB. Confirm your conversation history is still there from before (session persistence via pilotSlice — not localStorage).

    8. EMPTY STATE CTA: Apply a very specific filter (rate max = 10) to trigger the empty state. Confirm the "Try the AI Co-Pilot" button is visible. Click it — confirm Sage panel opens.

    9. AMBIGUOUS REQUEST: Type something vague like "I need help". Confirm Sage asks a clarifying question rather than applying random filters.
  </how-to-verify>
  <verify>Human responds "approved" or describes issues.</verify>
  <done>User types "approved" confirming all 9 checks pass.</done>
  <resume-signal>Type "approved" if all 9 checks pass, or describe any issues with the check number (e.g. "check 4 fails — grid doesn't update after Sage responds").</resume-signal>
</task>

</tasks>

<verification>
Human has confirmed all 9 visual and behavioral checks pass.
</verification>

<success_criteria>
- FAB visible at all times, first-visit tooltip works
- Panel opens with slide-in animation, FAB hides
- Mobile: full-screen panel, backdrop click closes
- Filter requests update the grid (Gemini function calling working end-to-end)
- Follow-up messages layer on existing filters (conversation context maintained)
- Reset clears all filters
- Conversation persists on panel reopen within session
- EmptyState CTA opens Sage
- Ambiguous requests trigger clarification (not random filter application)
</success_criteria>

<output>
After completion, create `.planning/phases/18-floating-ai-co-pilot/18-04-SUMMARY.md`
</output>
