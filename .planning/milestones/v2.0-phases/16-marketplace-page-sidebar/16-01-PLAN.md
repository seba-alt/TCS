---
phase: 16-marketplace-page-sidebar
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/hooks/useExplore.ts
  - frontend/src/components/sidebar/SearchInput.tsx
  - frontend/src/components/sidebar/RateSlider.tsx
  - frontend/src/components/sidebar/TagMultiSelect.tsx
autonomous: true
requirements: [MARKET-01]

must_haves:
  truths:
    - "useExplore hook fires a fetch to /api/explore whenever filter state changes and cancels in-flight requests"
    - "SearchInput debounces at 350ms and triggers immediately on Enter key"
    - "RateSlider uses onValueCommit (fires on release only) and shows local display values during drag"
    - "TagMultiSelect renders top-30 pills with inline search; selected pills are visually distinct"
  artifacts:
    - path: "frontend/src/hooks/useExplore.ts"
      provides: "AbortController fetch hook reading from Zustand store, writing results/loading/error back to store"
      exports: ["useExplore"]
    - path: "frontend/src/components/sidebar/SearchInput.tsx"
      provides: "Debounced text search input with Enter key shortcut"
      exports: ["SearchInput"]
    - path: "frontend/src/components/sidebar/RateSlider.tsx"
      provides: "Dual-handle @radix-ui/react-slider with on-release commit"
      exports: ["RateSlider"]
    - path: "frontend/src/components/sidebar/TagMultiSelect.tsx"
      provides: "Scrollable pill list with inline tag search, wired to toggleTag"
      exports: ["TagMultiSelect"]
  key_links:
    - from: "frontend/src/hooks/useExplore.ts"
      to: "/api/explore"
      via: "fetch with AbortController signal"
      pattern: "fetch.*api/explore.*signal"
    - from: "frontend/src/hooks/useExplore.ts"
      to: "frontend/src/store/index.ts"
      via: "useExplorerStore selectors for query/rateMin/rateMax/tags/setLoading/setResults/setError"
      pattern: "useExplorerStore"
    - from: "frontend/src/components/sidebar/RateSlider.tsx"
      to: "frontend/src/store/filterSlice.ts"
      via: "setRateRange called in onValueCommit only"
      pattern: "onValueCommit.*setRateRange"
    - from: "frontend/src/components/sidebar/SearchInput.tsx"
      to: "frontend/src/store/filterSlice.ts"
      via: "setQuery called after 350ms debounce or on Enter"
      pattern: "setQuery"
---

<objective>
Install new dependencies and build the data-fetching hook plus three leaf sidebar filter components. These are the foundational pieces Plan 02 assembles into the full layout.

Purpose: Establish the fetch/state bridge (useExplore) and the three reusable filter input widgets before composing them into the sidebar shell.
Output: useExplore hook, SearchInput, RateSlider, TagMultiSelect components — all ready for import.
</objective>

<execution_context>
@/Users/sebastianhamers/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sebastianhamers/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-marketplace-page-sidebar/16-RESEARCH.md
@.planning/phases/15-zustand-state-and-routing/15-01-SUMMARY.md
@frontend/src/store/index.ts
@frontend/src/store/filterSlice.ts
@frontend/src/store/resultsSlice.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies and create useExplore fetch hook</name>
  <files>frontend/src/hooks/useExplore.ts</files>
  <action>
    Install dependencies from the frontend directory:
    ```
    cd frontend && npm install @radix-ui/react-slider vaul lucide-react
    ```

    Create `frontend/src/hooks/useExplore.ts`. This hook:
    - Reads `query`, `rateMin`, `rateMax`, `tags`, `sortBy` individually from `useExplorerStore` (individual selectors — NOT useShallow — to avoid the tags array identity pitfall documented in RESEARCH.md Pitfall 4)
    - Reads `setLoading`, `setResults`, `setError`, `resetResults` individually from `useExplorerStore` (Zustand actions are referentially stable, safe in dep array)
    - Uses a `useRef<AbortController | null>` to cancel in-flight requests
    - On each effect run: aborts any previous controller, creates a new one, builds URLSearchParams with `{ query, rate_min: String(rateMin), rate_max: String(rateMax), tags: tags.join(','), limit: '20', cursor: '0' }`, calls `setLoading(true)` and `setError(null)`, then fetches `${API_BASE}/api/explore?${params}` with `{ signal: controller.signal }`
    - On success: calls `setResults(data.experts, data.total, data.cursor)` then `setLoading(false)`
    - On AbortError: silently returns (not an error) — do NOT call `setLoading(false)` on abort (the next fetch will manage loading state)
    - On other errors: calls `setError(err.message ?? 'Fetch failed')`, `resetResults()`, then `setLoading(false)`
    - Cleanup: `return () => controller.abort()`
    - `API_BASE` = `import.meta.env.VITE_API_URL ?? ''`
    - dep array: `[query, rateMin, rateMax, tags, sortBy, setLoading, setResults, setError, resetResults]`
    - Export: `export function useExplore() { ... }` (no return value — side-effect only)

    Note: `sortBy` is in the dep array even though `/api/explore` does not currently have a sort param — including it ensures the hook re-fetches if sort is added later and avoids a stale-closure bug.
  </action>
  <verify>
    Run `cd frontend && npx tsc --noEmit` — must produce no TypeScript errors in useExplore.ts.
    Confirm `frontend/node_modules/@radix-ui/react-slider`, `frontend/node_modules/vaul`, `frontend/node_modules/lucide-react` directories exist.
  </verify>
  <done>useExplore.ts compiles cleanly. All three new packages are installed in frontend/node_modules.</done>
</task>

<task type="auto">
  <name>Task 2: Create leaf sidebar filter components (SearchInput, RateSlider, TagMultiSelect)</name>
  <files>
    frontend/src/components/sidebar/SearchInput.tsx
    frontend/src/components/sidebar/RateSlider.tsx
    frontend/src/components/sidebar/TagMultiSelect.tsx
  </files>
  <action>
    Create `frontend/src/components/sidebar/` directory (mkdir -p if needed).

    **SearchInput.tsx** — implement exactly as specified in RESEARCH.md Pattern 3:
    - Controlled input with local `localValue` state, synced from `query` via `useEffect([query])`
    - `DEBOUNCE_MS = 350`; `timerRef = useRef<ReturnType<typeof setTimeout> | null>(null)`
    - `handleChange`: updates `localValue`, clears timer, sets new timeout calling `setQuery(value)`
    - `handleKeyDown`: on Enter, clears timer and calls `setQuery(localValue)` immediately
    - Cleanup effect clears timer on unmount
    - Import `{ useFilterSlice }` from `'../../store'`
    - Tailwind: `w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-1 focus:ring-brand-purple focus:border-brand-purple`; add `placeholder="Search experts..."` and `type="search"`

    **RateSlider.tsx** — implement exactly as RESEARCH.md Pattern 2:
    - Import `* as Slider from '@radix-ui/react-slider'`
    - Import `{ useFilterSlice }` from `'../../store'`
    - Local `localValue` state initialized to `[rateMin, rateMax]`, synced from store via `useEffect([rateMin, rateMax])`
    - `onValueChange={setLocalValue}` (display only during drag)
    - `onValueCommit={(val) => setRateRange(val[0], val[1])}` (triggers fetch on release)
    - Props: `min={0}`, `max={2000}`, `step={10}`, `minStepsBetweenThumbs={1}`
    - Two `<Slider.Thumb>` elements
    - Display: `EUR {localValue[0]}` and `EUR {localValue[1]}` above the slider
    - Tailwind: track `bg-gray-200 relative grow rounded-full h-1`, range `absolute bg-brand-purple rounded-full h-full`, thumb `block w-4 h-4 bg-white border-2 border-brand-purple rounded-full shadow focus:outline-none`
    - Note: `filterSlice.ts` has `rateMax: 5000` as default (not 2000 from research). Keep slider `max={2000}` per RESEARCH — the store can hold 5000 but the slider visual cap is 2000 per the API rate data bounds (max real rate is 2000 EUR).

    **TagMultiSelect.tsx** — implement as RESEARCH.md Pattern 4:
    - Import `{ useFilterSlice }` from `'../../store'`
    - Hardcode `TOP_TAGS` array with exactly these 30 tags (in order from RESEARCH.md): `'fundraising', 'real estate', 'entrepreneurship', 'digital marketing', 'marketing strategy', 'saas', 'digital transformation', 'go-to-market strategy', 'brand strategy', 'venture capital', 'artificial intelligence', 'supply chain', 'business development', 'private equity', 'change management', 'business scaling', 'sales strategy', 'mergers & acquisitions', 'web development', 'product development', 'e-commerce', 'ai strategy', 'corporate finance', 'event management', 'growth marketing', 'process optimization', 'startup scaling', 'commercial strategy', 'leadership coaching', 'financial planning'`
    - Local `search` state for the inline filter input
    - `filtered = TOP_TAGS.filter(t => t.includes(search.toLowerCase()))`
    - Inline search: `type="text"`, `placeholder="Filter tags..."`, `className="text-xs border border-gray-200 rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-brand-purple"`
    - Pills: `flex flex-wrap gap-1.5 max-h-48 overflow-y-auto` — selected = `bg-brand-purple text-white border-brand-purple`, unselected = `bg-white text-gray-600 border-gray-300 hover:border-brand-purple`
    - Each pill: `text-xs px-2 py-1 rounded-full border transition-colors`
    - `onClick={() => toggleTag(tag)}`
  </action>
  <verify>
    Run `cd frontend && npx tsc --noEmit` — must produce no TypeScript errors across all three new files.
    Confirm all three files exist: `frontend/src/components/sidebar/SearchInput.tsx`, `frontend/src/components/sidebar/RateSlider.tsx`, `frontend/src/components/sidebar/TagMultiSelect.tsx`.
  </verify>
  <done>All three components compile cleanly. Each is wired to useFilterSlice actions and renders correctly per the pattern. No TypeScript errors.</done>
</task>

</tasks>

<verification>
- `cd frontend && npx tsc --noEmit` passes with zero errors
- `frontend/src/hooks/useExplore.ts` exists and exports `useExplore`
- `frontend/src/components/sidebar/SearchInput.tsx`, `RateSlider.tsx`, `TagMultiSelect.tsx` all exist
- All three new npm packages installed: `@radix-ui/react-slider`, `vaul`, `lucide-react`
- No `onValueChange` writing to Zustand in RateSlider (only `onValueCommit` does that)
- No debounce on rate slider (on-release via `onValueCommit`)
- `useExplore` dep array includes `tags` as a direct store selector (not via useShallow) to avoid infinite loop
</verification>

<success_criteria>
useExplore hook is wired to the Zustand store and calls /api/explore with AbortController. Three leaf filter components (SearchInput, RateSlider, TagMultiSelect) compile and correctly delegate to Zustand filterSlice actions. Plan 02 can import all four files without modification.
</success_criteria>

<output>
After completion, create `.planning/phases/16-marketplace-page-sidebar/16-01-SUMMARY.md` following the summary template.
</output>
