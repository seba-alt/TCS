---
phase: 50.3-remove-sage-replace-with-intercom
plan: "03"
subsystem: ui
tags: [react, intercom, react-use-intercom, zustand, vite]

# Dependency graph
requires:
  - phase: 50.3-02
    provides: Sage frontend components removed — no vaul/SageMobileSheet consumers remain
provides:
  - Intercom floating support widget on all public pages via react-use-intercom
  - IntercomProvider wrapping public RootLayout route only (admin excluded)
  - IntercomIdentity component linking user email to Intercom session identity
  - vaul dependency fully removed from package.json
affects: [deployment, frontend-public, intercom-support]

# Tech tracking
tech-stack:
  added: [react-use-intercom]
  patterns:
    - "IntercomProvider wraps public route element in createBrowserRouter config — admin routes excluded structurally"
    - "Side-effect null-render component pattern for Intercom identity (IntercomIdentity.tsx)"
    - "Email from useNltrStore drives Intercom update() call — anonymous users gracefully excluded"

key-files:
  created:
    - frontend/src/components/IntercomIdentity.tsx
  modified:
    - frontend/src/main.tsx
    - frontend/src/layouts/RootLayout.tsx
    - frontend/package.json
    - frontend/package-lock.json
    - frontend/.env.example

key-decisions:
  - "Intercom app ID o9v3tocw hardcoded as fallback — VITE_INTERCOM_APP_ID env var optional"
  - "autoBoot=true on IntercomProvider — no manual boot() call needed"
  - "IntercomIdentity rendered in RootLayout (inside provider) — structurally ensures admin never gets Intercom"
  - "vaul uninstalled after confirming zero consumers following 50.3-02 deletion of SageMobileSheet.tsx"

patterns-established:
  - "Side-effect null component pattern: component reads store, calls external SDK, returns null"
  - "Route-level provider scoping: wrap provider around specific route element, not app root"

requirements-completed:
  - SAGE-REMOVE

# Metrics
duration: 2min
completed: 2026-03-02
---

# Phase 50.3 Plan 03: Intercom Integration Summary

**Intercom floating widget on public pages via react-use-intercom with IntercomProvider scoped to public routes and email identity linking from useNltrStore**

## Performance

- **Duration:** 2 min
- **Started:** 2026-03-02T13:30:17Z
- **Completed:** 2026-03-02T13:32:08Z
- **Tasks:** 2
- **Files modified:** 6

## Accomplishments

- Installed react-use-intercom, uninstalled vaul (zero consumers confirmed after 50.3-02)
- Wrapped public RootLayout with IntercomProvider (appId o9v3tocw, autoBoot) — admin routes structurally excluded
- Created IntercomIdentity component: reads email from useNltrStore, calls update({ email }) for identity linking
- Frontend production build succeeds with zero TypeScript errors

## Task Commits

Each task was committed atomically:

1. **Task 1: Install react-use-intercom, uninstall vaul, add IntercomProvider** - `26d1a17` (feat)
2. **Task 2: Create IntercomIdentity component and wire into RootLayout** - `b43c144` (feat)

**Plan metadata:** (docs commit follows)

## Files Created/Modified

- `frontend/src/components/IntercomIdentity.tsx` - Side-effect component linking user email to Intercom session; reads from useNltrStore, calls useIntercom().update({ email }), returns null
- `frontend/src/main.tsx` - Added IntercomProvider wrapping public RootLayout element; INTERCOM_APP_ID constant with env var fallback
- `frontend/src/layouts/RootLayout.tsx` - Added IntercomIdentity render (null component, no visual impact)
- `frontend/package.json` - react-use-intercom added, vaul removed
- `frontend/package-lock.json` - Updated lockfile
- `frontend/.env.example` - VITE_INTERCOM_APP_ID documented

## Decisions Made

- Intercom app ID o9v3tocw hardcoded as fallback in INTERCOM_APP_ID constant so Intercom works without env var
- autoBoot=true on IntercomProvider so floating bubble appears immediately without a manual boot() call
- IntercomIdentity placed in RootLayout (inside the provider scope) — structurally impossible for admin pages to get it
- vaul uninstalled after grep confirmed zero consumers in src/ following 50.3-02 SageMobileSheet deletion

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None.

## User Setup Required

None - no external service configuration required beyond the Intercom app ID already embedded as fallback (o9v3tocw). Optionally set `VITE_INTERCOM_APP_ID=o9v3tocw` in Vercel environment variables for explicitness.

## Next Phase Readiness

- Phase 50.3 complete: Sage fully removed (backend + frontend), Intercom integrated
- Intercom bubble will appear on public marketplace pages after deployment
- Anonymous users see bubble without errors; email gate completions link identity via IntercomIdentity
- Admin pages (/admin/*) structurally excluded from Intercom via route-level provider scoping

---
*Phase: 50.3-remove-sage-replace-with-intercom*
*Completed: 2026-03-02*

## Self-Check: PASSED

- frontend/src/components/IntercomIdentity.tsx: FOUND
- frontend/src/main.tsx: FOUND
- frontend/src/layouts/RootLayout.tsx: FOUND
- .planning/milestones/v4.0-phases/50.3-remove-sage-replace-with-intercom/50.3-03-SUMMARY.md: FOUND
- Commit 26d1a17: FOUND
- Commit b43c144: FOUND
