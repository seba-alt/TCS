---
phase: 50.3-remove-sage-replace-with-intercom
plan: 02
subsystem: ui
tags: [react, zustand, typescript, sage-removal, admin]

# Dependency graph
requires:
  - phase: 50.3-remove-sage-replace-with-intercom-01
    provides: Backend Sage endpoints and routes removed
provides:
  - Frontend completely free of Sage UI components, store, hooks, and admin views
  - Clean store (filterSlice, resultsSlice) with no sageMode state
  - Clean RootLayout with no Sage FAB/Panel/MobileSheet
  - Admin sidebar without Intelligence nav item
  - Admin Overview without SageSparklineCard
affects: [50.3-03-intercom-integration]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "Zustand store slice without sageMode - filterSlice actions no longer call setSageMode"
    - "useExplore hook without sageMode guard - always fetches marketplace results"

key-files:
  created: []
  modified:
    - frontend/src/layouts/RootLayout.tsx
    - frontend/src/store/index.ts
    - frontend/src/store/resultsSlice.ts
    - frontend/src/store/filterSlice.ts
    - frontend/src/tracking.ts
    - frontend/src/components/marketplace/FilterChips.tsx
    - frontend/src/components/marketplace/EmptyState.tsx
    - frontend/src/components/Header.tsx
    - frontend/src/components/sidebar/RateSlider.tsx
    - frontend/src/components/marketplace/ExpertCard.tsx
    - frontend/src/hooks/useExplore.ts
    - frontend/src/hooks/useHeaderSearch.ts
    - frontend/src/admin/components/AdminSidebar.tsx
    - frontend/src/admin/pages/OverviewPage.tsx
    - frontend/src/admin/pages/AdminMarketplacePage.tsx
    - frontend/src/admin/hooks/useAdminData.ts
    - frontend/src/admin/types.ts
    - frontend/src/main.tsx
    - frontend/src/pages/MarketplacePage.tsx

key-decisions:
  - "Kept DailyTrendRow and MarketplaceTrendResponse types — still used by AdminMarketplacePage TrendSection via useMarketplaceTrend"
  - "Kept row.source === sage data labels in admin tables — backend API field names, not UI components"
  - "Updated search bar icon/placeholder positions after removing Sage in-flight pulse dot"
  - "context prop in ExpertCard renamed from sage_panel to chat_panel — neutral term"

patterns-established:
  - "No sageMode in store — filterSlice actions commit directly without clearing sage state"

requirements-completed: [SAGE-REMOVE]

# Metrics
duration: 8min
completed: 2026-03-02
---

# Phase 50.3 Plan 02: Remove Sage Frontend Code Summary

**Deleted all 8 Sage-specific frontend files and stripped every Sage reference from shared components, store, tracking, admin pages, and admin types — frontend TypeScript compiles and builds cleanly.**

## Performance

- **Duration:** 8 min
- **Started:** 2026-03-02T13:19:40Z
- **Completed:** 2026-03-02T13:27:32Z
- **Tasks:** 2
- **Files modified:** 19 modified, 9 deleted

## Accomplishments
- Deleted 8 Sage-only files: pilot/ directory (5 components), useSage.ts, pilotSlice.ts, IntelligenceDashboardPage.tsx
- Cleaned 13 shared files: store slices, tracking, layout, UI components, admin sidebar/overview/marketplace/hooks/types/router
- TypeScript compiles with zero errors; production build succeeds (9.27s)
- Admin Intelligence Dashboard route and nav item removed; Intelligence admin types removed
- SageSparklineCard removed from OverviewPage; useMarketplaceTrend also removed from Overview imports

## Task Commits

Each task was committed atomically:

1. **Task 1: Delete Sage-specific files and clean shared store/tracking** - `e3d3270` (feat)
2. **Task 2: Remove Intelligence Dashboard and clean admin pages** - `9b64410` (feat)

**Plan metadata:** _(docs commit follows)_

## Files Created/Modified

**Deleted:**
- `frontend/src/components/pilot/SageFAB.tsx` - Sage floating action button
- `frontend/src/components/pilot/SagePanel.tsx` - Desktop Sage side panel
- `frontend/src/components/pilot/SageMobileSheet.tsx` - Mobile Sage bottom sheet
- `frontend/src/components/pilot/SageInput.tsx` - Sage chat input
- `frontend/src/components/pilot/SageMessage.tsx` - Sage message bubble
- `frontend/src/hooks/useSage.ts` - Sage conversation hook
- `frontend/src/store/pilotSlice.ts` - Sage Zustand slice (isOpen, messages, streaming)
- `frontend/src/admin/pages/IntelligenceDashboardPage.tsx` - Admin intelligence page

**Modified:**
- `frontend/src/store/index.ts` - Removed pilotSlice compose, PilotSlice type, usePilotSlice hook
- `frontend/src/store/resultsSlice.ts` - Removed sageMode field and setSageMode action
- `frontend/src/store/filterSlice.ts` - Removed setSageMode() calls from all filter actions
- `frontend/src/tracking.ts` - Removed sage_query from EventType union
- `frontend/src/layouts/RootLayout.tsx` - Stripped to Outlet + Analytics only
- `frontend/src/components/marketplace/FilterChips.tsx` - Removed sageMode icon and condition
- `frontend/src/components/marketplace/EmptyState.tsx` - Removed sageMode branch and Sage CTA
- `frontend/src/components/Header.tsx` - Removed isStreaming pulse dot
- `frontend/src/components/sidebar/RateSlider.tsx` - Removed sageMode confirm dialog
- `frontend/src/components/marketplace/ExpertCard.tsx` - Renamed sage_panel context to chat_panel
- `frontend/src/hooks/useExplore.ts` - Removed sageMode guard
- `frontend/src/hooks/useHeaderSearch.ts` - Removed sageMode and isStreaming
- `frontend/src/admin/components/AdminSidebar.tsx` - Removed Intelligence nav item
- `frontend/src/admin/pages/OverviewPage.tsx` - Removed SageSparklineCard, useMarketplaceTrend import
- `frontend/src/admin/pages/AdminMarketplacePage.tsx` - Updated Sage labels to neutral text
- `frontend/src/admin/hooks/useAdminData.ts` - Removed useIntelligenceStats, useIntelligenceMetrics, useEmbeddingMap hooks
- `frontend/src/admin/types.ts` - Removed IntelligenceDailyRow, IntelligenceStats, IntelligenceMetrics, EmbeddingPoint, EmbeddingMapResponse, EmbeddingMapComputing interfaces
- `frontend/src/main.tsx` - Removed IntelligenceDashboardPage lazy import and /intelligence route
- `frontend/src/pages/MarketplacePage.tsx` - Removed stale Sage comment

## Decisions Made

- Kept `DailyTrendRow` and `MarketplaceTrendResponse` types — still consumed by `AdminMarketplacePage` TrendSection via `useMarketplaceTrend` hook which remains active
- Kept `row.source === 'sage'` data labels in admin tables (SearchesTable, OverviewPage recent activity) — these are backend API field values, not Sage UI. Historical data still references source='sage'
- Updated search bar input padding and icon/placeholder positions after removing the Sage in-flight pulse dot
- `useMarketplaceTrend` hook kept in `useAdminData.ts` since AdminMarketplacePage still uses it for the TrendSection chart

## Deviations from Plan

### Auto-fixed Issues

**1. [Rule 1 - Bug] Removed sageMode guard from useExplore.ts**
- **Found during:** Task 2 (broad Sage reference scan)
- **Issue:** useExplore still selected `s.sageMode` which no longer exists in store, causing TypeScript error
- **Fix:** Removed sageMode selector and the guard block that aborted fetches in sage mode
- **Files modified:** `frontend/src/hooks/useExplore.ts`
- **Verification:** TypeScript passes, no sageMode reference remains
- **Committed in:** 9b64410 (Task 2 commit)

**2. [Rule 1 - Bug] Removed sageMode/isStreaming from useHeaderSearch.ts and Header.tsx**
- **Found during:** Task 2 (broad Sage reference scan)
- **Issue:** useHeaderSearch still selected `s.sageMode` and `s.isStreaming` (pilotSlice fields, now deleted); Header.tsx destructured `isStreaming` for pulse dot animation
- **Fix:** Removed sageMode and isStreaming from useHeaderSearch return, removed pulse dot from Header.tsx, adjusted search bar icon/placeholder positions
- **Files modified:** `frontend/src/hooks/useHeaderSearch.ts`, `frontend/src/components/Header.tsx`
- **Verification:** TypeScript passes, zero Sage references in Header
- **Committed in:** 9b64410 (Task 2 commit)

**3. [Rule 1 - Bug] Removed setSageMode calls from filterSlice.ts**
- **Found during:** Task 2 (broad Sage reference scan)
- **Issue:** filterSlice actions called `get().setSageMode(false)` which no longer exists after resultsSlice cleanup
- **Fix:** Removed all `get().setSageMode(false)` calls from filter actions (setQuery, setRateRange, toggleTag, setTags, toggleIndustryTag, resetIndustryTags, resetFilters)
- **Files modified:** `frontend/src/store/filterSlice.ts`
- **Verification:** TypeScript passes, filterSlice compiles cleanly
- **Committed in:** 9b64410 (Task 2 commit)

**4. [Rule 1 - Bug] Removed sageMode confirm dialog from RateSlider.tsx**
- **Found during:** Task 2 (broad Sage reference scan)
- **Issue:** RateSlider selected `s.sageMode` from store for a "switch to filter mode?" confirmation dialog that no longer makes sense without Sage
- **Fix:** Removed sageMode selector, showSageConfirm state, pendingRange state, and Sage confirm overlay. RateSlider now commits range directly.
- **Files modified:** `frontend/src/components/sidebar/RateSlider.tsx`
- **Verification:** TypeScript passes, RateSlider works without sageMode
- **Committed in:** 9b64410 (Task 2 commit)

---

**Total deviations:** 4 auto-fixed (all Rule 1 bugs — cascading references to deleted Sage store fields)
**Impact on plan:** All auto-fixes necessary for TypeScript correctness. No scope creep — only cleaned code that referenced deleted Sage store fields.

## Issues Encountered
None — TypeScript type system surfaced all cascading Sage references cleanly. All required 4 auto-fix passes.

## User Setup Required
None - no external service configuration required.

## Next Phase Readiness
- Frontend is completely Sage-free: zero Sage components, zero Sage store state, zero Sage admin views
- RootLayout is a clean shell ready for Plan 03 Intercom integration (`<IntercomProvider>` wrapping `<Outlet />`)
- TypeScript builds cleanly, production build succeeds
- No blockers for Plan 03

---
*Phase: 50.3-remove-sage-replace-with-intercom*
*Completed: 2026-03-02*
