---
phase: 50.3-remove-sage-replace-with-intercom
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/components/pilot/SageFAB.tsx
  - frontend/src/components/pilot/SagePanel.tsx
  - frontend/src/components/pilot/SageMobileSheet.tsx
  - frontend/src/components/pilot/SageInput.tsx
  - frontend/src/components/pilot/SageMessage.tsx
  - frontend/src/hooks/useSage.ts
  - frontend/src/store/pilotSlice.ts
  - frontend/src/store/index.ts
  - frontend/src/store/resultsSlice.ts
  - frontend/src/tracking.ts
  - frontend/src/layouts/RootLayout.tsx
  - frontend/src/components/marketplace/FilterChips.tsx
  - frontend/src/components/marketplace/EmptyState.tsx
  - frontend/src/admin/pages/IntelligenceDashboardPage.tsx
  - frontend/src/admin/components/AdminSidebar.tsx
  - frontend/src/admin/pages/OverviewPage.tsx
  - frontend/src/admin/hooks/useAdminData.ts
  - frontend/src/admin/types.ts
  - frontend/src/admin/pages/AdminMarketplacePage.tsx
autonomous: true
requirements:
  - SAGE-REMOVE

must_haves:
  truths:
    - "No Sage UI components render anywhere in the app"
    - "No SageFAB, SagePanel, or SageMobileSheet appears in the DOM"
    - "Intelligence Dashboard page is gone from admin"
    - "Admin sidebar has no Intelligence nav item"
    - "Overview page has no Sage sparkline card"
    - "FilterChips has no sageMode icon"
    - "EmptyState has no 'Ask Sage' CTA"
    - "Frontend builds without TypeScript errors after all removals"
  artifacts:
    - path: "frontend/src/layouts/RootLayout.tsx"
      provides: "Layout without any Sage components"
      contains: "No SageFAB, SagePanel, SageMobileSheet imports"
    - path: "frontend/src/store/index.ts"
      provides: "Store without pilotSlice"
      contains: "No pilotSlice import or compose"
    - path: "frontend/src/store/resultsSlice.ts"
      provides: "Results slice without sageMode"
      contains: "No sageMode field or setSageMode action"
    - path: "frontend/src/tracking.ts"
      provides: "Tracking without sage_query event type"
      contains: "No sage_query in EventType union"
    - path: "frontend/src/admin/components/AdminSidebar.tsx"
      provides: "Sidebar without Intelligence nav"
      contains: "No intelligence route link"
  key_links:
    - from: "frontend/src/store/index.ts"
      to: "frontend/src/store/resultsSlice.ts"
      via: "store compose"
      pattern: "resultsSlice"
    - from: "frontend/src/layouts/RootLayout.tsx"
      to: "frontend/src/components/marketplace/"
      via: "Outlet rendering"
      pattern: "Outlet"
---

<objective>
Remove all Sage frontend code: delete pilot component files, useSage hook, pilotSlice store; clean shared files (RootLayout, store, tracking, FilterChips, EmptyState); remove admin Intelligence Dashboard page and Sage-specific admin UI elements.

Purpose: Strip the entire Sage conversational UI layer from the frontend while keeping marketplace search intact.
Output: Clean frontend codebase with zero Sage references, all non-Sage features intact, TypeScript builds cleanly.
</objective>

<execution_context>
@/Users/sebastianhamers/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sebastianhamers/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/milestones/v4.0-phases/50.3-remove-sage-replace-with-intercom/50.3-CONTEXT.md
@.planning/milestones/v4.0-phases/50.3-remove-sage-replace-with-intercom/50.3-RESEARCH.md
@frontend/src/layouts/RootLayout.tsx
@frontend/src/store/index.ts
@frontend/src/store/pilotSlice.ts
@frontend/src/store/resultsSlice.ts
@frontend/src/tracking.ts
@frontend/src/components/marketplace/FilterChips.tsx
@frontend/src/components/marketplace/EmptyState.tsx
@frontend/src/admin/pages/IntelligenceDashboardPage.tsx
@frontend/src/admin/components/AdminSidebar.tsx
@frontend/src/admin/pages/OverviewPage.tsx
@frontend/src/admin/hooks/useAdminData.ts
@frontend/src/admin/types.ts
@frontend/src/admin/pages/AdminMarketplacePage.tsx
@frontend/src/main.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Delete Sage-specific files and clean shared store/tracking</name>
  <files>
    frontend/src/components/pilot/SageFAB.tsx,
    frontend/src/components/pilot/SagePanel.tsx,
    frontend/src/components/pilot/SageMobileSheet.tsx,
    frontend/src/components/pilot/SageInput.tsx,
    frontend/src/components/pilot/SageMessage.tsx,
    frontend/src/hooks/useSage.ts,
    frontend/src/store/pilotSlice.ts,
    frontend/src/store/index.ts,
    frontend/src/store/resultsSlice.ts,
    frontend/src/tracking.ts,
    frontend/src/layouts/RootLayout.tsx,
    frontend/src/components/marketplace/FilterChips.tsx,
    frontend/src/components/marketplace/EmptyState.tsx
  </files>
  <action>
**Step 1: Delete Sage-only files (8 files)**
Delete the entire `frontend/src/components/pilot/` directory (all 5 files: SageFAB.tsx, SagePanel.tsx, SageMobileSheet.tsx, SageInput.tsx, SageMessage.tsx).
Delete `frontend/src/hooks/useSage.ts`.
Delete `frontend/src/store/pilotSlice.ts`.

**Step 2: Clean store/index.ts**
- Remove `pilotSlice` import (e.g., `import { pilotSlice } from './pilotSlice'`).
- Remove `pilotSlice` from the store compose/create call.
- Remove `PilotMessage` re-export if present.
- Remove `usePilotSlice` hook export if present.
- Keep all other slices (resultsSlice, filterSlice, nltrStore, etc.) intact.

**Step 3: Clean store/resultsSlice.ts**
- Remove `sageMode` field from the state interface/type.
- Remove `setSageMode` action.
- Remove `sageMode: false` from the `resetResults` action (or equivalent reset).
- Keep all other results state (experts, loading, etc.) intact.

**Step 4: Clean tracking.ts**
- Remove `'sage_query'` from the `EventType` union type.
- Keep `'card_click'`, `'filter_change'`, `'search_query'`, and any other event types.

**Step 5: Clean RootLayout.tsx**
- Remove imports: SageFAB, SagePanel, SageMobileSheet (and any associated hooks like `useSage`, `useMediaQuery` if only used for Sage mobile detection).
- Remove all Sage-related state: `isOpen`, `setOpen`, `isMobile` (if only used for Sage sheet).
- Remove Sage JSX: `<SageFAB />`, `<SagePanel />`, `<SageMobileSheet />` and any conditional wrappers.
- Keep the `<Outlet />`, header, and all non-Sage layout elements intact.
- Do NOT add Intercom yet (that's Plan 03).

**Step 6: Clean FilterChips.tsx**
- Remove `sageMode` selector (e.g., `const sageMode = useExplorerStore((s) => s.sageMode)` or similar).
- Remove the Sage mode icon rendering and any `sageMode` conditional.
- Update any condition like `(chips.length > 0 || sageMode)` to just `chips.length > 0`.

**Step 7: Clean EmptyState.tsx**
- Remove any Sage CTA (e.g., "Try describing it to Sage" button and its `onClick`/`setOpen` handler).
- Remove `sageMode` branch if present.
- Remove `setOpen` prop if it was passed from parent for Sage panel.
- Keep the empty state UI with a generic message. Do NOT add Intercom CTA yet — the Intercom bubble handles support. Just simplify to a "No results found" or "Try adjusting your filters" message.

**IMPORTANT:** After all removals, run `npx tsc --noEmit` from the `frontend/` directory to verify zero TypeScript errors. Fix any remaining references to deleted files or removed fields.
  </action>
  <verify>
    <automated>cd /Users/sebastianhamers/Documents/TCS/frontend && npx tsc --noEmit 2>&1 | head -30</automated>
    <manual>Verify that `frontend/src/components/pilot/` directory no longer exists, `useSage.ts` and `pilotSlice.ts` are deleted</manual>
  </verify>
  <done>All 8 Sage-specific files deleted. Store, tracking, RootLayout, FilterChips, EmptyState cleaned of Sage references. TypeScript compiles cleanly with zero errors.</done>
</task>

<task type="auto">
  <name>Task 2: Remove Intelligence Dashboard and clean admin pages</name>
  <files>
    frontend/src/admin/pages/IntelligenceDashboardPage.tsx,
    frontend/src/main.tsx,
    frontend/src/admin/components/AdminSidebar.tsx,
    frontend/src/admin/pages/OverviewPage.tsx,
    frontend/src/admin/hooks/useAdminData.ts,
    frontend/src/admin/types.ts,
    frontend/src/admin/pages/AdminMarketplacePage.tsx
  </files>
  <action>
**Step 1: Delete IntelligenceDashboardPage.tsx**
Delete `frontend/src/admin/pages/IntelligenceDashboardPage.tsx` entirely.

**Step 2: Clean main.tsx routes**
- Remove the `React.lazy(() => import('./admin/pages/IntelligenceDashboardPage'))` import.
- Remove the `/intelligence` route from the admin route children in the `createBrowserRouter` config.
- Do NOT add IntercomProvider yet (that's Plan 03).
- Keep all other admin routes and public routes intact.

**Step 3: Clean AdminSidebar.tsx**
- Remove the `Intelligence` (or `Intelligence Dashboard`) nav item that links to `/admin/intelligence`.
- Keep Search Lab nav item (per user decision).
- Keep all other nav items (Overview, Experts, Searches, Gaps, Marketplace, etc.).

**Step 4: Clean OverviewPage.tsx**
- Remove the `SageSparklineCard` component definition (likely an inline component or imported).
- Remove its JSX usage in the page layout.
- Remove `useMarketplaceTrend` import/usage if it was only consumed by SageSparklineCard.
- Keep all other overview cards: analytics stat counters (card clicks, search queries, lead clicks from phase 50.2), Recent Leads card, Recent Searches card, health strip, insight cards.

**Step 5: Clean useAdminData.ts**
- Remove `useIntelligenceStats` hook.
- Remove `useIntelligenceMetrics` hook.
- Remove `useEmbeddingMap` hook.
- Remove `useMarketplaceTrend` hook (if no other consumer — verify first).
- Keep all other hooks: `useAnalyticsSummary`, `useExperts`, `useConversations`, `useGaps`, `useMarketplaceDemand`, `useMarketplaceExposure`, etc.

**Step 6: Clean admin/types.ts**
- Remove interfaces: `IntelligenceDailyRow`, `IntelligenceStats`, `IntelligenceMetrics`, `EmbeddingPoint`, `EmbeddingMapResponse`, `EmbeddingMapComputing`, `DailyTrendRow`, `MarketplaceTrendResponse`.
- Keep all other admin type interfaces.

**Step 7: Clean AdminMarketplacePage.tsx**
- Update "Sage Query Volume" label text to neutral text (e.g., "Query Volume" or "Search Volume").
- Update "Sage Query Trends" footer copy to neutral text.
- Remove/update any `sage_clicks` display from the Exposure table if present.
- Keep the page functional — it still shows demand and exposure data from non-Sage endpoints.

**IMPORTANT:** After all admin changes, run `npx tsc --noEmit` from the `frontend/` directory to verify zero TypeScript errors. Fix any remaining references.
  </action>
  <verify>
    <automated>cd /Users/sebastianhamers/Documents/TCS/frontend && npx tsc --noEmit 2>&1 | head -30</automated>
    <manual>Verify IntelligenceDashboardPage.tsx is deleted. Verify AdminSidebar has no "Intelligence" nav item. Verify OverviewPage has no SageSparklineCard.</manual>
  </verify>
  <done>IntelligenceDashboardPage deleted. Admin sidebar, OverviewPage, useAdminData, admin types, and AdminMarketplacePage cleaned of all Sage references. TypeScript compiles cleanly with zero errors.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors from `frontend/` directory
2. `grep -r "sage\|Sage\|pilot\|Pilot" frontend/src/ --include="*.tsx" --include="*.ts" -l` returns zero files (no Sage references remain)
3. `frontend/src/components/pilot/` directory does not exist
4. `frontend/src/hooks/useSage.ts` does not exist
5. `frontend/src/store/pilotSlice.ts` does not exist
6. `frontend/src/admin/pages/IntelligenceDashboardPage.tsx` does not exist
7. `npm run build` succeeds from `frontend/` directory
</verification>

<success_criteria>
- Zero Sage/pilot references in any TypeScript/TSX file in frontend/src/
- Frontend TypeScript compilation passes cleanly
- Frontend build succeeds
- All non-Sage features (marketplace, admin overview, admin searches, admin gaps, admin experts, admin marketplace) function unchanged
- Intelligence Dashboard route removed from router
- Admin sidebar shows no Intelligence nav item
</success_criteria>

<output>
After completion, create `.planning/milestones/v4.0-phases/50.3-remove-sage-replace-with-intercom/50.3-02-SUMMARY.md`
</output>
