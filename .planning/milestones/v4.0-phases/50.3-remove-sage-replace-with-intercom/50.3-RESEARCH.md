# Phase 50.3: Remove Sage, Replace with Intercom - Research

**Researched:** 2026-03-02
**Domain:** Frontend component removal + third-party chat widget integration (React + Vite)
**Confidence:** HIGH

<user_constraints>
## User Constraints (from CONTEXT.md)

### Locked Decisions

**Intercom Integration**
- Intercom app ID: `o9v3tocw` — also expose via `VITE_INTERCOM_APP_ID` env variable
- Default bottom-right floating launcher bubble (standard Intercom positioning)
- Show on all public pages, NOT on admin pages
- Pass user email to Intercom if available (from email gate) to link conversations to identity
- Anonymous fallback if no email captured

**Sage Backend Removal**
- Full removal: delete pilot/chat endpoints, pilot_service, Sage-specific LLM logic, and DB conversation models
- Keep FAISS index and marketplace search infrastructure — only Sage's conversational layer is removed
- Shared components (ChatMessage, ChatInput, useChat): remove if Sage-only; if used elsewhere, clean out Sage-specific logic only

**Sage Frontend Removal**
- Delete all Sage-specific files: SagePanel, SageFAB, SageMobileSheet, SageInput, SageMessage, useSage hook, pilotSlice store
- Clean Sage references from shared files (App.tsx, RootLayout, store/index, types, etc.)
- Remove all Sage-specific analytics events from tracking.ts

**Admin Panel Cleanup**
- Remove Intelligence Dashboard page entirely
- Keep Search Lab page (useful for testing marketplace search queries)
- Remove Sage conversation stats/cards from Overview page — keep search analytics and non-Sage stats
- Clean admin sidebar navigation: remove Intelligence Dashboard link, keep Search Lab
- Remove Sage conversation data from admin export functionality

**Transition — Sage References**
- Replace Sage mentions in empty states/prompts with Intercom-friendly text (e.g., "Chat with us")
- Marketplace integration points ("Ask Sage about this") → replace with general "Need help?" CTA that opens Intercom
- Header: remove Sage reference, do NOT add Intercom trigger (bubble handles it)
- Remove Sage tracking events entirely — Intercom has its own analytics

### Claude's Discretion
- Exact Intercom initialization approach (script tag vs npm package)
- Order of file removal to maintain compilability during implementation
- How to handle any edge cases in shared component dependencies

### Deferred Ideas (OUT OF SCOPE)
None — discussion stayed within phase scope
</user_constraints>

---

## Summary

Phase 50.3 is a surgical removal + replacement: strip Sage (the AI co-pilot) from the entire codebase and drop in Intercom as the user-facing support channel. The work splits cleanly into three streams: (1) delete Sage-specific files and clean shared files, (2) remove the backend `pilot` router and `pilot_service`, and (3) add Intercom's floating launcher to public pages only.

The codebase audit reveals a well-bounded Sage footprint. The frontend pilot components live in a dedicated `frontend/src/components/pilot/` folder (5 files), backed by `useSage.ts`, `pilotSlice.ts`, and `useNltrStore` integration. The backend has two Sage-specific files: `app/routers/pilot.py` and `app/services/pilot_service.py`, plus `app/routers/chat.py` and `app/services/llm.py` (which may be chat-only, not Sage). The `Conversation` DB model is retained because it backs admin searches/gaps/export endpoints — removing it would break admin analytics. The `source` field on `Conversation` uses `"sage"` as a value, but that is stored historical data, not code that needs deletion.

The most nuanced decisions are: (a) whether `vaul` (Drawer.Root) can be removed from `package.json` after deleting `SageMobileSheet`, (b) how to clean `sageMode` from `resultsSlice` and `FilterChips`, (c) how `sage_query` event type in `tracking.ts` and admin backend queries should be handled, and (d) the `IntelligenceDashboardPage` uses `useIntelligenceMetrics` and `useEmbeddingMap` from `useAdminData.ts` — those hooks and their backend endpoints (`/intelligence`, `/intelligence-stats`, `/embedding-map`) can be removed only if the page is removed.

**Primary recommendation:** Use `react-use-intercom` npm package (v5.5.0, MIT, 400K+ weekly downloads) for the Intercom integration — it provides `IntercomProvider` + `useIntercom` hook pattern that fits cleanly into this React 19 + Vite stack. Script tag is the only alternative; skip it — managing a global `window.Intercom` with TypeScript is messier.

---

## Standard Stack

### Core
| Library | Version | Purpose | Why Standard |
|---------|---------|---------|--------------|
| react-use-intercom | ^5.5.0 | Intercom React integration | Hook-based, `IntercomProvider` + `useIntercom`, 400K+/week downloads, MIT |

### Supporting
| Library | Version | Purpose | When to Use |
|---------|---------|---------|-------------|
| (none additional) | — | Intercom SDK loads itself | react-use-intercom injects the Intercom JS snippet automatically |

### Alternatives Considered
| Instead of | Could Use | Tradeoff |
|------------|-----------|----------|
| react-use-intercom | Raw script tag + `window.Intercom` | Script tag works but requires manual TypeScript shims and global mutation; react-use-intercom is cleaner |
| react-use-intercom | @intercom/messenger-js-sdk | Official Intercom SDK exists but community reports it's harder to wire up in React; react-use-intercom is the ecosystem standard |

**Installation:**
```bash
npm install react-use-intercom
```

---

## Architecture Patterns

### Recommended Project Structure

After removal, Sage-related directories are gone:

```
frontend/src/
├── components/pilot/           # DELETE entire directory (5 files)
├── hooks/useSage.ts            # DELETE
├── store/pilotSlice.ts         # DELETE
├── store/index.ts              # CLEAN (remove pilotSlice import/export)
├── store/resultsSlice.ts       # CLEAN (remove sageMode field)
├── layouts/RootLayout.tsx      # CLEAN (remove SageFAB/SagePanel/SageMobileSheet)
├── tracking.ts                 # CLEAN (remove sage_query EventType)
├── components/marketplace/     # CLEAN (EmptyState, FilterChips — sage refs)
└── main.tsx                    # CLEAN (remove IntelligenceDashboardPage lazy import/route)

app/routers/
├── pilot.py                    # DELETE
└── admin.py                    # CLEAN (remove intelligence-stats, intelligence, embedding-map endpoints + sage_query SQL)

app/services/
└── pilot_service.py            # DELETE

app/main.py                     # CLEAN (remove pilot router import/include)
```

### Pattern 1: Intercom Provider Placement

**What:** `IntercomProvider` wraps the public app subtree only, not the admin routes.

**When to use:** Phase 50.3 requires Intercom on public pages only, NOT admin pages. The router structure in `main.tsx` already separates public (`RootLayout` → `MarketplacePage`) from admin (`/admin` subtree). Wrap only the `RootLayout` subtree.

**Example:**
```tsx
// Source: https://github.com/devrnt/react-use-intercom/
// In main.tsx — wrap the public route only

import { IntercomProvider } from 'react-use-intercom'

const INTERCOM_APP_ID = import.meta.env.VITE_INTERCOM_APP_ID ?? 'o9v3tocw'

// Router config — wrap RootLayout element:
{
  element: (
    <IntercomProvider appId={INTERCOM_APP_ID} autoBoot>
      <RootLayout />
    </IntercomProvider>
  ),
  children: [{ path: '/', element: <MarketplacePage /> }]
}
```

`autoBoot` launches the floating bubble immediately without calling `boot()` manually. The bubble appears bottom-right by default — this is the standard Intercom launcher position and matches the locked decision.

### Pattern 2: Passing User Email to Intercom

**What:** Once the user provides their email via the email gate (stored in `localStorage` as `tcs_gate_email`), update Intercom to link the conversation to that identity.

**When to use:** The decision requires passing email if available. The best place is wherever the email gate resolves — `MarketplacePage.tsx` or inside a wrapper in `RootLayout` that watches for the localStorage key.

**Example:**
```tsx
// Source: https://github.com/devrnt/react-use-intercom/
// In a component that has access to the email

import { useIntercom } from 'react-use-intercom'
import { useNltrStore } from '../store/nltrStore'

function IntercomIdentity() {
  const { update } = useIntercom()
  const email = useNltrStore((s) => s.email)

  useEffect(() => {
    if (email) {
      update({ email })
    }
  }, [email, update])

  return null
}
```

`useNltrStore` already tracks the user email from the email gate — this is the cleanest source rather than reading `localStorage` directly.

### Pattern 3: Removal Order to Maintain Compilability

**What:** Delete files in dependency order to avoid broken imports mid-implementation.

**When to use:** Always during removal phases — TypeScript will fail build if you delete a file that's still imported.

**Recommended order:**
1. Backend first (no TypeScript compile step): delete `pilot.py`, `pilot_service.py`, remove from `main.py`
2. Frontend leaf components first: `SageInput.tsx`, `SageMessage.tsx`
3. Then container components: `SagePanel.tsx`, `SageFAB.tsx`, `SageMobileSheet.tsx`
4. Then hook: `useSage.ts`
5. Then store slice: `pilotSlice.ts`
6. Then shared file cleanups: `RootLayout.tsx`, `store/index.ts`, `resultsSlice.ts`, `FilterChips.tsx`, `EmptyState.tsx`, `tracking.ts`
7. Then admin: `IntelligenceDashboardPage.tsx`, sidebar nav item, admin data hooks for intelligence endpoints
8. Add Intercom: install package, add `IntercomProvider` to `main.tsx`, add `IntercomIdentity` component
9. Final: remove `vaul` from `package.json` if `SageMobileSheet` was its only consumer (verify first)

### Anti-Patterns to Avoid

- **Deleting `Conversation` model:** The `Conversation` table backs admin analytics (searches, gaps, export CSV). Do NOT remove `app/models.py` Conversation class or any related admin endpoints. The `source = "sage"` value in historical rows is harmless stored data.
- **Removing `App.tsx` chat components:** `App.tsx` uses `useChat`, `ChatInput`, `ChatMessage`, `EmptyState` — these are the legacy chat flow (pre-marketplace), not Sage components. They are separate. Check each file's import chain before deleting.
- **Removing `sage_query` from `user_events` SQL wholesale:** The admin `AdminMarketplacePage.tsx` uses `useMarketplaceTrend` and `useMarketplaceDemand` which query `sage_query` events in backend SQL. Since no new `sage_query` events will be emitted after Sage removal, those endpoints will return empty data naturally — no need to change the SQL. The `SageSparklineCard` component in `OverviewPage.tsx` uses `useMarketplaceTrend`, which should be removed with the Overview cleanup.
- **Wrapping admin routes with IntercomProvider:** Admin pages must not get the Intercom bubble. Only the public `RootLayout` subtree gets wrapped.
- **Forgetting `vaul` cleanup:** `vaul` is used exclusively by `SageMobileSheet.tsx`. Once that file is deleted, `vaul` is an unused dependency. It should be removed from `package.json` and `package-lock.json` to keep the bundle clean.

---

## Don't Hand-Roll

| Problem | Don't Build | Use Instead | Why |
|---------|-------------|-------------|-----|
| Intercom JS injection | Custom `<script>` management with React `useEffect` | react-use-intercom `IntercomProvider` | Handles script injection, deduplication, TypeScript types, React lifecycle correctly |
| Email identity passing | Reading localStorage in useEffect at app root | `useIntercom().update()` called when email becomes available | Idiomatic hook pattern, avoids race conditions |

**Key insight:** Intercom's JavaScript snippet has initialization ordering requirements (the script must be loaded before `window.Intercom()` calls). `react-use-intercom` handles this correctly inside its Provider.

---

## Common Pitfalls

### Pitfall 1: `sageMode` Lingering in resultsSlice

**What goes wrong:** `sageMode` field is in `resultsSlice.ts` and consumed by `FilterChips.tsx` and `EmptyState.tsx`. After deleting `useSage.ts`, the `setSageMode` action is no longer called, but the field itself remains. If the field is not removed, `FilterChips` will render a stale icon on page load if `sageMode = true` was persisted (it isn't — see `partialize` in `store/index.ts`, which explicitly excludes it). Low risk but dead code.

**How to avoid:** Remove `sageMode` field, `setSageMode` action, and `sageMode: false` reset from `resultsSlice.ts`. Then clean `FilterChips.tsx` and `EmptyState.tsx` of `sageMode` references.

**Warning signs:** TypeScript errors on `state.sageMode` in `useResultsSlice` hook after removing the field.

### Pitfall 2: `vaul` Still in package.json After SageMobileSheet Deletion

**What goes wrong:** `vaul` is only used by `SageMobileSheet.tsx`. After deletion it becomes an unused dependency that inflates the bundle.

**How to avoid:** After deleting `SageMobileSheet.tsx`, run `grep -r "vaul" frontend/src/` to confirm no other consumer, then `npm uninstall vaul` and commit updated `package-lock.json`.

**Warning signs:** `vaul` still in `package.json` after the phase.

### Pitfall 3: IntelligenceDashboardPage Hooks Still Referenced

**What goes wrong:** `IntelligenceDashboardPage.tsx` uses `useIntelligenceMetrics` and `useEmbeddingMap` from `useAdminData.ts`. After removing the page, those hook exports remain in `useAdminData.ts`. They reference backend endpoints `/intelligence` and `/intelligence-stats` and `/embedding-map` — those endpoints can also be removed from `admin.py` since the page that consumed them is gone.

**How to avoid:** After removing `IntelligenceDashboardPage.tsx`, remove its lazy import from `main.tsx`, then clean `useAdminData.ts` of `useIntelligenceMetrics`, `useEmbeddingMap`, `useIntelligenceStats`, and the associated backend admin endpoints.

**Warning signs:** Dead exports in `useAdminData.ts`; orphan endpoints in `admin.py` that serve no frontend.

### Pitfall 4: OverviewPage SageSparklineCard Remains

**What goes wrong:** `OverviewPage.tsx` has a `SageSparklineCard` component that uses `useMarketplaceTrend()` which queries `sage_query` events. After Sage removal, this card will always show zero and is misleading.

**How to avoid:** Remove the `SageSparklineCard` component and its usage in `OverviewPage.tsx`. Also remove the `useMarketplaceTrend` hook from `useAdminData.ts` if no other consumer exists, and the `/events/trend` backend endpoint.

**Warning signs:** `SageSparklineCard` component definition still present in `OverviewPage.tsx`.

### Pitfall 5: `sage_query` EventType Still in tracking.ts TypeUnion

**What goes wrong:** `tracking.ts` has `type EventType = 'card_click' | 'sage_query' | 'filter_change' | 'search_query'`. After removing Sage, `sage_query` is never emitted. The type should be cleaned.

**How to avoid:** Remove `'sage_query'` from the `EventType` union in `tracking.ts`.

**Warning signs:** TypeScript will not catch this automatically (it's a string literal that simply goes unused).

### Pitfall 6: admin.py Routes for Intelligence/Embedding Still Active

**What goes wrong:** The backend endpoints `/api/admin/intelligence`, `/api/admin/intelligence-stats`, `/api/admin/embedding-map` are used exclusively by `IntelligenceDashboardPage`. After removing that page, these endpoints serve no frontend. They use Gemini/LLM infrastructure and FAISS in ways that are Sage-adjacent. They should be removed to reduce attack surface and LLM cost surface.

**How to avoid:** After removing `IntelligenceDashboardPage`, remove these three endpoint functions from `admin.py`.

**Warning signs:** Dead admin endpoints callable from the API but unreachable from any frontend page.

### Pitfall 7: `SearchesTable.tsx` Source Badge for "sage"

**What goes wrong:** `admin/components/SearchesTable.tsx` references `source === 'sage'` to render a cyan badge. After Sage removal, no new rows will have `source = 'sage'`, but historical rows still do. Removing the badge CSS would make historical rows show no source badge. This is acceptable — just make the badge gracefully handle unknown sources rather than erroring.

**How to avoid:** Either keep the `sage` badge path (for historical display) or replace it with a generic badge. The user decision says "remove Sage conversation data from admin export" but not from the display table — so keeping the badge for historical rows is safe. No code change is strictly required here.

---

## Code Examples

Verified patterns from official sources:

### Intercom Provider Setup (react-use-intercom)
```tsx
// Source: https://github.com/devrnt/react-use-intercom/
// main.tsx — public route wrapped with IntercomProvider

import { IntercomProvider } from 'react-use-intercom'

const INTERCOM_APP_ID = import.meta.env.VITE_INTERCOM_APP_ID ?? 'o9v3tocw'

// In createBrowserRouter config:
{
  element: (
    <IntercomProvider appId={INTERCOM_APP_ID} autoBoot>
      <RootLayout />
    </IntercomProvider>
  ),
  children: [{ path: '/', element: <MarketplacePage /> }]
}
```

### Email Update After Gate (in RootLayout or MarketplacePage)
```tsx
// Source: https://github.com/devrnt/react-use-intercom/
import { useIntercom } from 'react-use-intercom'
import { useNltrStore } from '../store/nltrStore'
import { useEffect } from 'react'

function IntercomIdentity() {
  const { update } = useIntercom()
  const email = useNltrStore((s) => s.email)

  useEffect(() => {
    if (email) {
      update({ email })
    }
  }, [email, update])

  return null  // renders nothing, side-effect only
}
```

### Backend Removal: main.py Cleanup
```python
# Remove from app/main.py imports:
# from app.routers import ..., pilot, ...
# Remove:
# app.include_router(pilot.router)
```

### EmptyState Sage CTA Replacement
```tsx
// Before (EmptyState.tsx):
<button onClick={() => setOpen(true)}>
  Try describing it to Sage
</button>

// After:
<button onClick={() => {
  // No-op — Intercom bubble handles support; just clear filters
  resetFilters()
}}>
  Need help? Chat with us
</button>
// OR simply remove the "not finding what you need?" CTA entirely
// since Intercom bubble is always visible
```

### FilterChips sageMode Removal
```tsx
// Remove from FilterChips.tsx:
// const sageMode = useExplorerStore((s) => s.sageMode)
// {sageMode ? ... Sage icon ... : null}
// Replace condition: (chips.length > 0 || sageMode) → chips.length > 0
```

---

## State of the Art

| Old Approach | Current Approach | When Changed | Impact |
|--------------|------------------|--------------|--------|
| Sage co-pilot (Gemini function calling) | Intercom floating widget | Phase 50.3 | No LLM API cost for chat; third-party handles all conversations |
| Custom Vaul bottom sheet for mobile | Intercom mobile-optimized messenger | Phase 50.3 | Remove vaul dependency entirely |
| pilotSlice in Zustand | No chat state in Zustand | Phase 50.3 | Simplified store; fewer re-renders |

**Deprecated/outdated after this phase:**
- `pilotSlice.ts`: remove entirely — no Sage state needed
- `sageMode` in `resultsSlice`: remove — was toggled by `useSage`, which is deleted
- `sage_query` event type: remove from tracking.ts — Intercom has its own analytics
- `/api/pilot` endpoint: remove — Intercom handles user chat
- `app/services/llm.py`: verify if this is Sage-only before removing (may be shared with `chat.py`)

---

## Open Questions

1. **Is `app/services/llm.py` Sage-only or shared with `app/routers/chat.py`?**
   - What we know: `chat.py` exists and references the legacy chat endpoint. `pilot_service.py` imports Gemini directly (not via `llm.py`). `llm.py` likely serves the legacy `chat.py` SSE flow.
   - What's unclear: Whether removing Sage means `llm.py` can also be removed.
   - Recommendation: Grep `llm.py` usage before deleting. If only used by `chat.py` (which is still used by `App.tsx`), leave it alone. Do NOT remove `chat.py` or `llm.py` — they are the legacy chat flow, not Sage.

2. **Does `useMarketplaceTrend` / `/events/trend` serve any purpose after Sage removal?**
   - What we know: The endpoint queries `event_type = 'sage_query'` rows. After Sage removal, no new events of this type are emitted. Historical data remains.
   - What's unclear: Whether the admin wants to keep the trend chart showing historical Sage volume for reference.
   - Recommendation: Remove `SageSparklineCard` and `useMarketplaceTrend` as per user decision ("remove Sage conversation stats/cards from Overview page"). The backend `/events/trend` endpoint can also be removed since no page consumes it after Overview cleanup.

3. **Can `vaul` be fully removed after `SageMobileSheet.tsx` deletion?**
   - What we know: `vaul` appears in `package.json` and is imported only in `SageMobileSheet.tsx` based on codebase search.
   - What's unclear: Whether any other component uses `vaul` directly.
   - Recommendation: After deletion, run `grep -r "vaul" frontend/src/` to confirm zero consumers, then uninstall.

4. **`VITE_INTERCOM_APP_ID` env var: where to add for local dev?**
   - What we know: The app ID is `o9v3tocw` and should be in `.env.example` (currently only `VITE_API_URL` is there). The code should fall back to the hardcoded ID if the env var is not set.
   - Recommendation: Add `VITE_INTERCOM_APP_ID=o9v3tocw` to `frontend/.env.example` and document it. Vercel auto-deploys from git, so the env var also needs to be set in Vercel dashboard (or the fallback hardcoded value covers it).

---

## Full Sage Footprint (Complete Removal Checklist)

### Backend Files to Delete
- `app/routers/pilot.py` — `/api/pilot` endpoint
- `app/services/pilot_service.py` — Gemini function calling logic

### Backend Files to Clean
- `app/main.py` — remove `pilot` router import and `app.include_router(pilot.router)`
- `app/routers/admin.py`:
  - Remove `get_intelligence_stats()` endpoint (`/intelligence-stats`)
  - Remove `get_intelligence_metrics()` endpoint (`/intelligence`)
  - Remove `get_embedding_map()` endpoint (`/embedding-map`)
  - Remove `get_trend()` endpoint (`/events/trend`) — queries `sage_query` events for Sage volume sparkline
  - Remove `export_demand_csv()` endpoint (`/export/demand.csv`) — queries `sage_query` events
  - Keep `/events/demand` and `/events/exposure` (they are used by AdminMarketplacePage, not Overview)

### Frontend Files to Delete
- `frontend/src/components/pilot/SageFAB.tsx`
- `frontend/src/components/pilot/SagePanel.tsx`
- `frontend/src/components/pilot/SageMobileSheet.tsx`
- `frontend/src/components/pilot/SageInput.tsx`
- `frontend/src/components/pilot/SageMessage.tsx`
- `frontend/src/hooks/useSage.ts`
- `frontend/src/store/pilotSlice.ts`
- `frontend/src/admin/pages/IntelligenceDashboardPage.tsx`

### Frontend Files to Clean
- `frontend/src/main.tsx` — remove `IntelligenceDashboardPage` lazy import and `/intelligence` route; wrap `RootLayout` with `IntercomProvider`
- `frontend/src/layouts/RootLayout.tsx` — remove SageFAB, SagePanel, SageMobileSheet imports and JSX; remove `isOpen`/`setOpen`/`isMobile` Sage logic; add `IntercomIdentity` component
- `frontend/src/store/index.ts` — remove `pilotSlice` import/compose/export; remove `PilotMessage` re-export; remove `usePilotSlice` hook export
- `frontend/src/store/resultsSlice.ts` — remove `sageMode` field, `setSageMode` action, `sageMode: false` in `resetResults`
- `frontend/src/tracking.ts` — remove `'sage_query'` from `EventType` union
- `frontend/src/components/marketplace/FilterChips.tsx` — remove `sageMode` selector and Sage mode icon rendering
- `frontend/src/components/marketplace/EmptyState.tsx` — remove Sage CTA ("Try describing it to Sage"), remove `setOpen` usage, replace with Intercom-friendly copy ("Need help? Chat with us" or remove entirely since Intercom bubble is always visible); remove `sageMode` branch
- `frontend/src/admin/components/AdminSidebar.tsx` — remove `Intelligence` nav item (`to: '/admin/intelligence'`)
- `frontend/src/admin/pages/OverviewPage.tsx` — remove `SageSparklineCard` component and its usage; remove `useMarketplaceTrend` import
- `frontend/src/admin/hooks/useAdminData.ts` — remove `useIntelligenceStats`, `useIntelligenceMetrics`, `useEmbeddingMap`, `useMarketplaceTrend` hooks; remove their type imports from `admin/types.ts`
- `frontend/src/admin/types.ts` — remove `IntelligenceDailyRow`, `IntelligenceStats`, `IntelligenceMetrics`, `EmbeddingPoint`, `EmbeddingMapResponse`, `EmbeddingMapComputing`, `DailyTrendRow`, `MarketplaceTrendResponse` interfaces
- `frontend/src/admin/pages/AdminMarketplacePage.tsx` — update "Sage Query Volume" label to neutral text (e.g., "Query Volume") or keep as historical label; update "Sage Query Trends" footer copy; remove/update `sage_clicks` display from Exposure table
- `frontend/src/store/nltrStore.ts` (if referenced) — verify no Sage-specific state
- `frontend/.env.example` — add `VITE_INTERCOM_APP_ID=o9v3tocw`
- `frontend/package.json` — add `react-use-intercom`; remove `vaul` (after confirming no other consumer)

### New Files to Create
- `frontend/src/components/IntercomIdentity.tsx` (or inline in RootLayout) — `useIntercom().update({ email })` effect

---

## Sources

### Primary (HIGH confidence)
- Codebase direct read — all Sage component files, `main.py`, `pilot.py`, `pilot_service.py`, `admin.py`, `models.py`, `store/pilotSlice.ts`, `store/index.ts`, `store/resultsSlice.ts`, `RootLayout.tsx`, `tracking.ts`, `EmptyState.tsx`, `FilterChips.tsx`, `AdminSidebar.tsx`, `OverviewPage.tsx`, `IntelligenceDashboardPage.tsx`, `useAdminData.ts`, `main.tsx`
- [react-use-intercom GitHub](https://github.com/devrnt/react-use-intercom/) — IntercomProvider + useIntercom API

### Secondary (MEDIUM confidence)
- [Intercom JS API Methods](https://developers.intercom.com/installing-intercom/web/methods) — boot method, app_id, email attributes (verified via search result excerpt)
- [react-use-intercom npm](https://www.npmjs.com/package/react-use-intercom) — v5.5.0, 400K+ weekly downloads, MIT

### Tertiary (LOW confidence)
- None — all critical decisions verified from codebase or official sources

---

## Metadata

**Confidence breakdown:**
- Sage removal scope: HIGH — direct codebase read, all files inventoried
- Intercom integration: HIGH — react-use-intercom is verified standard, API confirmed from official docs
- Admin cleanup scope: HIGH — all affected endpoints and components identified
- vaul removal: MEDIUM — confident it's Sage-only based on grep; verify before removing

**Research date:** 2026-03-02
**Valid until:** 2026-04-02 (stable domain — Intercom SDK changes rarely; 30-day validity)
