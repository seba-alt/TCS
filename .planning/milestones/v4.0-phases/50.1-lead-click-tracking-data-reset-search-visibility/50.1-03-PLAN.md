---
phase: 50.1-lead-click-tracking-data-reset-search-visibility
plan: 03
type: execute
wave: 2
depends_on:
  - 50.1-01
files_modified:
  - scripts/reset_for_launch.py
autonomous: true
requirements:
  - 50.1-DATA-RESET

must_haves:
  truths:
    - "Running the script with --confirm deletes all transactional data from conversations.db"
    - "Running the script without --confirm shows row counts but deletes nothing (dry-run)"
    - "Expert data (experts table, metadata.json, FAISS index) is NOT touched"
    - "The lead_clicks table is included in the wipe alongside other transactional tables"
  artifacts:
    - path: "scripts/reset_for_launch.py"
      provides: "One-time pre-launch data reset script with dry-run safety"
      contains: "TABLES_TO_WIPE"
  key_links:
    - from: "scripts/reset_for_launch.py"
      to: "app.models"
      via: "Import all transactional models"
      pattern: "from app.models import"
    - from: "scripts/reset_for_launch.py"
      to: "app.database.SessionLocal"
      via: "Direct DB connection"
      pattern: "SessionLocal"
---

<objective>
Create a one-time pre-launch data reset script that wipes all transactional data (conversations, leads, analytics, feedback, events, lead clicks) while preserving expert data.

Purpose: Clean database slate before public launch — no test data visible to real users.

Output: `scripts/reset_for_launch.py` with dry-run (default) and --confirm modes.
</objective>

<execution_context>
@/Users/sebastianhamers/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sebastianhamers/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/milestones/v4.0-phases/50.1-lead-click-tracking-data-reset-search-visibility/50.1-CONTEXT.md
@.planning/milestones/v4.0-phases/50.1-lead-click-tracking-data-reset-search-visibility/50.1-RESEARCH.md
@.planning/milestones/v4.0-phases/50.1-lead-click-tracking-data-reset-search-visibility/50.1-01-SUMMARY.md
@app/models.py
@app/database.py
@app/routers/admin.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create pre-launch data reset script</name>
  <files>scripts/reset_for_launch.py</files>
  <action>
Create `scripts/reset_for_launch.py` — a standalone Python CLI script that connects to the database via SQLAlchemy and deletes all rows from transactional tables.

```python
#!/usr/bin/env python3
"""
One-time pre-launch data reset.
Deletes all conversations, leads, analytics, feedback, user events, and lead clicks.
Preserves: experts, admin_users, settings.

Usage:
  python scripts/reset_for_launch.py            # dry-run (shows counts, deletes nothing)
  python scripts/reset_for_launch.py --confirm   # actually deletes all transactional data
"""
import sys
import os

# Add project root to path so app.models and app.database can be imported
sys.path.insert(0, os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

from app.database import SessionLocal
from app.models import Conversation, EmailLead, Feedback, NewsletterSubscriber, UserEvent, LeadClick

TABLES_TO_WIPE = [
    Feedback,
    Conversation,
    EmailLead,
    NewsletterSubscriber,
    UserEvent,
    LeadClick,
]

def main():
    confirm = "--confirm" in sys.argv
    db = SessionLocal()

    print("=" * 50)
    print("PRE-LAUNCH DATA RESET")
    print("=" * 50)
    print(f"Mode: {'LIVE DELETE' if confirm else 'DRY RUN (no changes)'}")
    print()

    try:
        total = 0
        for model in TABLES_TO_WIPE:
            count = db.query(model).count()
            total += count
            action = "→ DELETED" if confirm else "(dry run)"
            print(f"  {model.__tablename__:.<30} {count:>6} rows {action}")
            if confirm:
                db.query(model).delete()

        print()
        print(f"  Total: {total} rows {'deleted' if confirm else 'would be deleted'}")

        if confirm:
            db.commit()
            print()
            print("Database cleared for launch.")
            print("Expert data (experts, admin_users, settings) preserved.")
        else:
            print()
            print("This was a dry run. No data was deleted.")
            print("Run with --confirm to actually delete.")
    except Exception as e:
        db.rollback()
        print(f"\nERROR: {e}")
        sys.exit(1)
    finally:
        db.close()


if __name__ == "__main__":
    main()
```

**Key requirements:**
- The `sys.path.insert` line is needed so the script can import from `app/` when run from any directory.
- Must include `LeadClick` in TABLES_TO_WIPE (created by Plan 01).
- Dry-run is the default (safe). Only `--confirm` actually deletes.
- Show row counts in both modes so the user can verify before confirming.
- Keep it simple — no argparse, no logging, just sys.argv check.
- The script does NOT touch: experts table, admin_users table, settings table, metadata.json, experts.csv, FAISS index.

**Make sure the `scripts/` directory exists.** If not, create it.
  </action>
  <verify>
    <automated>cd /Users/sebastianhamers/Documents/TCS && python scripts/reset_for_launch.py 2>&1 | head -20</automated>
    <manual>Verify script runs in dry-run mode (shows counts), does NOT delete data, and includes lead_clicks in the table list</manual>
  </verify>
  <done>Script exists at scripts/reset_for_launch.py. Dry-run (no args) shows row counts without deleting. --confirm mode deletes all transactional data. Expert data is preserved. LeadClick table is included in wipe list.</done>
</task>

</tasks>

<verification>
1. `python scripts/reset_for_launch.py` runs without error and shows "DRY RUN" with row counts
2. Script output includes `lead_clicks` table in the list
3. Script does NOT actually delete any data in dry-run mode
4. Script imports LeadClick from app.models successfully
5. `scripts/reset_for_launch.py` contains `TABLES_TO_WIPE` with 6 models
</verification>

<success_criteria>
- Script runs from project root with `python scripts/reset_for_launch.py`
- Dry-run shows accurate row counts for all 6 transactional tables
- --confirm mode deletes all transactional data
- Expert data (experts, admin_users, settings, metadata.json, FAISS) untouched
- LeadClick included in wipe list
</success_criteria>

<output>
After completion, create `.planning/milestones/v4.0-phases/50.1-lead-click-tracking-data-reset-search-visibility/50.1-03-SUMMARY.md`
</output>
