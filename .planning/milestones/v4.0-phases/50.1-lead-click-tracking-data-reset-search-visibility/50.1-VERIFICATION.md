---
phase: 50.1-lead-click-tracking-data-reset-search-visibility
verified: 2026-02-27T16:30:00Z
status: passed
score: 15/15 must-haves verified
re_verification: false
---

# Phase 50.1: Lead Click Tracking, Data Reset & Search Bar Visibility — Verification Report

**Phase Goal:** Track which leads click on which experts in admin (both leads tab and expert detail view), reset all conversation/lead/analytics data for fresh launch start, make search bar border more visible, and replace expert usernames with First Last names in admin views.
**Verified:** 2026-02-27T16:30:00Z
**Status:** PASSED
**Re-verification:** No — initial verification

---

## Goal Achievement

### Observable Truths

| #  | Truth                                                                                       | Status     | Evidence                                                                                         |
|----|---------------------------------------------------------------------------------------------|------------|--------------------------------------------------------------------------------------------------|
| 1  | Lead card clicks by email-identified users are stored in a dedicated lead_clicks table      | VERIFIED   | `LeadClick` model at `app/models.py` lines 164-179; table `lead_clicks` confirmed by import test |
| 2  | POST /api/admin/lead-clicks accepts email + expert_username + search_query and returns 202  | VERIFIED   | `record_lead_click` on `auth_router` at admin.py line 317, `LeadClickRequest` at line 311        |
| 3  | GET /api/admin/lead-clicks returns clicks grouped by email with expert full names           | VERIFIED   | `get_lead_clicks` at admin.py line 1940; batch-resolves names via Expert table (no N+1)          |
| 4  | GET /api/admin/lead-clicks/by-expert/{username} returns clicks for a specific expert        | VERIFIED   | `get_lead_clicks_by_expert` at admin.py line 1972                                                |
| 5  | ExpertCard sends a lead-click POST when the user has an email in nltrStore                  | VERIFIED   | `_fireLeadClick` in ExpertCard.tsx line 47; reads `useNltrStore.getState().email`; conditional   |
| 6  | ExpertCard does NOT send a lead-click when the user has no email                            | VERIFIED   | `if (nltrEmail)` guard at line 49 — no email, no fetch                                          |
| 7  | POST /api/admin/reset-data also wipes the lead_clicks table                                 | VERIFIED   | `reset_data` at admin.py line 2002 includes `LeadClick` in `for model in [...]` loop            |
| 8  | Admin Leads tab shows click history per lead in expanded row                                | VERIFIED   | LeadsPage.tsx lines 297-321: "Expert Clicks" section with lazy-loaded fetch on expand            |
| 9  | Admin Experts page shows which leads clicked on each expert via expandable row              | VERIFIED   | ExpertsPage.tsx lines 493-518: "Lead Clicks" panel with per-expert lazy-load                    |
| 10 | AdminMarketplacePage exposure table shows expert full name instead of username              | VERIFIED   | AdminMarketplacePage.tsx line 390: `{row.expert_name ?? row.expert_id}`                         |
| 11 | Search bar has a visually prominent border                                                  | VERIFIED   | Header.tsx line 183: `border-2 border-slate-300 shadow-sm`                                      |
| 12 | Expert names displayed as "First Last" in admin (no raw usernames in exposure table)        | VERIFIED   | Exposure endpoint returns `expert_name`; UI uses it with fallback                               |
| 13 | Running reset script with --confirm deletes all transactional data                         | VERIFIED   | `scripts/reset_for_launch.py` with TABLES_TO_WIPE of 6 models including LeadClick               |
| 14 | Running reset script without --confirm shows row counts but deletes nothing (dry-run)       | VERIFIED   | Script executed: shows 6 tables with counts, prints "DRY RUN (no changes)", exits cleanly       |
| 15 | Expert data (experts table, metadata.json, FAISS) is NOT touched by reset script           | VERIFIED   | TABLES_TO_WIPE contains only transactional tables; experts/admin_users/settings omitted         |

**Score:** 15/15 truths verified

---

### Required Artifacts

| Artifact                                                  | Expected                                          | Status      | Details                                                                   |
|-----------------------------------------------------------|---------------------------------------------------|-------------|---------------------------------------------------------------------------|
| `app/models.py`                                           | LeadClick SQLAlchemy model                        | VERIFIED    | Lines 164-179; fields: id, email, expert_username, search_query, created_at |
| `app/routers/admin.py`                                    | Lead-click endpoints + reset-data LeadClick       | VERIFIED    | record_lead_click (L317), get_lead_clicks (L1940), get_lead_clicks_by_expert (L1972), LeadClick in reset (L2002) |
| `frontend/src/components/marketplace/ExpertCard.tsx`      | Lead-click capture on card click                  | VERIFIED    | _fireLeadClick helper (L47); fires on both desktop and mobile second-tap  |
| `frontend/src/admin/types.ts`                             | LeadClick TypeScript types                        | VERIFIED    | LeadClickEntry (L293), LeadClicksByEmail (L300), LeadClicksResponse (L305), LeadClicksByExpertResponse (L309) |
| `frontend/src/admin/pages/LeadsPage.tsx`                  | Click history in expanded lead row                | VERIFIED    | "Expert Clicks" section at L297-321; lazy-loads /lead-clicks on row expand |
| `frontend/src/admin/pages/ExpertsPage.tsx`                | Lead click panel in expandable expert row         | VERIFIED    | "Lead Clicks" panel at L493-518; lazy-loads /lead-clicks/by-expert/{username} |
| `frontend/src/admin/pages/AdminMarketplacePage.tsx`       | Expert full name in exposure table                | VERIFIED    | L390: `{row.expert_name ?? row.expert_id}`; column header changed to "Expert" |
| `frontend/src/components/Header.tsx`                      | Prominent search bar border                       | VERIFIED    | L183: `border-2 border-slate-300 shadow-sm` (was `border border-slate-200`) |
| `scripts/reset_for_launch.py`                             | Pre-launch data reset script with dry-run safety  | VERIFIED    | TABLES_TO_WIPE (L20-27) with 6 models; dry-run confirmed working          |

---

### Key Link Verification

| From                                | To                                     | Via                                          | Status   | Details                                                           |
|-------------------------------------|----------------------------------------|----------------------------------------------|----------|-------------------------------------------------------------------|
| `ExpertCard.tsx`                    | `/api/admin/lead-clicks` (POST)        | fetch in `_fireLeadClick` when email exists  | WIRED    | L50: `void fetch('${API_BASE}/api/admin/lead-clicks', ...)`       |
| `app/routers/admin.py`              | `app/models.py LeadClick`              | SQLAlchemy select query in admin endpoints   | WIRED    | L1947: `select(LeadClick).order_by(...)`, L1976: `select(LeadClick).where(...)` |
| `LeadsPage.tsx`                     | `/api/admin/lead-clicks` (GET)         | `adminFetch` on row expand                   | WIRED    | L47: `await adminFetch<LeadClicksResponse>('/lead-clicks')`       |
| `ExpertsPage.tsx`                   | `/api/admin/lead-clicks/by-expert`     | `adminFetch` on row expand                   | WIRED    | L202: `await adminFetch<LeadClicksByExpertResponse>('/lead-clicks/by-expert/${username}')` |
| `AdminMarketplacePage.tsx`          | `ExposureRow.expert_name`              | Display with fallback to expert_id            | WIRED    | L390: `{row.expert_name ?? row.expert_id}`                        |
| `scripts/reset_for_launch.py`       | `app.models`                           | Import all transactional models               | WIRED    | L18: `from app.models import Conversation, EmailLead, Feedback, NewsletterSubscriber, UserEvent, LeadClick` |
| `scripts/reset_for_launch.py`       | `app.database.SessionLocal`            | Direct DB connection                          | WIRED    | L17: `from app.database import SessionLocal`; L31: `db = SessionLocal()` |

---

### Anti-Patterns Scan

| File | Pattern | Severity | Notes |
|------|---------|----------|-------|
| ExpertCard.tsx | `return null` (lines 23-24) | INFO | Legitimate: `findabilityLabel()` returns null when no badge needed — not a stub |
| All files | No TODO/FIXME/placeholder detected | — | Clean |
| All files | No empty handler stubs | — | All handlers make real API calls |

No blockers or warnings found.

---

### Human Verification Required

The following items cannot be verified programmatically and require browser testing:

#### 1. Lead Click Flow (End-to-End)

**Test:** Log in as an email-gated user, search for an expert, click an expert card. Then log into the admin panel and navigate to the Leads tab. Expand the row for that user's email.
**Expected:** The "Expert Clicks" section shows the clicked expert's full name, the search query used, and a relative timestamp.
**Why human:** Requires a live browser session with actual email state set in `nltrStore`.

#### 2. Experts Page Expand — Lead Click Panel

**Test:** In admin Experts tab, click the chevron expand button on any expert row.
**Expected:** A "Lead Clicks" panel appears below the row showing any email-identified leads who clicked that expert, or "No lead clicks recorded" if none.
**Why human:** Requires DOM interaction and live API response to verify rendered output.

#### 3. Search Bar Visual Prominence

**Test:** Open the public marketplace page and observe the search input field.
**Expected:** The search bar has a noticeably thicker and darker border (2px slate-300) with a subtle shadow, making it easier to spot without changing the color palette.
**Why human:** Visual quality judgment — `border-2 border-slate-300 shadow-sm` is verified in code, but subjective "prominence" needs visual confirmation.

#### 4. AdminMarketplacePage Expert Name Display

**Test:** Navigate to Admin > Marketplace Intelligence > Exposure tab.
**Expected:** Expert column shows "First Last" full names instead of raw usernames, with raw username shown only for deleted experts.
**Why human:** Requires live data in the exposure table to confirm non-empty name display.

---

### Gaps Summary

No gaps found. All 15 observable truths verified, all 9 artifacts pass all three levels (exists, substantive, wired), and all 7 key links are confirmed active. The pre-launch reset script runs cleanly in dry-run mode against the real database.

---

_Verified: 2026-02-27T16:30:00Z_
_Verifier: Claude (gsd-verifier)_
