---
phase: 47-public-explorer-polish
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/store/filterSlice.ts
  - frontend/src/store/index.ts
  - frontend/src/pages/MarketplacePage.tsx
  - frontend/src/components/marketplace/ExpertList.tsx
autonomous: true
requirements:
  - EXP-03

must_haves:
  truths:
    - "User can toggle between card grid view and compact list view"
    - "Default view is grid (cards) for first-time visitors"
    - "View preference persists across page reloads via localStorage"
    - "Toggle uses icon + label buttons (Grid / List) in top-right of results area"
    - "List view shows expert name, job title, hourly rate, and domain tags per row"
  artifacts:
    - path: "frontend/src/store/filterSlice.ts"
      provides: "viewMode state field and setViewMode action"
      contains: "viewMode"
    - path: "frontend/src/store/index.ts"
      provides: "viewMode persistence via partialize"
      contains: "viewMode"
    - path: "frontend/src/components/marketplace/ExpertList.tsx"
      provides: "Compact list view with virtualized scrolling"
      contains: "Virtuoso"
    - path: "frontend/src/pages/MarketplacePage.tsx"
      provides: "View toggle toolbar and conditional grid/list rendering"
      contains: "viewMode"
  key_links:
    - from: "frontend/src/store/filterSlice.ts"
      to: "frontend/src/store/index.ts"
      via: "viewMode added to partialize for localStorage persistence"
      pattern: "viewMode.*state\\.viewMode"
    - from: "frontend/src/pages/MarketplacePage.tsx"
      to: "frontend/src/components/marketplace/ExpertList.tsx"
      via: "conditional render based on viewMode state"
      pattern: "viewMode.*list.*ExpertList"
---

<objective>
Add a grid/list view toggle to the Explorer results area. Users can switch between the existing card grid layout and a new compact list view. The view preference persists across page reloads via Zustand + localStorage.

Purpose: Some users want a denser expert listing to scan quickly — the list view shows name, job title, rate, and tags in a compact row. The card grid remains the default for discovery-oriented browsing.

Output: New ExpertList component, updated filterSlice with viewMode, toggle toolbar in MarketplacePage.
</objective>

<execution_context>
@/Users/sebastianhamers/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sebastianhamers/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@frontend/src/store/filterSlice.ts
@frontend/src/store/index.ts
@frontend/src/pages/MarketplacePage.tsx
@frontend/src/components/marketplace/ExpertGrid.tsx
@frontend/src/components/marketplace/ExpertCard.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add viewMode to filterSlice and persist in store</name>
  <files>frontend/src/store/filterSlice.ts, frontend/src/store/index.ts</files>
  <action>
**filterSlice.ts — add viewMode field and action:**

1. Add to `FilterSlice` interface:
```ts
viewMode: 'grid' | 'list'
setViewMode: (mode: 'grid' | 'list') => void
```

2. Add to `filterDefaults`:
```ts
viewMode: 'grid' as const,
```

3. Add to `createFilterSlice` actions:
```ts
setViewMode: (mode) => set({ viewMode: mode }),
```

**store/index.ts — add viewMode to partialize:**

Add `viewMode: state.viewMode` to the `partialize` return object (after `sortOrder`). This ensures the view preference is persisted to localStorage under the `explorer-filters` key.

Also add `viewMode` and `setViewMode` to the `useFilterSlice` hook's `useShallow` selector so consuming components can access it via the convenience hook.
  </action>
  <verify>
    <automated>cd /Users/sebastianhamers/Documents/TCS/frontend && npx vite build --mode production 2>&1 | tail -5</automated>
  </verify>
  <done>filterSlice has viewMode field defaulting to 'grid', setViewMode action exists, viewMode is in partialize selector, useFilterSlice returns viewMode and setViewMode</done>
</task>

<task type="auto">
  <name>Task 2: Create ExpertList component and add view toggle to MarketplacePage</name>
  <files>frontend/src/components/marketplace/ExpertList.tsx, frontend/src/pages/MarketplacePage.tsx</files>
  <action>
**ExpertList.tsx — NEW file: compact list view component:**

Create `frontend/src/components/marketplace/ExpertList.tsx` with:

1. Import `Virtuoso` from `react-virtuoso` (the 1D list export — different from `VirtuosoGrid` used in ExpertGrid).
2. Accept same props as ExpertGrid: `{ experts, loading, isFetchingMore, onEndReached, onViewProfile }`.
3. Apply the same `savedFilter` + `savedExperts` filtering logic as ExpertGrid (use `useFilterSlice`).
4. Each row renders a compact expert row showing:
   - Expert name (`first_name last_name`) — font-semibold text-sm
   - Job title — text-xs text-gray-500
   - Hourly rate (`currency hourly_rate/hr`) — text-xs font-semibold text-brand-purple
   - Domain tags (first 3) — small tag pills matching ExpertCard tag styling
5. Row is clickable — calls `onViewProfile(expert.profile_url)` directly (no tap-to-expand behavior in list view).
6. Row has hover state (bg-gray-50) and a subtle bottom border for separation.
7. Use `SkeletonGrid` for loading state (reuse existing; Claude may create a simple SkeletonList with 5 animated rows if the visual mismatch is too jarring — Claude's discretion on skeleton design).
8. Use `EmptyState` for zero results (same as ExpertGrid).
9. Footer shows loading indicator when `isFetchingMore` is true.
10. The Virtuoso `endReached` prop connects to `onEndReached` for infinite scroll parity with ExpertGrid.

**MarketplacePage.tsx — add toggle toolbar and conditional rendering:**

1. Import `LayoutGrid`, `List` from `lucide-react`.
2. Import `ExpertList` from `../components/marketplace/ExpertList`.
3. Read `viewMode` and `setViewMode` from `useFilterSlice()` (already destructured).
4. Add a toggle toolbar between the FilterChips and the results area (`<div className="flex-1 min-h-0 pt-2">`):

```tsx
{/* View mode toggle — top-right of results area, separate from filter controls */}
<div className="flex justify-end px-4 pb-1">
  <div className="flex gap-1 bg-gray-100 rounded-lg p-0.5">
    <button
      onClick={() => setViewMode('grid')}
      className={`flex items-center gap-1 px-2.5 py-1 rounded-md text-xs font-medium transition-colors ${
        viewMode === 'grid'
          ? 'bg-white text-gray-900 shadow-sm'
          : 'text-gray-500 hover:text-gray-700'
      }`}
    >
      <LayoutGrid size={14} /> Grid
    </button>
    <button
      onClick={() => setViewMode('list')}
      className={`flex items-center gap-1 px-2.5 py-1 rounded-md text-xs font-medium transition-colors ${
        viewMode === 'list'
          ? 'bg-white text-gray-900 shadow-sm'
          : 'text-gray-500 hover:text-gray-700'
      }`}
    >
      <List size={14} /> List
    </button>
  </div>
</div>
```

5. Replace the `<ExpertGrid ... />` render with a conditional:
```tsx
{viewMode === 'grid' ? (
  <ExpertGrid
    experts={experts}
    loading={loading}
    isFetchingMore={isFetchingMore}
    onEndReached={loadNextPage}
    onViewProfile={handleViewProfile}
  />
) : (
  <ExpertList
    experts={experts}
    loading={loading}
    isFetchingMore={isFetchingMore}
    onEndReached={loadNextPage}
    onViewProfile={handleViewProfile}
  />
)}
```

The toggle toolbar should be placed INSIDE the `<main>` element, after the FilterChips `<div>` and before the results `<div className="flex-1 min-h-0 pt-2">`.
  </action>
  <verify>
    <automated>cd /Users/sebastianhamers/Documents/TCS/frontend && npx vite build --mode production 2>&1 | tail -5</automated>
    <manual>Toggle between Grid and List views. Grid shows cards in 2-3 column layout. List shows compact rows with name, title, rate, tags. Switching persists on page reload.</manual>
  </verify>
  <done>ExpertList component renders compact rows with Virtuoso infinite scroll. MarketplacePage shows toggle toolbar in top-right. Grid/List toggle switches between ExpertGrid and ExpertList. View preference persists via localStorage.</done>
</task>

</tasks>

<verification>
1. `grep -rn "viewMode" frontend/src/store/filterSlice.ts` shows field, default, and action
2. `grep -n "viewMode" frontend/src/store/index.ts` shows partialize entry and useFilterSlice entry
3. `ls frontend/src/components/marketplace/ExpertList.tsx` exists
4. `grep -n "ExpertList" frontend/src/pages/MarketplacePage.tsx` shows conditional rendering
5. Vite production build succeeds without errors
</verification>

<success_criteria>
- viewMode field in filterSlice defaults to 'grid'
- viewMode persists in localStorage via partialize
- Toggle toolbar visible in results area with Grid/List buttons
- Active toggle button has white bg + shadow, inactive is gray
- ExpertList renders compact rows with name, job title, rate, domain tags
- ExpertList supports infinite scroll via Virtuoso endReached
- Switching between grid and list preserves view across page reload
- Build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/47-public-explorer-polish/47-02-SUMMARY.md`
</output>
