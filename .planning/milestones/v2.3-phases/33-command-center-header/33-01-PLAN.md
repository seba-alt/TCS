---
phase: 33-command-center-header
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/hooks/useHeaderSearch.ts
  - frontend/src/components/Header.tsx
autonomous: true
requirements: [HDR-01, HDR-02, HDR-03]

must_haves:
  truths:
    - "Header renders as a sticky glassmorphic frosted-glass panel with aurora radial gradient backdrop"
    - "Search bar shows animated placeholder text that fades between 6-8 playful phrases every 4-5s, paused when input has text"
    - "Search bar scales to 1.02 on focus via Framer Motion spring"
    - "A purple pulse dot appears left of the search icon while isStreaming is true, disappears when false"
    - "Typing 'tinrate' exactly triggers a 3-degree header tilt, emoji particle burst from logo corner, then clears the input"
    - "Expert count reads store.total and increments/decrements with spring physics"
    - "Logo has a soft purple drop-shadow glow"
  artifacts:
    - path: "frontend/src/hooks/useHeaderSearch.ts"
      provides: "All header search logic: debounce, placeholder rotation, easter egg detection, store bindings"
      exports: ["useHeaderSearch"]
    - path: "frontend/src/components/Header.tsx"
      provides: "Command Center header component with glassmorphism, animated search, count spring, Sage pulse, tilt easter egg"
      exports: ["default"]
  key_links:
    - from: "frontend/src/components/Header.tsx"
      to: "frontend/src/hooks/useHeaderSearch.ts"
      via: "useHeaderSearch() call at top of Header component"
      pattern: "useHeaderSearch"
    - from: "frontend/src/hooks/useHeaderSearch.ts"
      to: "frontend/src/store"
      via: "useExplorerStore selectors"
      pattern: "useExplorerStore"
    - from: "frontend/src/components/Header.tsx"
      to: "frontend/src/store"
      via: "useExplorerStore for isStreaming + total (spring count)"
      pattern: "useExplorerStore.*isStreaming|useExplorerStore.*total"
---

<objective>
Build the Command Center Header: a self-contained `useHeaderSearch.ts` hook and a fully-featured `Header.tsx` component that transforms the marketplace nav into a premium glassmorphic search interface with animated placeholders, Framer Motion interactions, spring-animated expert count, Sage-in-flight pulse, and the "tinrate" easter egg.

Purpose: The header is the first thing every user sees ‚Äî it must communicate intelligence, depth, and polish. The glassmorphism, animated search, and reactive count make the product feel alive.
Output: `useHeaderSearch.ts` (all logic) + `Header.tsx` (full component). These are standalone; integration into MarketplacePage happens in Plan 02.
</objective>

<execution_context>
@/Users/sebastianhamers/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sebastianhamers/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/33-command-center-header/33-CONTEXT.md
@.planning/phases/33-command-center-header/33-RESEARCH.md
@frontend/src/store/resultsSlice.ts
@frontend/src/store/pilotSlice.ts
@frontend/src/store/index.ts
@frontend/src/components/sidebar/EverythingIsPossible.tsx
@frontend/src/components/pilot/SageFAB.tsx
@frontend/src/components/sidebar/SearchInput.tsx
@frontend/src/pages/MarketplacePage.tsx
@frontend/tailwind.config.ts
@frontend/src/index.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useHeaderSearch.ts ‚Äî debounce, placeholder rotation, easter egg detection</name>
  <files>frontend/src/hooks/useHeaderSearch.ts</files>
  <action>
Create `frontend/src/hooks/useHeaderSearch.ts` with all header search logic extracted as a single hook. Follow the exact code shape from 33-RESEARCH.md Pattern 1 + the hook skeleton.

**Store bindings (read from useExplorerStore):**
- `query` (string) ‚Äî controlled input source of truth
- `setQuery` (fn) ‚Äî debounced write on change, immediate on Enter
- `total` (number) ‚Äî for count display (spring handled in Header.tsx)
- `isStreaming` (boolean) ‚Äî drives Sage pulse visibility
- `sageMode` (boolean) ‚Äî exposed for any conditional rendering in Header

**Placeholder rotation:**
- `PLACEHOLDERS` array with exactly 8 phrases (playful, brand-aligned):
  1. `'Find a fintech strategist‚Ä¶'`
  2. `'Who builds Stripe integrations?'`
  3. `'Need a fractional CTO for a week?'`
  4. `'Show me healthcare product experts‚Ä¶'`
  5. `'Which consultant actually ships?'`
  6. `'Find someone who\'s done this before‚Ä¶'`
  7. `'Looking for a Berlin-based advisor‚Ä¶'`
  8. `'Who knows Shopify like their backyard?'`
- `placeholderIndex` state starts at 0
- `useEffect` rotates every 4500ms via `setInterval`, clears on unmount
- **Pause condition:** `if (localValue) return` ‚Äî effect re-runs when localValue changes via dep array `[localValue]`

**Debounce pattern (from existing SearchInput.tsx, 350ms):**
- `localValue` useState initialized from `query`
- `timerRef = useRef<ReturnType<typeof setTimeout> | null>(null)` for debounce
- Sync local when store changes externally: `useEffect(() => { setLocalValue(query) }, [query])`
- `handleChange`: clear timer, set localValue, set new timer calling `setQuery(value)` after 350ms
- `handleKeyDown`: on Enter, clearTimeout + immediate `setQuery(localValue)`

**Easter egg detection:**
- Constant `EASTER_EGG_PHRASE = 'tinrate'`
- In `handleChange`, check `if (value.toLowerCase().trim() === EASTER_EGG_PHRASE)` BEFORE setting localValue
- On match: call `setLocalValue('')`, call `setQuery('')`, call `setTiltActive(true)`, call `setShowParticles(true)`, `setTimeout(() => setTiltActive(false), 800)`, `setTimeout(() => setShowParticles(false), 1000)`, then `return` (do not proceed to normal debounce)
- `tiltActive` and `showParticles` are useState booleans
- Fires every time ‚Äî no one-shot guard

**Return shape:**
```typescript
return {
  localValue,
  handleChange,
  handleKeyDown,
  placeholderIndex,
  placeholders: PLACEHOLDERS,
  total,
  isStreaming,
  sageMode,
  tiltActive,
  showParticles,
}
```

**Do NOT:** include sage confirmation modal logic (not in scope per CONTEXT.md), autocomplete suggestions (not in scope), or any direct DOM refs (leave refs to Header.tsx).

Import `trackEvent` from `'../tracking'` and call `void trackEvent('filter_change', { filter: 'query', value: value.trim() })` inside the debounce timer when `value.trim().length > 0`.
  </action>
  <verify>Run `cd /Users/sebastianhamers/Documents/TCS/frontend && npx tsc --noEmit 2>&1 | head -30` ‚Äî must show no errors in useHeaderSearch.ts. File must exist at `frontend/src/hooks/useHeaderSearch.ts`.</verify>
  <done>useHeaderSearch.ts exists, exports `useHeaderSearch`, TypeScript compiles without errors on the file. Hook returns all 9 fields listed in return shape.</done>
</task>

<task type="auto">
  <name>Task 2: Create Header.tsx ‚Äî glassmorphism, animated search, spring count, Sage pulse, tilt + particles easter egg</name>
  <files>frontend/src/components/Header.tsx</files>
  <action>
Rewrite `frontend/src/components/Header.tsx` as the Command Center header. The file currently serves the `/chat` route ‚Äî the new version will serve `/marketplace` (imported by MarketplacePage in Plan 02). The `/chat` route will see the new header too; this is acceptable per research notes (the `/chat` route is legacy/dev).

**Imports needed:**
```typescript
import { motion, AnimatePresence, useMotionValue, useSpring } from 'motion/react'
import { useEffect, useState, useRef } from 'react'
import { Search } from 'lucide-react'
import { useHeaderSearch } from '../hooks/useHeaderSearch'
import { useExplorerStore } from '../store'
```

**Component structure:**

1. **Call useHeaderSearch** at top ‚Äî destructure all return values.

2. **Expert count spring (useMotionValue + useSpring + subscription):**
   ```typescript
   const rawCount = useMotionValue(total)
   const springCount = useSpring(rawCount, { stiffness: 200, damping: 25 })
   const [displayCount, setDisplayCount] = useState(total)
   useEffect(() => { rawCount.set(total) }, [total, rawCount])
   useEffect(() => spring.on('change', (v) => setDisplayCount(Math.round(v))), [springCount])
   ```
   Display `displayCount` as text (a regular number).

3. **Tilt spring (motion.header rotate):**
   ```typescript
   const rotateX = useMotionValue(0)
   const rotate = useSpring(rotateX, { stiffness: 300, damping: 20 })
   useEffect(() => { rotateX.set(tiltActive ? 3 : 0) }, [tiltActive, rotateX])
   ```

4. **Particle positions pre-generated (useRef, not inline Math.random):**
   ```typescript
   const particlePositions = useRef(
     ['‚≠ê','‚ú®','üåü','üí´','‚≠ê','‚ú®','üåü'].map(() => ({
       x: (Math.random() - 0.5) * 100,
       y: -50 - Math.random() * 50,
     }))
   )
   ```

5. **logoRef for particle origin:**
   ```typescript
   const logoRef = useRef<HTMLImageElement>(null)
   ```

6. **Focus state for search bar scale:**
   ```typescript
   const [isFocused, setIsFocused] = useState(false)
   ```

7. **JSX structure:**

```tsx
<motion.header
  style={{ rotate }}
  className="hidden md:flex items-center gap-6 px-6 py-3 sticky top-0 z-50 backdrop-blur-md bg-white/70 border-b border-white/20"
  style={{ rotate, background: 'radial-gradient(circle at top right, rgba(139,92,246,0.09), transparent 60%)' }}
>
```

NOTE: `style` appears twice above ‚Äî merge them:
```tsx
<motion.header
  style={{
    rotate,
    background: 'radial-gradient(circle at top right, rgba(139,92,246,0.09) 0%, transparent 60%)',
  }}
  className="hidden md:flex items-center gap-6 px-6 py-3 sticky top-0 z-50 backdrop-blur-md bg-white/70 border-b border-white/20"
>
```

**Logo section:**
```tsx
<div className="relative shrink-0">
  <img
    ref={logoRef}
    src="/logo.png"
    alt="Tinrate"
    className="h-8 w-auto"
    style={{ filter: 'drop-shadow(0 0 15px rgba(139,92,246,0.30))' }}
  />
  {/* Particle burst ‚Äî AnimatePresence */}
  <AnimatePresence>
    {showParticles && particlePositions.current.map((pos, i) => (
      <motion.span
        key={i}
        initial={{ opacity: 1, x: 0, y: 0, scale: 1.2 }}
        animate={{ opacity: 0, x: pos.x, y: pos.y, scale: 0.5 }}
        exit={{ opacity: 0 }}
        transition={{ duration: 0.9, delay: i * 0.06, ease: 'easeOut' }}
        className="absolute top-0 left-4 pointer-events-none text-base z-50 select-none"
        aria-hidden="true"
      >
        {['‚≠ê','‚ú®','üåü','üí´','‚≠ê','‚ú®','üåü'][i]}
      </motion.span>
    ))}
  </AnimatePresence>
</div>
```

**Search bar section (flex-1 max-w-2xl mx-auto):**
```tsx
<motion.div
  animate={{ scale: isFocused ? 1.02 : 1 }}
  transition={{ type: 'spring', stiffness: 400, damping: 30 }}
  className="relative flex-1 max-w-2xl"
>
  {/* Sage in-flight pulse ‚Äî left of search icon */}
  <motion.div
    animate={{ opacity: isStreaming ? 1 : 0 }}
    transition={{ duration: 0.3 }}
    className="absolute left-3 top-1/2 -translate-y-1/2 w-2 h-2 rounded-full bg-brand-purple animate-pulse"
    aria-hidden="true"
  />
  {/* Search icon */}
  <Search
    className="absolute left-8 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400 pointer-events-none"
    aria-hidden="true"
  />
  {/* Animated placeholder overlay ‚Äî shown only when !localValue */}
  <AnimatePresence mode="wait">
    {!localValue && (
      <motion.span
        key={placeholderIndex}
        initial={{ opacity: 0 }}
        animate={{ opacity: 1 }}
        exit={{ opacity: 0 }}
        transition={{ duration: 0.3 }}
        className="absolute left-14 top-1/2 -translate-y-1/2 text-sm text-slate-400 pointer-events-none select-none truncate max-w-[calc(100%-4rem)]"
        aria-hidden="true"
      >
        {placeholders[placeholderIndex]}
      </motion.span>
    )}
  </AnimatePresence>
  {/* Controlled input */}
  <input
    type="text"
    value={localValue}
    onChange={handleChange}
    onKeyDown={handleKeyDown}
    onFocus={() => setIsFocused(true)}
    onBlur={() => setIsFocused(false)}
    className="w-full pl-14 pr-4 py-2.5 rounded-xl text-sm bg-white/50 border border-slate-200/50 shadow-sm focus:outline-none focus:ring-2 focus:ring-brand-purple/20 focus:border-brand-purple/40 transition-colors"
    aria-label="Search experts"
  />
</motion.div>
```

**Expert count display (right side):**
```tsx
<div className="shrink-0 text-sm text-slate-500 tabular-nums">
  <span className="font-semibold text-slate-700">{displayCount.toLocaleString()}</span>
  {' experts'}
</div>
```

**Do NOT include:**
- Sage confirmation modal
- Autocomplete dropdown
- Any MobileFilterSheet modifications (mobile layout unchanged)
- Changes to AuroraBackground.tsx

**After writing Header.tsx**, run `npx tsc --noEmit` to confirm no type errors before committing.
  </action>
  <verify>Run `cd /Users/sebastianhamers/Documents/TCS/frontend && npx tsc --noEmit 2>&1 | head -40` ‚Äî must show zero errors. Run `cd /Users/sebastianhamers/Documents/TCS/frontend && npm run build 2>&1 | tail -20` ‚Äî must exit 0.</verify>
  <done>Header.tsx exports a default React component. TypeScript and Vite build both pass. File contains: motion.header with rotate spring, AnimatePresence placeholder rotation, focus-scale motion.div, isStreaming pulse dot, displayCount spring subscription, logoRef with particle burst AnimatePresence, easter egg tilt wired via tiltActive.</done>
</task>

</tasks>

<verification>
1. `frontend/src/hooks/useHeaderSearch.ts` exists and exports `useHeaderSearch`
2. `frontend/src/components/Header.tsx` exists and exports a default component
3. `cd /Users/sebastianhamers/Documents/TCS/frontend && npx tsc --noEmit` exits 0
4. `cd /Users/sebastianhamers/Documents/TCS/frontend && npm run build` exits 0
5. Grep confirms: `useMotionValue` and `useSpring` present in Header.tsx
6. Grep confirms: `AnimatePresence` present in both files
7. Grep confirms: `isStreaming` referenced in useHeaderSearch.ts
8. Grep confirms: `EASTER_EGG_PHRASE` or `'tinrate'` in useHeaderSearch.ts
</verification>

<success_criteria>
- useHeaderSearch.ts: clean TypeScript, exports hook, returns 9 fields including tiltActive + showParticles
- Header.tsx: motion.header with rotate spring, placeholder AnimatePresence, focus scale, isStreaming pulse, spring count subscription, particle burst, glassmorphic className, aurora radial gradient via inline style
- Full TypeScript + Vite build passes (0 errors, 0 warnings on new files)
</success_criteria>

<output>
After completion, create `.planning/phases/33-command-center-header/33-01-SUMMARY.md` following the summary template at `/Users/sebastianhamers/.claude/get-shit-done/templates/summary.md`.
</output>
