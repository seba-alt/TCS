---
phase: 34-admin-platform-restructure
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/admin/pages/OverviewPage.tsx
autonomous: false
requirements:
  - ADM-R-03

must_haves:
  truths:
    - "OverviewPage renders a health strip (speedometer + KPI stat cards) above the fold"
    - "OverviewPage shows a Top Zero-Result Queries card (top 5 from /api/admin/events/demand) with a 'See all' link to /admin/gaps"
    - "OverviewPage shows a Sage Volume sparkline card (last 7 days from /events/trend) using Recharts LineChart"
    - "Top Zero-Result Queries card handles cold-start (no tracking data) and empty-data states without crashing"
    - "Sage Volume sparkline handles cold-start state without crashing"
    - "All above-the-fold content visible without scrolling on a standard 1280px wide display"
  artifacts:
    - path: "frontend/src/admin/pages/OverviewPage.tsx"
      provides: "Dashboard with health strip + two-column data cards"
      contains: "TopZeroResultsCard"
    - path: "frontend/src/admin/pages/OverviewPage.tsx"
      provides: "Sage sparkline"
      contains: "SageSparklineCard"
  key_links:
    - from: "frontend/src/admin/pages/OverviewPage.tsx"
      to: "/api/admin/events/demand"
      via: "adminFetch('/events/demand', { days: 30, page: 0, page_size: 5 })"
      pattern: "events/demand"
    - from: "frontend/src/admin/pages/OverviewPage.tsx"
      to: "/api/admin/events/trend"
      via: "useMarketplaceTrend()"
      pattern: "useMarketplaceTrend"
    - from: "TopZeroResultsCard"
      to: "/admin/gaps"
      via: "Link to='/admin/gaps'"
      pattern: "admin/gaps"
---

<objective>
Uplift OverviewPage.tsx into a strong first-impression dashboard: compact health strip at top, then a two-column grid showing Top Zero-Result Queries (left) and Sage Volume sparkline (right).

Purpose: The dashboard is the first page admins see. It should communicate the most important signal immediately — are there users finding nothing? How is Sage usage trending? — without requiring navigation.
Output: OverviewPage.tsx rewritten with TopZeroResultsCard and SageSparklineCard inline components, using existing hooks and the adminFetch helper. Human-verified at the live URL.
</objective>

<execution_context>
@/Users/sebastianhamers/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sebastianhamers/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/34-admin-platform-restructure/34-CONTEXT.md
@.planning/phases/34-admin-platform-restructure/34-RESEARCH.md
@frontend/src/admin/pages/OverviewPage.tsx
@frontend/src/admin/hooks/useAdminData.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rewrite OverviewPage with dashboard uplift</name>
  <files>frontend/src/admin/pages/OverviewPage.tsx</files>
  <action>
Rewrite `frontend/src/admin/pages/OverviewPage.tsx` with the new dashboard layout. Keep all existing components (Speedometer, StatCard, useHealthCheck) intact — only reorganise the layout and add two new inline components.

**New layout structure (outer OverviewPage return):**

```tsx
<div className="p-8 space-y-6">
  {/* Section 1: Health strip — Speedometer left-aligned, KPI cards right */}
  <div className="flex items-start gap-6">
    <div className="bg-slate-800/60 border border-slate-700/60 rounded-xl px-6 py-4 flex flex-col items-center gap-1 flex-shrink-0">
      <p className="text-xs font-semibold text-slate-500 uppercase tracking-wider mb-1">System</p>
      <Speedometer status={healthStatus} latency={latency} />
    </div>
    <div className="flex-1 grid grid-cols-2 xl:grid-cols-4 gap-4">
      <StatCard label="Total Searches" value={stats.total_searches} />
      <StatCard label="Matches" value={stats.match_count} sub={`${(stats.match_rate * 100).toFixed(1)}% match rate`} accent />
      <StatCard label="Match Rate" value={`${(stats.match_rate * 100).toFixed(1)}%`} />
      <StatCard label="Gaps" value={stats.gap_count} sub="queries needing improvement" />
    </div>
  </div>

  {/* Section 2: Two-column insight cards */}
  <div className="grid grid-cols-1 xl:grid-cols-2 gap-6">
    <TopZeroResultsCard />
    <SageSparklineCard />
  </div>

  {/* Section 3: Top Queries + Top Feedback (existing) */}
  <div className="grid grid-cols-1 xl:grid-cols-2 gap-6">
    {/* existing top queries card */}
    {/* existing top feedback card */}
  </div>
</div>
```

**TopZeroResultsCard** — define as a function before the OverviewPage default export:

```typescript
function TopZeroResultsCard() {
  const [data, setData] = useState<DemandResponse | null>(null)
  const [loading, setLoading] = useState(true)

  useEffect(() => {
    adminFetch<DemandResponse>('/events/demand', { days: 30, page: 0, page_size: 5 })
      .then(setData)
      .catch(() => setData(null))
      .finally(() => setLoading(false))
  }, [])

  const rows = data?.demand ?? []

  return (
    <div className="bg-slate-800/60 border border-slate-700/60 rounded-xl p-5">
      <div className="flex items-center justify-between mb-4">
        <h2 className="text-sm font-semibold text-white">Top Zero-Result Queries</h2>
        <Link to="/admin/gaps" className="text-xs text-purple-400 hover:text-purple-300 transition-colors">
          See all →
        </Link>
      </div>
      {loading ? (
        <p className="text-slate-500 text-sm animate-pulse">Loading…</p>
      ) : data?.data_since === null ? (
        <p className="text-slate-500 text-sm">No tracking data yet — insights appear after ~50 page views</p>
      ) : rows.length === 0 ? (
        <p className="text-slate-500 text-sm">No zero-result queries in the last 30 days</p>
      ) : (
        <div className="space-y-2">
          {rows.slice(0, 5).map((row, i) => (
            <div key={i} className="flex items-center justify-between">
              <span className="text-sm text-slate-300 truncate max-w-[75%]" title={row.query_text}>
                {row.query_text}
              </span>
              <span className="text-xs text-red-400 font-mono ml-2 flex-shrink-0">{row.frequency}×</span>
            </div>
          ))}
        </div>
      )}
    </div>
  )
}
```

IMPORTANT: Call `adminFetch` directly with `{ days: 30, page: 0, page_size: 5 }` — do NOT use `useMarketplaceDemand` (it hardcodes page_size: 25 and returns 25 rows, not 5). page: 0 is 0-indexed in the backend (OFFSET page * page_size).

**SageSparklineCard** — define as a function before the OverviewPage default export:

```typescript
function SageSparklineCard() {
  const { data, loading } = useMarketplaceTrend()
  const last7 = (data?.daily ?? []).slice(-7)

  return (
    <div className="bg-slate-800/60 border border-slate-700/60 rounded-xl p-5">
      <h2 className="text-sm font-semibold text-white mb-1">Sage Volume</h2>
      <p className="text-xs text-slate-500 mb-4">Last 7 days</p>
      {loading ? (
        <div className="h-16 flex items-center">
          <p className="text-slate-500 text-sm animate-pulse">Loading…</p>
        </div>
      ) : data?.data_since === null ? (
        <div className="h-16 flex items-center">
          <p className="text-slate-500 text-sm">No tracking data yet</p>
        </div>
      ) : (
        <>
          <div className="text-2xl font-bold text-white mb-3">
            {data?.kpis?.total_queries ?? 0}
            <span className="text-sm font-normal text-slate-500 ml-1.5">queries / 14d</span>
          </div>
          <ResponsiveContainer width="100%" height={56}>
            <LineChart data={last7}>
              <Line type="monotone" dataKey="total" stroke="#a855f7" strokeWidth={2} dot={false} />
              <Tooltip
                contentStyle={{
                  backgroundColor: '#0f172a',
                  border: '1px solid #334155',
                  borderRadius: '6px',
                  fontSize: '11px',
                }}
                labelStyle={{ color: '#94a3b8' }}
              />
            </LineChart>
          </ResponsiveContainer>
        </>
      )}
    </div>
  )
}
```

**Imports to add at top of OverviewPage.tsx:**
- `adminFetch, useMarketplaceTrend` from `'../hooks/useAdminData'`
- `Link` from `'react-router-dom'`
- `LineChart, Line, ResponsiveContainer, Tooltip` from `'recharts'`
- `DemandResponse` type from `'../types'`

The existing loading/error guards (`if (loading) return ...`, `if (error) return ...`, `if (!stats) return null`) stay as-is — they gate the KPI cards which need `stats`. TopZeroResultsCard and SageSparklineCard manage their own loading state internally and can render independently.

Keep the existing Top Searched Queries and Top Feedback cards as Section 3 below the new insight cards. Remove the old top-level flex layout that placed the speedometer in the top-right — integrate it into the new health strip row instead.
  </action>
  <verify>
    Run `cd /Users/sebastianhamers/Documents/TCS/frontend && npm run build` — zero TypeScript errors. Confirm: `grep -n "adminFetch\|useMarketplaceTrend\|LineChart\|TopZeroResultsCard\|SageSparklineCard" /Users/sebastianhamers/Documents/TCS/frontend/src/admin/pages/OverviewPage.tsx` — all five terms appear.
  </verify>
  <done>
    Build passes with zero TypeScript errors. OverviewPage.tsx contains TopZeroResultsCard (using adminFetch with page_size: 5, page: 0) and SageSparklineCard (using useMarketplaceTrend, slicing last 7 days). Both cards handle cold-start (data_since === null) and empty-data states gracefully.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Human verify full Phase 34 admin restructure at live URL</name>
  <action>
    Push all Phase 34 changes to git. Vercel auto-deploys on push to main — wait approximately 2 minutes for build to complete. Then verify all items in the checklist below.
  </action>
  <verify>
    All 9 items in the how-to-verify checklist confirmed visually at https://tcs-three-sigma.vercel.app/admin.
  </verify>
  <done>
    User types "approved" confirming all checklist items pass at the live URL.
  </done>
  <what-built>
    Full Phase 34 admin restructure: 3-section sidebar (8 items), ToolsPage with Score Explainer / Search Lab / Index tabs, DataPage with Searches / Marketplace tabs, route redirects, IndexPage migrated to Settings, OverviewPage dashboard with zero-result queries card and Sage sparkline.
  </what-built>
  <how-to-verify>
    Deploy is automatic on git push. Wait approximately 2 minutes after push for Vercel build to complete.

    1. Visit https://tcs-three-sigma.vercel.app/admin — log in, confirm landing on Overview dashboard
    2. Overview: Confirm health strip (speedometer + 4 KPI stat cards) visible above the fold, followed by two columns: "Top Zero-Result Queries" (left) and "Sage Volume" (right)
    3. Sidebar: Count nav items — exactly 8 total in 3 labeled sections (Analytics / Tools / Admin)
    4. Click "Data" in sidebar — Searches and Marketplace tabs appear; switching tabs changes the URL hash
    5. Click "Tools" in sidebar — Score Explainer is the default tab; switching to Search Lab and back to Score Explainer preserves the selected search
    6. Visit https://tcs-three-sigma.vercel.app/admin/search-lab directly — confirm redirect to /admin/tools
    7. Visit https://tcs-three-sigma.vercel.app/admin/searches directly — confirm redirect to /admin/data
    8. Click Settings in sidebar — confirm "Index Management" section with Rebuild Index button is present
    9. Confirm no standalone "Index" nav item exists in sidebar
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. `cd /Users/sebastianhamers/Documents/TCS/frontend && npm run build` — zero errors
2. `grep -n "TopZeroResultsCard\|SageSparklineCard\|useMarketplaceTrend\|adminFetch" /Users/sebastianhamers/Documents/TCS/frontend/src/admin/pages/OverviewPage.tsx` — all four present
3. `grep -n "page_size" /Users/sebastianhamers/Documents/TCS/frontend/src/admin/pages/OverviewPage.tsx` — confirms page_size: 5
4. Human verification at https://tcs-three-sigma.vercel.app/admin confirms all 9 checklist items pass
</verification>

<success_criteria>
- Overview dashboard shows Top Zero-Result Queries card (top 5, red frequency badges, "See all" link to /admin/gaps)
- Overview dashboard shows Sage Volume sparkline (7-day, purple line, Recharts LineChart)
- Both cards handle cold-start (data_since === null) gracefully with descriptive messages
- Frontend build passes with zero TypeScript errors
- Human verification at live URL passes all 9 checklist items
</success_criteria>

<output>
After completion, create `.planning/phases/34-admin-platform-restructure/34-02-SUMMARY.md`
</output>
