---
phase: 40.1-optimization-and-debugging-of-v3
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/components/browse/BrowseCard.tsx
  - frontend/src/components/browse/HeroBanner.tsx
  - frontend/src/components/sidebar/FilterSidebar.tsx
autonomous: true
requirements:
  - BROWSE-03
  - PHOTO-03

must_haves:
  truths:
    - "BrowseCard displays at a consistent fixed height (220px collapsed, 260px expanded) with photo/monogram filling the card correctly"
    - "HeroBanner always shows an abstract branded gradient — no expert profile photos attempted"
    - "Text on BrowseCard (name, rate, tags) is clearly readable against all backgrounds"
    - "FilterSidebar 'Domain Tags' label is visible against the glass-surface background"
    - "Card images below the fold lazy-load instead of fetching all 40+ simultaneously on mount"
  artifacts:
    - path: "frontend/src/components/browse/BrowseCard.tsx"
      provides: "Fixed-height card with lazy-loaded images and improved text contrast"
      contains: "initial={{ height: 220 }}"
    - path: "frontend/src/components/browse/HeroBanner.tsx"
      provides: "Abstract gradient hero banner without photo branch"
      contains: "HERO_GRADIENTS"
    - path: "frontend/src/components/sidebar/FilterSidebar.tsx"
      provides: "Visible Domain Tags label"
      contains: "text-gray-500"
  key_links:
    - from: "frontend/src/components/browse/BrowseCard.tsx"
      to: "motion.div initial/animate"
      via: "motion.react height animation"
      pattern: "initial=\\{\\{ height: 220 \\}\\}"
    - from: "frontend/src/components/browse/BrowseCard.tsx"
      to: "img loading attribute"
      via: "native lazy loading"
      pattern: 'loading="lazy"'
---

<objective>
Fix the three most visible bugs on the Browse page: BrowseCard sizing/layout broken by minHeight vs height conflict, HeroBanner attempting to use portrait profile photos as wide banner imagery, and low text contrast on card overlays. Also fix the invisible FilterSidebar label and add native lazy loading to card images.

Purpose: These bugs make the Browse page look broken on first impression — cards render inconsistently, the hero banner fails to load photos, and text is hard to read. Fixing them is prerequisite to any visual polish work.

Output: BrowseCard.tsx, HeroBanner.tsx, and FilterSidebar.tsx with all layout and contrast bugs resolved.
</objective>

<execution_context>
@/Users/sebastianhamers/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sebastianhamers/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/40.1-optimization-and-debugging-of-v3/40.1-RESEARCH.md

@frontend/src/components/browse/BrowseCard.tsx
@frontend/src/components/browse/HeroBanner.tsx
@frontend/src/components/sidebar/FilterSidebar.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix BrowseCard height, text contrast, and image lazy loading</name>
  <files>frontend/src/components/browse/BrowseCard.tsx</files>
  <action>
Fix three issues in BrowseCard.tsx:

**1. Height fix (CRITICAL):**
- Remove `minHeight: 220` from the `style` prop on the root `motion.div`
- Add `initial={{ height: 220 }}` to give the motion.div a definite initial height (required for `absolute inset-0` children to render correctly)
- Keep `animate={{ height: expanded ? 260 : 220 }}` as-is — it will now animate from the `initial` value
- Keep `style={{ width: 160 }}` (width only, no height in style)

The root cause: `minHeight` does NOT create a fixed containing block for absolutely-positioned children. The `<img>` with `absolute inset-0` needs a parent with a definite `height`. Using `initial={{ height: 220 }}` from motion.react provides this.

**2. Text contrast improvement:**
- Change the bottom overlay gradient from `from-black/70 via-black/40 to-transparent` to `from-black/85 via-black/55 to-transparent` — darker gradient ensures name/rate are readable over any photo brightness
- Change rate text from `text-purple-300` to `text-purple-200` — brighter purple for better contrast on dark overlay
- Change tag pill classes from `bg-white/20 text-white/90` to `bg-white/30 text-white` — more opaque background and full white text
- Increase padding on overlay from `p-2.5` to `p-3` for breathing room

**3. Image lazy loading:**
- Add `loading="lazy"` and `decoding="async"` attributes to the `<img>` element
- This is a one-line addition — browser-native lazy loading defers image fetch for cards outside the viewport
- Cards in the first visible row still load eagerly (browser ignores `lazy` for above-fold content)
  </action>
  <verify>
    <automated>cd /Users/sebastianhamers/Documents/TCS/frontend && npx tsc --noEmit --pretty 2>&1 | head -30</automated>
    <manual>Open localhost:5173, verify BrowseCards show at consistent 220px height with photos filling the card, text is readable on all cards, and Network tab shows images loading lazily for below-fold rows</manual>
  </verify>
  <done>BrowseCard renders at exactly 220px collapsed / 260px expanded with photos filling via absolute positioning. Text overlay is dark enough for clear name/rate/tag readability. Images below the fold lazy-load.</done>
</task>

<task type="auto">
  <name>Task 2: Replace HeroBanner photo logic with abstract branded gradient</name>
  <files>frontend/src/components/browse/HeroBanner.tsx</files>
  <action>
Per locked decision: replace photo-based hero with abstract/branded hero.

**Remove the photo conditional branch entirely.** Currently lines 61-71 have:
```tsx
{current.photo_url ? (
  <img src={current.photo_url} ... />
) : (
  <div className={`w-full h-full bg-gradient-to-br ${HERO_GRADIENTS[gradientIdx]}`} />
)}
```

Replace with the gradient-only version:
```tsx
<div className={`w-full h-full bg-gradient-to-br ${HERO_GRADIENTS[gradientIdx]}`} />
```

This also closes the `API_BASE` prefix bug (Pitfall 3 from research) — `src={current.photo_url}` was missing the API_BASE prefix, but since we're removing the photo branch entirely, the bug is closed by deletion.

Keep everything else unchanged:
- Keep the dark readability overlay (`bg-gradient-to-r from-black/80 via-black/40 to-transparent`)
- Keep the expert info overlay (name, job title, company)
- Keep the "Explore All Experts" CTA button
- Keep the carousel indicator dots
- Keep the AnimatePresence transitions
- Keep the HERO_GRADIENTS palette (brand-aligned purple/indigo range)

The HERO_GRADIENTS array uses deep purple/indigo/violet tones that align with the brand accent color #5128F2.
  </action>
  <verify>
    <automated>cd /Users/sebastianhamers/Documents/TCS/frontend && npx tsc --noEmit --pretty 2>&1 | head -30</automated>
    <manual>Open localhost:5173, verify hero banner always shows a gradient background (never an img tag), expert info text is visible, carousel rotates every 5s, and "Explore All Experts" button works</manual>
  </verify>
  <done>HeroBanner always renders a branded gradient background. No photo_url conditional. No img tag in the hero section. Expert info and CTA remain functional.</done>
</task>

<task type="auto">
  <name>Task 3: Fix FilterSidebar invisible Domain Tags label</name>
  <files>frontend/src/components/sidebar/FilterSidebar.tsx</files>
  <action>
Fix the invisible "Domain Tags" label in the FilterControls component.

**Current (line 39):** `text-white/60` — white text at 60% opacity on a white glass-surface background. Invisible.

**Change to:** `text-gray-500` — matches the "Hourly Rate" label on line 35 which already uses `text-gray-500` and is visible.

This is a single class change:
```tsx
// Before
<span className="text-xs font-medium text-white/60 uppercase">Domain Tags</span>

// After
<span className="text-xs font-medium text-gray-500 uppercase">Domain Tags</span>
```

This was identified as Pitfall 4 in the research — glass-surface on the light aurora background means white text is invisible.
  </action>
  <verify>
    <automated>cd /Users/sebastianhamers/Documents/TCS/frontend && grep -n "text-gray-500" src/components/sidebar/FilterSidebar.tsx | head -5</automated>
    <manual>Open localhost:5173/explore, verify "Domain Tags" label is visible in the sidebar filter panel</manual>
  </verify>
  <done>"Domain Tags" label uses text-gray-500, matching "Hourly Rate" label style, and is clearly visible against the glass-surface background.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. BrowseCard height is consistent across all cards in every row (no height variance)
3. HeroBanner shows gradient backgrounds only — no `<img>` in the hero section DOM
4. Card text (name, rate, tags) is readable against both photo and monogram backgrounds
5. FilterSidebar "Domain Tags" label is visible
6. Card images lazy-load (Network tab shows deferred requests for below-fold cards)
</verification>

<success_criteria>
- All three BrowseCard bugs resolved (height, contrast, lazy loading)
- HeroBanner uses abstract gradient only — photo branch deleted
- FilterSidebar label visible against glass-surface
- TypeScript compiles without errors
- No visual regressions in existing functionality
</success_criteria>

<output>
After completion, create `.planning/phases/40.1-optimization-and-debugging-of-v3/40.1-01-SUMMARY.md`
</output>
