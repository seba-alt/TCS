---
phase: 40.2-uat-fixes-and-browse-explorer-enhancements
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/components/browse/BrowseCard.tsx
  - frontend/src/components/browse/BrowseRow.tsx
  - frontend/src/components/marketplace/FilterChips.tsx
autonomous: true
requirements: []
gap_closure: true

must_haves:
  truths:
    - "BrowseCards have name, rate, tags consistently aligned at bottom regardless of tag count"
    - "First card in Browse row sits visibly past the left fade overlay edge on all breakpoints"
    - "Clear All pill appears when Sage search is active (sageMode=true) even with no filter chips"
  artifacts:
    - path: "frontend/src/components/browse/BrowseCard.tsx"
      provides: "Bottom-pinned name/rate with tags growing upward"
      contains: "flex-col-reverse"
    - path: "frontend/src/components/browse/BrowseRow.tsx"
      provides: "Scroll padding exceeding fade overlay width"
      contains: "pl-20"
    - path: "frontend/src/components/marketplace/FilterChips.tsx"
      provides: "Clear All visible in sage mode"
      contains: "sageMode"
  key_links:
    - from: "BrowseCard.tsx overlay"
      to: "name/rate visual position"
      via: "flex-col-reverse puts name/rate at flex-end (visually bottom), tags grow upward"
      pattern: "flex-col-reverse"
    - from: "FilterChips.tsx Clear All condition"
      to: "sageMode store value"
      via: "OR condition includes sageMode"
      pattern: "chips\\.length > 0 \\|\\| sageMode"
---

<objective>
Fix three UAT-reported visual/interaction bugs from phase 40.2 testing: BrowseCard name/rate vertical misalignment caused by opacity-hidden tags occupying layout space, first Browse card obscured by left fade overlay due to insufficient scroll padding, and Clear All pill missing when Sage search is active.

Purpose: Close UAT gaps 1, 2, and 7 so Browse and Explorer pass user acceptance testing.
Output: Three targeted code fixes in BrowseCard.tsx, BrowseRow.tsx, and FilterChips.tsx.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/40.2-uat-fixes-and-browse-explorer-enhancements/40.2-01-SUMMARY.md
@.planning/phases/40.2-uat-fixes-and-browse-explorer-enhancements/40.2-02-SUMMARY.md
@.planning/debug/browse-card-name-rate-misalignment.md
@.planning/debug/browse-row-first-card-behind-fade.md
@.planning/debug/clear-all-pill-sage-mode.md
@frontend/src/components/browse/BrowseCard.tsx
@frontend/src/components/browse/BrowseRow.tsx
@frontend/src/components/marketplace/FilterChips.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix BrowseCard bottom alignment and BrowseRow left padding</name>
  <files>
    frontend/src/components/browse/BrowseCard.tsx
    frontend/src/components/browse/BrowseRow.tsx
  </files>
  <action>
    **BrowseCard.tsx — Fix name/rate misalignment (debug session: browse-card-name-rate-misalignment.md)**

    Root cause: The overlay div (line 94) uses `flex flex-col justify-end`, but the container has no fixed height — it shrink-wraps its content, making `justify-end` inert. Tags use `opacity-0` (not `display:none`), so they always occupy layout space. Cards with different tag counts have different overlay heights, causing name/rate to sit at different vertical positions.

    Fix using Option B from the debug session (recommended — minimal diff):
    1. In the overlay div (line 94), change `flex flex-col justify-end` to `flex flex-col-reverse justify-end`.
    2. Move the tags `<div>` (lines 101-116) ABOVE the rate `<p>` and name `<p>` in the JSX source order. With `flex-col-reverse`, the visual order will be: name at bottom, rate above name, tags above rate — but since DOM order is reversed for layout, name/rate pin to the flex-end (bottom) and tags grow upward into the gradient.
    3. Verify: After reorder, the visual stacking from bottom-up should be: name, rate, tags. The `mb-0.5` on the rate `<p>` (line 96-98) may need to become `mt-0.5` since direction is reversed — check spacing visually.

    IMPORTANT: With `flex-col-reverse`, the DOM order should be: tags first, then rate, then name. Visual rendering will be name at bottom, rate above, tags above rate. This ensures cards with 0, 1, 2, or 3 tags all have name/rate at the same absolute bottom position.

    **BrowseRow.tsx — Fix first card left spacing (debug session: browse-row-first-card-behind-fade.md)**

    Root cause: Left fade overlay is `w-16` (64px). Scroll padding is `pl-8` (32px) on mobile and `pl-16` (64px) on desktop. Mobile: first card starts 32px into the 64px gradient. Desktop: card starts exactly at fade edge, still partially obscured by gradient.

    Fix:
    1. On line 69, change `pl-8 md:pl-16` to `pl-20` (80px = 5rem on all breakpoints). This gives 16px clearance past the 64px fade overlay on all screen sizes. A single value is simpler and the 80px padding works on mobile too since cards are 160px wide.
    2. Keep the right padding as-is (`pr-4 md:pr-8`) — the right fade overlay is fine since users scroll into it intentionally.
  </action>
  <verify>
    <automated>cd /Users/sebastianhamers/Documents/TCS && npx tsc --noEmit --project frontend/tsconfig.json 2>&1 | head -20</automated>
    <manual>Open Browse page. Compare two cards with different tag counts — name and rate should be at the same vertical position. First card in every row should be fully visible past the left fade.</manual>
  </verify>
  <done>BrowseCards in a row have name/rate at the same bottom position regardless of tag count. First card in each Browse row clears the left fade overlay on both mobile and desktop.</done>
</task>

<task type="auto">
  <name>Task 2: Show Clear All pill when Sage search is active</name>
  <files>frontend/src/components/marketplace/FilterChips.tsx</files>
  <action>
    **FilterChips.tsx — Fix Clear All visibility in Sage mode (debug session: clear-all-pill-sage-mode.md)**

    Root cause: Clear All button renders only when `chips.length > 0` (line 94). Sage search bypasses filter fields entirely — it injects results via `setResults()` + `setSageMode(true)` without touching query/tags/rate. So `chips.length` stays 0 and Clear All never shows.

    Fix:
    1. On line 94, change `{chips.length > 0 && (` to `{(chips.length > 0 || sageMode) && (`. The `sageMode` value is already read from the store on line 26.
    2. The button's `onClick` calls `resetFilters()` which already calls `setSageMode(false)` inside filterSlice.ts (line 74-77), so clicking Clear All during Sage mode correctly exits Sage mode and resets all filters. No additional wiring needed.

    That is the ONLY change in this file for this task. Do NOT modify the savedCount logic, early-return guard, or Saved pill — those are addressed in the next plan (40.2-04).
  </action>
  <verify>
    <automated>cd /Users/sebastianhamers/Documents/TCS && npx tsc --noEmit --project frontend/tsconfig.json 2>&1 | head -20</automated>
    <manual>On Explorer, use Sage to search. Sage results appear. Verify "Clear all" red pill is visible. Click it — results reset to full 530 expert list.</manual>
  </verify>
  <done>Clear All pill is visible when Sage search is active (sageMode=true). Clicking it exits Sage mode and resets to full expert list.</done>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors: `npx tsc --noEmit --project frontend/tsconfig.json`
2. Dev server starts: `cd frontend && npx vite --port 5173` (visual check)
3. Browse page: cards in a row have consistent name/rate alignment regardless of tags
4. Browse page: first card in every row is fully visible past left gradient fade
5. Explorer: Sage search shows Clear All pill, clicking it resets results
</verification>

<success_criteria>
- UAT Test 1 (BrowseCard alignment): name and rate at same height across all cards in a row
- UAT Test 2 (First card left spacing): first card content fully past the left fade overlay
- UAT Test 7 (Clear All with Sage): red Clear All pill visible during active Sage search
</success_criteria>

<output>
After completion, create `.planning/phases/40.2-uat-fixes-and-browse-explorer-enhancements/40.2-03-SUMMARY.md`
</output>
