---
phase: 34-admin-platform-restructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/admin/components/AdminSidebar.tsx
  - frontend/src/admin/pages/SettingsPage.tsx
  - frontend/src/admin/pages/ToolsPage.tsx
  - frontend/src/admin/pages/DataPage.tsx
  - frontend/src/admin/pages/LeadsPage.tsx
  - frontend/src/main.tsx
autonomous: true
requirements:
  - ADM-R-01
  - ADM-R-02

must_haves:
  truths:
    - "Admin sidebar shows exactly 8 nav items in 3 labeled sections: Analytics (Overview, Gaps, Intelligence, Data), Tools (Tools), Admin (Experts, Leads, Settings)"
    - "Navigating to /admin/tools shows Score Explainer tab by default, with Search Lab and Index tabs accessible via URL hash"
    - "Navigating to /admin/data shows Searches and Marketplace as tabs, with hash-driven tab switching"
    - "Old URLs /admin/search-lab, /admin/score-explainer, /admin/index, /admin/searches, /admin/marketplace all redirect to their consolidated pages"
    - "Re-index functionality (full IndexPage UI: status badge, timestamps, rebuild button, about section) lives under Settings > Index Management"
    - "IndexPage.tsx is deleted after content migrated"
    - "Navigating from Leads to a specific email pre-fills the Searches tab in DataPage (location.state.email forwarded)"
  artifacts:
    - path: "frontend/src/admin/components/AdminSidebar.tsx"
      provides: "3-section grouped sidebar with NAV_GROUPS typed structure"
      contains: "NAV_GROUPS"
    - path: "frontend/src/admin/pages/ToolsPage.tsx"
      provides: "Score Explainer / Search Lab / Index tabs via URL hash"
      exports: ["default"]
    - path: "frontend/src/admin/pages/DataPage.tsx"
      provides: "Searches / Marketplace tabs via URL hash"
      exports: ["default"]
    - path: "frontend/src/admin/pages/SettingsPage.tsx"
      provides: "Index Management section with full rebuild UI"
      contains: "Index Management"
    - path: "frontend/src/main.tsx"
      provides: "Route redirects + new /admin/tools and /admin/data routes"
      contains: "Navigate"
  key_links:
    - from: "frontend/src/admin/components/AdminSidebar.tsx"
      to: "/admin/tools"
      via: "NavLink to='/admin/tools'"
      pattern: "to.*admin/tools"
    - from: "frontend/src/admin/components/AdminSidebar.tsx"
      to: "/admin/data"
      via: "NavLink to='/admin/data'"
      pattern: "to.*admin/data"
    - from: "frontend/src/admin/pages/ToolsPage.tsx"
      to: "ScoreExplainerPage, SearchLabPage"
      via: "CSS hidden class preserving component state"
      pattern: "hidden"
    - from: "frontend/src/admin/pages/LeadsPage.tsx"
      to: "/admin/data#searches"
      via: "navigate('/admin/data#searches', { state: { email } })"
      pattern: "admin/data"
---

<objective>
Restructure admin navigation from 11 flat items to 8 grouped items in 3 sections, create ToolsPage (Score Explainer / Search Lab / Index tabs) and DataPage (Searches / Marketplace tabs), migrate IndexPage content into Settings, and set up all route redirects.

Purpose: Replace the "junk drawer" sidebar with clear IA — Analytics data is front-and-centre, operational tools are consolidated, and removed pages redirect cleanly.
Output: AdminSidebar.tsx (3-section groups), ToolsPage.tsx (new), DataPage.tsx (new), SettingsPage.tsx (expanded), main.tsx (routes updated), LeadsPage.tsx (navigate target updated), IndexPage.tsx (deleted).
</objective>

<execution_context>
@/Users/sebastianhamers/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sebastianhamers/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/34-admin-platform-restructure/34-CONTEXT.md
@.planning/phases/34-admin-platform-restructure/34-RESEARCH.md
@frontend/src/admin/components/AdminSidebar.tsx
@frontend/src/admin/pages/IndexPage.tsx
@frontend/src/admin/pages/SettingsPage.tsx
@frontend/src/admin/pages/LeadsPage.tsx
@frontend/src/main.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Restructure AdminSidebar and create ToolsPage + DataPage</name>
  <files>
    frontend/src/admin/components/AdminSidebar.tsx
    frontend/src/admin/pages/ToolsPage.tsx
    frontend/src/admin/pages/DataPage.tsx
  </files>
  <action>
**AdminSidebar.tsx** — Replace flat NAV_ITEMS array + slice-based sections with a typed NAV_GROUPS structure:

Define these interfaces at the top:
```typescript
interface NavItem { to: string; label: string; end?: boolean; icon: React.ReactNode }
interface NavGroup { label: string; items: NavItem[] }
```

Define NAV_GROUPS with exactly 3 groups and 8 total items:
- Group "Analytics": Overview (end: true), Gaps, Intelligence, Data (to: '/admin/data')
- Group "Tools": Tools (to: '/admin/tools')
- Group "Admin": Experts, Leads, Settings

Keep all existing SVG icons; reuse them from the current NAV_ITEMS. For the new "Data" item use the existing Marketplace bar-chart SVG icon (currently on the Marketplace nav item). For "Tools" item use the Search Lab monitor SVG icon.

Render using:
```tsx
{NAV_GROUPS.map((group, gi) => (
  <div key={group.label} className={gi > 0 ? 'mt-4' : ''}>
    <p className="px-3 pb-2 pt-2 text-xs font-semibold text-slate-600 uppercase tracking-wider">
      {group.label}
    </p>
    {group.items.map(({ to, label, end, icon }) => (
      <NavLink key={to} to={to} end={end} className={({ isActive }) =>
        `flex items-center gap-3 px-3 py-2 rounded-lg text-sm font-medium transition-all ${
          isActive
            ? 'bg-purple-600 text-white shadow-lg shadow-purple-500/20'
            : 'text-slate-400 hover:text-white hover:bg-slate-800'
        }`
      }>
        {icon}{label}
      </NavLink>
    ))}
  </div>
))}
```
Keep the brand block and logout button exactly as they are.

---

**ToolsPage.tsx** — Create new file at `frontend/src/admin/pages/ToolsPage.tsx`:

```typescript
import { useLocation, useNavigate } from 'react-router-dom'
import ScoreExplainerPage from './ScoreExplainerPage'
import SearchLabPage from './SearchLabPage'
import IndexPage from './IndexPage'

type ToolTab = 'score-explainer' | 'search-lab' | 'index'
const TABS: { id: ToolTab; label: string }[] = [
  { id: 'score-explainer', label: 'Score Explainer' },
  { id: 'search-lab', label: 'Search Lab' },
  { id: 'index', label: 'Index' },
]
```

- Derive activeTab from `location.hash.replace('#', '')`, defaulting to `'score-explainer'` if hash is not a valid tab id
- Tab switching: `navigate('/admin/tools#' + id, { replace: true })`
- Tab bar: underline style — active tab has `border-b-2 border-purple-500 text-white -mb-px`, inactive has `border-b-2 border-transparent text-slate-400 hover:text-slate-200`
- Tab content: use CSS `hidden` class (NOT conditional render) to keep ScoreExplainerPage and SearchLabPage mounted and preserve their state
- The Index tab renders IndexPage directly (temporarily — it will be removed in Task 2 after IndexPage content migrates)
- Wrapper div: `className="flex-1 overflow-auto"` with inner `className="p-0"` (child pages handle their own padding)
- Page header ("Tools" title + subtitle) above the tab bar

---

**DataPage.tsx** — Create new file at `frontend/src/admin/pages/DataPage.tsx`:

```typescript
import { useLocation, useNavigate } from 'react-router-dom'
import SearchesPage from './SearchesPage'
import AdminMarketplacePage from './AdminMarketplacePage'

type DataTab = 'searches' | 'marketplace'
const TABS: { id: DataTab; label: string }[] = [
  { id: 'searches', label: 'Searches' },
  { id: 'marketplace', label: 'Marketplace' },
]
```

- Derive activeTab from `location.hash.replace('#', '')`, defaulting to `'searches'`
- Tab switching: `navigate('/admin/data#' + id, { replace: true })`
- Same underline tab bar style as ToolsPage
- Tab content: use CSS `hidden` class for both tabs
- IMPORTANT: DataPage reads `location.state?.email` and stores in a ref. When activeTab is `'searches'`, pass `emailFilter` as a prop to SearchesPage IF SearchesPage accepts such a prop. If SearchesPage reads `location.state` directly via `useLocation()`, the state will be available because DataPage is the rendered route component (location.state on the DataPage route = location.state the child sees via useLocation). No special forwarding needed — both DataPage and SearchesPage call `useLocation()` and will see the same location object. Verify by reading SearchesPage to confirm it uses `useLocation().state?.email`.
- No page title/header needed — the tab bar itself is sufficient context
  </action>
  <verify>
    Run `cd /Users/sebastianhamers/Documents/TCS/frontend && npm run build` — build must pass with zero TypeScript errors. Confirm ToolsPage.tsx and DataPage.tsx exist at `frontend/src/admin/pages/`. Confirm AdminSidebar.tsx contains `NAV_GROUPS` and no longer contains `NAV_ITEMS` or `slice`.
  </verify>
  <done>
    Build passes. AdminSidebar uses NAV_GROUPS with 3 sections (Analytics, Tools, Admin) and 8 items. ToolsPage.tsx and DataPage.tsx exist and import correctly. No TypeScript errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate IndexPage into Settings, update routes, fix Leads navigation, delete IndexPage</name>
  <files>
    frontend/src/admin/pages/SettingsPage.tsx
    frontend/src/admin/pages/ToolsPage.tsx
    frontend/src/admin/pages/LeadsPage.tsx
    frontend/src/main.tsx
  </files>
  <action>
**SettingsPage.tsx** — Replace the existing simplified FAISS section (lines 57-96) with a full "Index Management" section that mirrors the complete IndexPage.tsx UI:

- Replace the "FAISS Index" section heading with "Index Management"
- Copy the STATUS_CONFIG constant and formatTs helper from IndexPage.tsx into SettingsPage.tsx (as local constants before the component)
- The new section contains two cards (same as IndexPage):
  1. "Rebuild Status" card: status badge with STATUS_CONFIG colors, timestamps grid (Last rebuild, Experts at rebuild, Started at), error display, Rebuild Index button
  2. "About Index Rebuilds" card: the 3-bullet list about tagging, FAISS rebuild, and atomic hot-swap
- The `useIngestStatus` hook is already imported — the `ingest` and `triggerRun` values are already available in the component
- Keep all other existing SettingsPage sections (System, Scoring, Session) unchanged
- Use `handleRebuild = () => triggerRun('/ingest/run')` — same as IndexPage

**ToolsPage.tsx** — Update the Index tab to NOT import IndexPage directly. Instead, create an inline `IndexManagementPanel` component within ToolsPage.tsx that contains the same rebuild UI (STATUS_CONFIG, formatTs, status badge, timestamps, rebuild button, about list). Import `useIngestStatus` from `'../hooks/useAdminData'`. This avoids the now-deleted IndexPage dependency.

Alternatively (simpler): Extract the index UI into `frontend/src/admin/components/IndexManagementPanel.tsx` and import it in both ToolsPage and SettingsPage. This is the recommended approach from the research doc. Create `IndexManagementPanel.tsx` as a standalone component that accepts no props and uses `useIngestStatus` internally. Then:
- ToolsPage imports and uses `<IndexManagementPanel />` in its Index tab
- SettingsPage uses `<IndexManagementPanel />` in the Index Management section (replacing the inline content described above)
- Remove the STATUS_CONFIG / formatTs duplication

**LeadsPage.tsx** — Find the line where it calls `navigate('/admin/searches', ...)` (around line 50-80 where an email link is clicked). Change the target to `/admin/data#searches`:
```typescript
// Before:
navigate('/admin/searches', { state: { email: row.email } })
// After:
navigate('/admin/data#searches', { state: { email: row.email } })
```
This ensures `location.state.email` is forwarded correctly since DataPage is now the route that renders SearchesPage.

**main.tsx** — Add the new consolidated routes and replace old standalone routes with redirects:

Add imports for ToolsPage and DataPage at the top.
Remove imports for IndexPage, SearchesPage, ScoreExplainerPage, SearchLabPage, AdminMarketplacePage (they are now embedded inside ToolsPage/DataPage — no longer needed as direct route targets).

Inside the `/admin` children array, replace the old routes with:
```typescript
// New consolidated pages
{ path: 'tools', element: <ToolsPage /> },
{ path: 'data',  element: <DataPage /> },
// Redirects from old standalone URLs
{ path: 'search-lab',      element: <Navigate to="/admin/tools" replace /> },
{ path: 'score-explainer', element: <Navigate to="/admin/tools" replace /> },
{ path: 'index',           element: <Navigate to="/admin/tools" replace /> },
{ path: 'searches',        element: <Navigate to="/admin/data" replace /> },
{ path: 'marketplace',     element: <Navigate to="/admin/data" replace /> },
```
Keep the existing routes for gaps, leads, experts, settings, intelligence unchanged.

**Delete IndexPage.tsx** — After confirming SettingsPage and ToolsPage both use IndexManagementPanel, delete `frontend/src/admin/pages/IndexPage.tsx`. Use the Bash tool: `rm /Users/sebastianhamers/Documents/TCS/frontend/src/admin/pages/IndexPage.tsx`
  </action>
  <verify>
    Run `cd /Users/sebastianhamers/Documents/TCS/frontend && npm run build` — build must pass with zero TypeScript errors. Confirm IndexPage.tsx no longer exists: `ls frontend/src/admin/pages/IndexPage.tsx` should return "No such file". Confirm main.tsx no longer imports IndexPage. Confirm SettingsPage.tsx contains "Index Management".
  </verify>
  <done>
    Build passes. IndexPage.tsx deleted. SettingsPage has full Index Management section using IndexManagementPanel. ToolsPage Index tab uses IndexManagementPanel. main.tsx has redirect routes for all 5 retired URLs. LeadsPage navigate target is /admin/data#searches. No TypeScript errors.
  </done>
</task>

</tasks>

<verification>
1. `cd /Users/sebastianhamers/Documents/TCS/frontend && npm run build` — zero errors
2. `ls frontend/src/admin/pages/IndexPage.tsx` — file does not exist (deleted)
3. `grep -n "NAV_GROUPS" frontend/src/admin/components/AdminSidebar.tsx` — shows grouped structure
4. `grep -n "Navigate" frontend/src/main.tsx` — shows 5 redirect routes
5. `grep -rn "admin/data" frontend/src/admin/pages/LeadsPage.tsx` — shows updated navigate target
</verification>

<success_criteria>
- Admin sidebar has exactly 8 items in 3 labeled sections (Analytics, Tools, Admin)
- /admin/tools loads with Score Explainer as default tab; switching to #search-lab and #index updates URL hash
- /admin/data loads Searches tab; switching to #marketplace updates URL hash
- /admin/search-lab, /admin/score-explainer, /admin/index redirect to /admin/tools
- /admin/searches, /admin/marketplace redirect to /admin/data
- Settings page has full IndexManagementPanel under "Index Management" section
- IndexPage.tsx no longer exists
- Frontend build passes with zero TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/34-admin-platform-restructure/34-01-SUMMARY.md`
</output>
