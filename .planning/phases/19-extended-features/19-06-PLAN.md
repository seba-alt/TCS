---
phase: 19-extended-features
plan: "06"
type: execute
wave: 4
depends_on: ["19-01", "19-02", "19-03", "19-04", "19-05"]
files_modified: []
autonomous: false
requirements: [LEAD-01, LEAD-02, LEAD-04, ROBUST-01, ROBUST-02, ROBUST-03]

must_haves:
  truths:
    - "Users browse the expert grid freely without being asked for an email"
    - "Clicking 'View Full Profile' opens email gate modal for new users"
    - "Returning visitors (email in localStorage) bypass the modal and go directly to the profile"
    - "Filter state encodes to URL — changing filters updates the address bar"
    - "Loading a URL with filter params restores the exact filter state"
    - "FilterSidebar has a 'Copy link' button that copies the current URL"
    - "Typing 2+ chars in search shows a suggestions dropdown"
    - "Clicking a suggestion applies it as the search query"
    - "No-results state shows tag suggestion pills and a Sage CTA"
  artifacts:
    - path: "frontend/src/components/marketplace/ExpertCard.tsx"
      provides: "Verified: View Full Profile button triggers gate or direct open"
    - path: "frontend/src/hooks/useUrlSync.ts"
      provides: "Verified: URL encodes filter state, loads filter state from URL"
    - path: "frontend/src/components/sidebar/SearchInput.tsx"
      provides: "Verified: suggestions dropdown appears on 2+ chars"
    - path: "frontend/src/components/marketplace/EmptyState.tsx"
      provides: "Verified: tag suggestions + Sage CTA in no-results state"
  key_links:
    - from: "ExpertCard 'View Full Profile'"
      to: "ProfileGateModal"
      via: "handleViewProfile → pendingProfileUrl → AnimatePresence"
      pattern: "pendingProfileUrl"
---

<objective>
Human verification of Phase 19 Extended Features — email gate, URL sync, search suggestions, no-results state.

Purpose: Phase 19 completes the v2.0 Extreme Semantic Explorer milestone. Visual correctness, behavioral accuracy, and cross-feature interaction must be confirmed before Phase 19 is marked done.

Output: Human-approved Phase 19. v2.0 milestone complete.
</objective>

<execution_context>
@/Users/sebastianhamers/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sebastianhamers/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/phases/19-extended-features/19-05-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Confirm build is clean and dev servers are running</name>
  <files></files>
  <action>
Confirm build is clean and both dev servers are accessible:
- `npm run build` from `frontend/` — must exit 0
- `curl -s http://localhost:8000/api/health` — must return `{"status":"ok",...}`
- `curl -s "http://localhost:8000/api/suggest?q=mark"` — must return a JSON array
- Frontend dev server at http://localhost:5173 should be accessible

If backend is not running, start it: `uvicorn app.main:app --reload --port 8000` (run in background)
If frontend dev server is not running, start it: from `frontend/` run `npm run dev` (run in background)
  </action>
  <verify>
    npm run build exits 0 with no TypeScript errors.
    curl http://localhost:8000/api/health returns JSON.
    curl GET /api/suggest?q=mark returns a JSON array.
    Frontend accessible at http://localhost:5173.
  </verify>
  <done>Both servers running, suggest endpoint callable, build clean.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Human verify — Phase 19 Extended Features behavioral correctness</name>
  <action>
Present the verification checklist to the user and pause for their response.
  </action>
  <what-built>
    Phase 19 Extended Features: email gate modal (hard gate on "View Full Profile", localStorage unlock for returning visitors), shareable filter URLs (all active filters encode as query params, Copy link button in sidebar), live search suggestions dropdown (FTS5 prefix matching, 2+ chars, AbortController), and no-results state with tag suggestion pills + Sage CTA + clear all link.
  </what-built>
  <how-to-verify>
    Open http://localhost:5173 in browser.

    1. EMAIL GATE — NEW USER: Apply a filter to get results. Find an expert card. Click "View Full Profile →". Confirm: (a) a modal appears with "Unlock full profile" heading, (b) entering a valid email and submitting opens the profile in a new tab and closes the modal, (c) closing the modal without submitting and clicking another card re-shows the modal.

    2. EMAIL GATE — RETURNING VISITOR: After submitting email in check 1, reload the page. Click "View Full Profile →" on any card. Confirm: the modal does NOT appear — profile opens directly in a new tab (localStorage unlock).

    3. URL SYNC: Apply filters (e.g., search "marketing", add a tag, adjust rate slider). Confirm: (a) the address bar updates to show params like `?q=marketing&tags=saas&rate_max=200`, (b) copy the URL, paste in a new tab — the exact same filters are active and the grid shows filtered results (no "all experts" flash).

    4. COPY LINK: Scroll to the bottom of the FilterSidebar. Confirm: (a) a "Copy link" button is visible, (b) clicking it copies the current URL, (c) button briefly shows "Copied!" then returns to "Copy link".

    5. SEARCH SUGGESTIONS: Click the search input. Type "mar" (3 chars). Confirm: (a) a dropdown appears below the search bar with up to 8 job title suggestions, (b) clicking a suggestion applies it as the search query and closes the dropdown, (c) pressing Escape closes the dropdown.

    6. NO-RESULTS STATE: Apply a very specific filter combination that returns zero results (e.g., search for "xyzabc1234" or set rate max to €5). Confirm: (a) tag suggestion pills are visible (up to 6 tags from the list, NOT currently active tags), (b) clicking a suggestion pill replaces the tag filter and re-fetches, (c) "Try describing it to Sage" button opens the Sage panel, (d) "Clear all filters" link resets everything.

    7. BUILD CLEAN: Confirm `npm run build` in `frontend/` exits with 0 errors (no TypeScript issues).
  </how-to-verify>
  <verify>Human responds "approved" or describes issues.</verify>
  <done>User types "approved" confirming all 7 checks pass.</done>
  <resume-signal>Type "approved" if all 7 checks pass, or describe any issues with the check number (e.g. "check 3 fails — URL doesn't update when filter changes").</resume-signal>
</task>

</tasks>

<verification>
Human has confirmed all 7 visual and behavioral checks pass.
</verification>

<success_criteria>
- Email gate: hard gate on profile clicks, localStorage unlock for returning visitors
- URL sync: filters encode to URL params, loading URL restores filter state
- Copy link: copies current URL, shows "Copied!" feedback
- Search suggestions: 2+ chars triggers dropdown, clicking applies query
- No-results: tag suggestions, Sage CTA, clear all link all functional
- Build passes with zero TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/19-extended-features/19-06-SUMMARY.md`
</output>
