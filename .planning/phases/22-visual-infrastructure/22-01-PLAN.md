---
phase: 22-visual-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/index.css
  - frontend/src/components/AuroraBackground.tsx
autonomous: true
requirements:
  - VIS-01
  - VIS-05

must_haves:
  truths:
    - "The marketplace background glows with a slow-drifting multi-color aurora gradient (blues, cyans, teals, violets anchored to brand purple)"
    - "The aurora animation pauses when the browser tab is hidden and respects prefers-reduced-motion"
    - "OKLCH design tokens are defined as CSS custom properties in :root and available to all components"
    - "Glass surface CSS class exists and can be applied to any element"
    - "On unsupported browsers the glass surface degrades to an opaque dark fallback (not transparent/broken)"
  artifacts:
    - path: "frontend/src/index.css"
      provides: "OKLCH :root tokens, @keyframes aurora-drift, .aurora-bg class, .aurora-paused class, .glass-surface class with ::before pseudo-element, @supports fallback, @media prefers-reduced-motion"
      contains: "--aurora-bg"
    - path: "frontend/src/components/AuroraBackground.tsx"
      provides: "React wrapper that renders aurora div and manages visibilitychange pause/resume"
      exports: ["AuroraBackground"]
  key_links:
    - from: "frontend/src/components/AuroraBackground.tsx"
      to: "frontend/src/index.css"
      via: "className='aurora-bg' on the fixed div"
      pattern: "aurora-bg"
    - from: "frontend/src/index.css"
      to: ":root OKLCH tokens"
      via: "CSS custom properties consumed by .aurora-bg and .glass-surface"
      pattern: "--aurora-"
---

<objective>
Establish the CSS foundation for the v2.2 aurora aesthetic: OKLCH design tokens, the aurora mesh gradient animation, and the reusable glass surface class. Then wrap it in a thin React component that handles the tab-visibility pause behavior.

Purpose: Plans 02 onward apply .glass-surface to components and wrap the page in AuroraBackground — this plan creates what they depend on. Nothing visual ships without this foundation.
Output: frontend/src/index.css (extended with tokens + keyframes + glass class), frontend/src/components/AuroraBackground.tsx (new component).
</objective>

<execution_context>
@/Users/sebastianhamers/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sebastianhamers/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/22-visual-infrastructure/22-CONTEXT.md
@.planning/phases/22-visual-infrastructure/22-RESEARCH.md
@frontend/src/index.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: OKLCH tokens, aurora keyframes, and glass-surface class in index.css</name>
  <files>frontend/src/index.css</files>
  <action>
Append the following to frontend/src/index.css, preserving the existing .expert-card and .expert-card:hover rules verbatim.

SECTION 1 — OKLCH Design Tokens (append after @tailwind utilities line, before .expert-card):

```css
/* ===== OKLCH Design Tokens — Phase 22 Visual Infrastructure ===== */
/* Brand purple #5128F2 = oklch(49.0% 0.270 279.0) — all aurora colors derive from this anchor */
:root {
  /* Aurora palette — cool blues, cyans, teals, violets */
  --aurora-bg:        oklch(7% 0.020 279);    /* deep purple-tinted near-black base */
  --aurora-purple:    oklch(49% 0.270 279 / 0.35); /* brand purple blob */
  --aurora-violet:    oklch(42% 0.200 295 / 0.25); /* blue-violet blob */
  --aurora-blue:      oklch(45% 0.175 250 / 0.30); /* deep blue blob */
  --aurora-cyan:      oklch(55% 0.155 220 / 0.20); /* cyan-blue blob */
  --aurora-teal:      oklch(52% 0.135 195 / 0.25); /* teal blob */

  /* Glass surface tokens */
  --glass-tint:        oklch(49% 0.270 279 / 0.08); /* brand purple at 8% opacity */
  --glass-border:      oklch(100% 0 0 / 0.10);       /* white at 10% opacity */
  --glass-fallback-bg: oklch(14% 0.022 279);          /* opaque dark purple — fallback for no backdrop-filter */
}
```

SECTION 2 — Aurora animation (append after :root block):

```css
/* ===== Aurora Mesh Gradient Animation ===== */
/* Technique: animate background-position on multi-layer radial-gradient.
   background-position is GPU-composited — no repaints. background-size: 200% 200%
   gives blobs room to drift without reaching edges.
   0% and 100% are IDENTICAL — seamless loop, no visible jump at boundary. */
@keyframes aurora-drift {
  0%, 100% {
    background-position:
      15% 30%,
      75% 20%,
      40% 70%,
      85% 60%,
      25% 80%;
  }
  33% {
    background-position:
      30% 50%,
      60% 40%,
      60% 35%,
      30% 80%,
      65% 60%;
  }
  66% {
    background-position:
      20% 60%,
      80% 50%,
      50% 55%,
      70% 40%,
      40% 70%;
  }
}

.aurora-bg {
  /* Base color — deep purple-tinted near-black per CONTEXT.md */
  background-color: var(--aurora-bg);
  /* Five radial gradient blobs — each placed at 50% 50% initially, drifted by background-position */
  background-image:
    radial-gradient(ellipse 60% 40% at 50% 50%, var(--aurora-purple) 0%, transparent 70%),
    radial-gradient(ellipse 50% 35% at 50% 50%, var(--aurora-violet) 0%, transparent 70%),
    radial-gradient(ellipse 55% 45% at 50% 50%, var(--aurora-blue) 0%, transparent 70%),
    radial-gradient(ellipse 45% 40% at 50% 50%, var(--aurora-cyan) 0%, transparent 70%),
    radial-gradient(ellipse 65% 50% at 50% 50%, var(--aurora-teal) 0%, transparent 70%);
  background-size: 200% 200%;
  /* 20s is mid-range of 15–25s cycle duration per CONTEXT.md */
  animation: aurora-drift 20s ease-in-out infinite;
  /* Full viewport coverage, behind all content */
  position: fixed;
  inset: 0;
  z-index: -1;
}

/* JS sets this class when document.hidden === true (AuroraBackground component) */
.aurora-paused {
  animation-play-state: paused;
}

/* Static aurora fallback — same gradient, no animation, per CONTEXT.md: "frozen, looks intentional" */
@media (prefers-reduced-motion: reduce) {
  .aurora-bg {
    animation: none;
    background-position: 15% 30%, 75% 20%, 40% 70%, 85% 60%, 25% 80%;
  }
}
```

SECTION 3 — Glass surface class (append after aurora section):

```css
/* ===== Glass Surface ===== */
/* CRITICAL: backdrop-filter breaks when any ancestor has overflow:hidden (Chrome).
   Solution: move backdrop-filter to an absolutely-positioned ::before pseudo-element.
   ::before is not affected by overflow clipping on its parent.
   This pattern is safe for FilterSidebar (overflow-y-auto on inner div, not <aside> itself)
   and SagePanel (position:fixed creates own stacking context). */

.glass-surface {
  position: relative;
  /* Opaque fallback — dark brand-purple tone, looks intentional per CONTEXT.md */
  background-color: var(--glass-fallback-bg);
}

/* Blur layer behind content via pseudo-element */
.glass-surface::before {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: inherit;
  background-color: var(--glass-tint); /* brand purple at 8% */
  -webkit-backdrop-filter: blur(4px);  /* Safari — Tailwind v3.4.19 also emits this on backdrop-blur-sm */
  backdrop-filter: blur(4px);          /* blur(4px) = blur-sm per CONTEXT.md */
  pointer-events: none;
  z-index: -1;
}

/* Progressive enhancement: show glass when backdrop-filter is supported */
@supports (backdrop-filter: blur(1px)) or (-webkit-backdrop-filter: blur(1px)) {
  .glass-surface {
    background-color: transparent; /* ::before handles background */
    border: 1px solid var(--glass-border); /* white/10 border per CONTEXT.md */
  }
}
```

IMPORTANT: Do NOT modify the existing .expert-card rules. Place all new CSS above the existing .expert-card block. The .glass-surface class defined in index.css will NOT be purged by Tailwind — Tailwind only purges its own generated utilities, not hand-written CSS.
  </action>
  <verify>
1. Run `cd frontend && npm run build 2>&1 | tail -20` — build must succeed with no errors.
2. Confirm index.css contains `--aurora-bg`, `--glass-tint`, `@keyframes aurora-drift`, `.aurora-bg`, `.glass-surface`, `.glass-surface::before`, `@supports`, `.aurora-paused`.
3. Confirm .expert-card and .expert-card:hover rules are unchanged.
  </verify>
  <done>
index.css contains all OKLCH :root tokens, aurora-drift keyframes, .aurora-bg class, .aurora-paused class, .glass-surface class with ::before and @supports fallback — and existing .expert-card rules are intact. Build passes.
  </done>
</task>

<task type="auto">
  <name>Task 2: AuroraBackground React wrapper component</name>
  <files>frontend/src/components/AuroraBackground.tsx</files>
  <action>
Create frontend/src/components/AuroraBackground.tsx. This is a thin wrapper that:
1. Renders the `div.aurora-bg` background element (position:fixed, z-index:-1, aria-hidden)
2. Adds a `visibilitychange` event listener to toggle `.aurora-paused` class when tab is hidden/shown
3. Wraps children in a relative container

```tsx
import { useEffect, useRef } from 'react'

interface AuroraBackgroundProps {
  children: React.ReactNode
}

/**
 * Renders the animated aurora mesh gradient background behind page content.
 * Pauses animation when tab is hidden (visibilitychange) to conserve resources.
 * CSS handles prefers-reduced-motion via @media query in index.css.
 *
 * Phase 22 — VIS-01
 */
export function AuroraBackground({ children }: AuroraBackgroundProps) {
  const auroraRef = useRef<HTMLDivElement>(null)

  useEffect(() => {
    function handleVisibilityChange() {
      if (!auroraRef.current) return
      if (document.hidden) {
        auroraRef.current.classList.add('aurora-paused')
      } else {
        auroraRef.current.classList.remove('aurora-paused')
      }
    }

    document.addEventListener('visibilitychange', handleVisibilityChange)
    return () => document.removeEventListener('visibilitychange', handleVisibilityChange)
  }, [])

  return (
    <div className="relative min-h-screen">
      {/* Aurora background — position:fixed in CSS, behind all content */}
      <div ref={auroraRef} className="aurora-bg" aria-hidden="true" />
      {children}
    </div>
  )
}
```

Note: The component wraps children in `relative min-h-screen` so the stacking context is correct — aurora div is `z-index: -1` (CSS) and `position: fixed`, so it sits behind everything rendered within.
  </action>
  <verify>
1. Run `cd frontend && npm run build 2>&1 | tail -20` — build must succeed with no TypeScript errors.
2. Check that `frontend/src/components/AuroraBackground.tsx` exists and exports `AuroraBackground`.
3. Verify the component has exactly one useEffect with visibilitychange listener and proper cleanup.
  </verify>
  <done>
AuroraBackground.tsx exists, exports AuroraBackground, compiles without errors. Component renders aurora-bg div with aria-hidden and manages visibilitychange pause/resume via classList toggle.
  </done>
</task>

</tasks>

<verification>
1. `cd /Users/sebastianhamers/Documents/TCS/frontend && npm run build` — exits 0.
2. `grep -c "aurora-bg\|glass-surface\|aurora-drift\|--aurora-bg\|--glass-tint" frontend/src/index.css` — returns >= 6 (all key rules present).
3. `grep "AuroraBackground" frontend/src/components/AuroraBackground.tsx` — confirms export.
4. Confirm .expert-card line still present in index.css (existing styles preserved).
</verification>

<success_criteria>
- OKLCH tokens defined in :root with correct CSS custom property names (--aurora-*, --glass-*)
- @keyframes aurora-drift defined with identical 0%/100% positions (seamless loop guaranteed)
- .aurora-bg class applies the 5-blob radial gradient with 20s animation
- .glass-surface class uses ::before pseudo-element pattern for backdrop-filter (overflow:hidden safe)
- @supports block degrades to opaque --glass-fallback-bg when backdrop-filter is unsupported
- @media prefers-reduced-motion freezes animation
- AuroraBackground component compiles cleanly and manages visibilitychange
- Build passes with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/22-visual-infrastructure/22-01-SUMMARY.md` documenting:
- What was implemented (CSS sections added, component created)
- Key decisions made (OKLCH values chosen, blob alpha values, animation duration)
- Actual file paths created/modified
- Any deviations from the plan and why
</output>
