# Phase 40.3: Revert to Explorer-only — Research

**Researched:** 2026-02-25
**Domain:** Frontend route restructure, component cleanup, mobile-first Explorer adjustments
**Confidence:** HIGH

## Summary

Phase 40.3 removes the Browse page introduced in v3.0 and makes Explorer the sole discovery surface at `/`. The Browse page (BrowsePage.tsx) and all Browse-specific components (BrowseCard, BrowseRow, HeroBanner, skeletons, useBrowse hook) are deleted. The RootLayout, routing, Sage hooks, and navigationSlice are simplified since there is no longer a second page to navigate between. Explorer inherits photo/monogram support on ExpertCards (already present from Phase 40.2) and the bookmark/saved feature. The Header search bar becomes the primary mobile search surface with sticky positioning. Mobile gets a bottom-sheet filter pattern (already implemented via MobileFilterSheet using vaul Drawer) and a two-column card grid (already the default via `grid-cols-2`).

**Primary recommendation:** Delete Browse components, restructure routes so `/` serves MarketplacePage, simplify RootLayout and useSage, and make the Header + search bar mobile-visible with sticky positioning.

<user_constraints>
## User Constraints (from CONTEXT.md)

### Locked Decisions
- Expert photos on cards stay — photo_url on Expert model, /api/photos endpoint, monogram fallback all kept
- Saved/bookmark feature stays — toolbar button + bookmark toggle on expert cards
- Sage stays as-is on Explorer — FAB, conversation persistence, discovery search integration
- All toolbar additions stay — Clear All pill, Saved button, Sage search integration
- Browse-style category rows do NOT carry over — drop categories entirely
- Straight to grid — no hero banner, no welcome header. User lands directly on search bar + expert grid
- Keep current Explorer card layout, just add photo/monogram to existing design (not Browse-style glassmorphic cards)
- Minor filter polish — Claude has discretion on visual rough edges but same filter functionality
- All 40.2 toolbar features stay intact
- `/` serves Explorer directly — it's the only page
- `/browse` redirects permanently to `/`
- Keep `/api/browse` endpoint for now — don't delete even though no frontend consumer
- Keep `/api/photos/{username}` proxy endpoint — photos staying on Explorer cards
- Keep admin bulk photo import endpoint — still useful
- Delete ALL Browse-specific frontend components (BrowsePage, CategoryRow, BrowseExpertCard, HeroBanner, useBrowse hook)
- Search bar sticky at top of viewport — always accessible as user scrolls
- Two-column card grid on mobile — compact, see more experts
- Filters triggered via filter icon button -> bottom sheet that slides up (thumb-friendly)
- Search and filters must be very easy to interact with on mobile

### Claude's Discretion
- `/explore` redirect behavior (redirect to `/` or keep working alongside)
- `/marketplace` redirect chain cleanup
- Zustand navigationSlice fate (keep for Sage or remove if unused)
- Filter sidebar visual polish specifics
- Exact mobile breakpoints and responsive transitions

### Deferred Ideas (OUT OF SCOPE)
None — discussion stayed within phase scope
</user_constraints>

## Architecture Patterns

### Current Route Structure (to be changed)
```
/           -> RootLayout > BrowsePage     (DELETE)
/explore    -> RootLayout > MarketplacePage (BECOMES /)
/marketplace -> MarketplaceRedirect -> /explore
/browse      -> (does not exist yet — needs redirect)
```

### Target Route Structure
```
/           -> RootLayout > MarketplacePage (Explorer is home)
/explore    -> Redirect to /                (or keep as alias — Claude's discretion)
/browse     -> Redirect to /                (permanent redirect)
/marketplace -> Redirect to /               (simplify chain)
```

### Files to DELETE (Browse-specific frontend)
| File | Purpose |
|------|---------|
| `src/pages/BrowsePage.tsx` | Browse page component |
| `src/components/browse/BrowseCard.tsx` | Glassmorphic expert card |
| `src/components/browse/BrowseRow.tsx` | Horizontal category row + SeeAllEndCard |
| `src/components/browse/HeroBanner.tsx` | Carousel hero banner |
| `src/components/browse/SkeletonBrowseCard.tsx` | Browse card skeleton |
| `src/components/browse/SkeletonBrowseRow.tsx` | Browse row skeleton |
| `src/components/browse/SkeletonHeroBanner.tsx` | Hero banner skeleton |
| `src/hooks/useBrowse.ts` | Browse data fetch hook |

### Files to MODIFY
| File | Changes |
|------|---------|
| `src/main.tsx` | Route restructure: `/` serves MarketplacePage, redirects for `/browse`, `/explore`, `/marketplace` |
| `src/layouts/RootLayout.tsx` | Remove Browse vs Explorer branching in Sage panel/popover logic; simplify since only Explorer exists |
| `src/hooks/useSage.ts` | Remove Browse-specific code path (isExplorer branching, `setTimeout` auto-navigate, clean filter state for Browse) |
| `src/pages/MarketplacePage.tsx` | Remove navigationSource pilot reset logic (no longer needed without Browse→Explorer transitions); make Header visible on mobile |
| `src/components/Header.tsx` | Make visible on mobile with sticky positioning; currently `hidden md:flex` |
| `src/store/navigationSlice.ts` | Simplify: remove browseData cache, CachedBrowseData interface; evaluate pendingSageResults/navigationSource (Sage still needs pendingSageResults for Sage search workflow) |

### navigationSlice Analysis (Claude's Discretion Area)

**What Sage actually uses from navigationSlice:**
1. `pendingSageResults` — Used by `useSage.ts` when search_performed=true to store experts before navigate, and consumed by `useExplore.ts` on mount. With no Browse page, Sage search on Explorer already injects results directly (no pending needed). **Can be removed.**
2. `pendingSearchQuery` — Paired with pendingSageResults. **Can be removed.**
3. `navigationSource` — Used by MarketplacePage to decide whether to resetPilot on mount. Without Browse, every visit is "direct". **Can be removed.**
4. `browseData` / `setBrowseData` — Browse cache. **Must be removed.**
5. `setNavigationSource` — Called by BrowsePage before navigate. **Can be removed.**
6. `setPendingSageResults` / `clearPendingSageResults` — Only used in Browse→Explorer flow. **Can be removed.**

**Recommendation:** Remove the entire navigationSlice. All its state was for Browse↔Explorer cross-page navigation. With only Explorer, Sage works entirely through direct store injection (the `isExplorer` code path in useSage). The store type becomes `FilterSlice & ResultsSlice & PilotSlice`.

### Mobile-First Adjustments

**Header (search bar):**
- Currently `hidden md:flex` — invisible on mobile
- Change to always-visible with `sticky top-0 z-50`
- On mobile, simplify to: logo (smaller) + search bar (full width) + hamburger/filter icon
- The mobile toolbar in MarketplacePage already has "Filters" button that opens MobileFilterSheet (vaul Drawer) — this stays

**ExpertGrid:**
- Already `grid-cols-2 md:grid-cols-3` — two columns on mobile, three on desktop. No change needed.

**ExpertCard photos:**
- Already implemented in Phase 40.2 with 32px circle avatar. No change needed.

**MobileFilterSheet:**
- Already uses vaul Drawer with bottom-sheet pattern (snap points at 50% and 100%). This IS the "bottom sheet that slides up" from CONTEXT.md. No change needed.

**Sticky search on mobile:**
- Header needs to be visible on mobile and sticky. Currently the desktop Header is `sticky top-0` but `hidden md:flex`.
- Option A: Make the existing Header responsive (show on mobile too)
- Option B: Create a separate mobile search bar component
- **Recommendation:** Option A — make existing Header responsive. Add mobile breakpoint styles to show a compact version on small screens.

## Common Pitfalls

### Pitfall 1: Orphaned Imports
**What goes wrong:** Deleting Browse components but forgetting imports in other files
**Why it happens:** BrowsePage is imported in main.tsx, useBrowse types might be used elsewhere
**How to avoid:** After deleting files, run `npx tsc --noEmit` to catch broken imports

### Pitfall 2: Sage Browse Code Path Still Active
**What goes wrong:** useSage still has `!isExplorer` branch that tries to navigate to `/explore`
**Why it happens:** The Browse-specific Sage code path is interleaved with the Explorer path
**How to avoid:** Remove the `isExplorer` conditional entirely from useSage — always use the Explorer code path (direct store injection)

### Pitfall 3: RootLayout SagePopover Still Rendered
**What goes wrong:** SagePopover renders when `!isExplorer`, but with `/` now being Explorer, `isExplorer` check breaks
**Why it happens:** RootLayout uses `location.pathname === '/explore'` to decide panel vs popover
**How to avoid:** Since there's only one page, always render SagePanel (not SagePopover). The popover was Browse-only.

### Pitfall 4: navigationSource resetPilot Logic
**What goes wrong:** MarketplacePage resets pilot on every mount because navigationSource is always 'direct'
**Why it happens:** Without Browse, there's no code path that sets navigationSource to 'browse' or 'sage'
**How to avoid:** Remove the navigationSource guard entirely. Decide: should pilot reset on page load? Currently pilot resets only on "direct" visits. With no Browse, every visit is direct, so pilot always resets. This might be desired (clean state on page load) or might need adjustment if users expect persistence.

### Pitfall 5: /explore Redirect Loop
**What goes wrong:** If `/explore` redirects to `/` and something still links to `/explore`, users may experience confusion but no loop
**Why it happens:** Many internal references to `/explore` in the codebase
**How to avoid:** Keep `/explore` as an alias (same component, no redirect) OR redirect once. Either works.

## Code Examples

### Route Restructure (main.tsx)
```typescript
const router = createBrowserRouter([
  {
    element: <RootLayout />,
    children: [
      {
        path: '/',
        element: <MarketplacePage />,
      },
    ],
  },
  // Redirects — all legacy paths go to /
  { path: '/explore', element: <Navigate to="/" replace /> },
  { path: '/browse', element: <Navigate to="/" replace /> },
  { path: '/marketplace', element: <MarketplaceRedirect /> }, // preserves query params
  // ... admin routes unchanged
])
```

### Simplified RootLayout
```typescript
export default function RootLayout() {
  const isOpen = useExplorerStore((s) => s.isOpen)
  const setOpen = useExplorerStore((s) => s.setOpen)

  return (
    <>
      <Outlet />
      <AnimatePresence>
        {!isOpen && <SageFAB key="sage-fab" />}
      </AnimatePresence>
      <AnimatePresence>
        {isOpen && (
          <>
            <div key="sage-backdrop" className="fixed inset-0 z-30 bg-black/30" onClick={() => setOpen(false)} />
            <SagePanel key="sage-panel" />
          </>
        )}
      </AnimatePresence>
    </>
  )
}
```

### Simplified useSage (no Browse branching)
```typescript
// Remove isExplorer check — always on Explorer
// Remove setTimeout auto-navigate
// Remove clean filter state for Browse
// Always inject results directly into store
if (data.search_performed === true) {
  const store = useExplorerStore.getState()
  const experts = data.experts ?? []
  const total = data.total ?? 0
  store.setLoading(false)
  store.setResults(experts, total, null)
  store.setSageMode(true)
}
```

## Don't Hand-Roll

| Problem | Don't Build | Use Instead | Why |
|---------|-------------|-------------|-----|
| Mobile bottom sheet | Custom sheet component | vaul Drawer (already in use) | Touch physics, snap points, backdrop |
| Sticky header | Custom scroll observer | CSS `sticky top-0 z-50` | Browser-native, no JS needed |
| Route redirects | Custom redirect logic | React Router `<Navigate replace />` | Standard pattern, preserves history |

## Open Questions

1. **Pilot reset behavior without Browse**
   - What we know: Currently pilot resets on "direct" visits, preserved on "browse"/"sage" visits
   - What's unclear: With only Explorer, should pilot always reset on page load or persist across refreshes?
   - Recommendation: Keep simple reset on mount — aligns with existing "direct" behavior. Users start fresh each session.

2. **SagePopover fate**
   - What we know: SagePopover was only used on Browse. SagePanel is the Explorer surface.
   - What's unclear: Should SagePopover.tsx be deleted or kept for future use?
   - Recommendation: Delete it — dead code. Can be recreated if needed later.

3. **MarketplaceRedirect query param preservation**
   - What we know: `/marketplace` redirect preserves query params via useSearchParams
   - What's unclear: Should `/explore` redirect also preserve query params?
   - Recommendation: Yes — use the same MarketplaceRedirect pattern for `/explore` too, or make it a generic RedirectWithParams component.

## Sources

### Primary (HIGH confidence)
- Codebase analysis — all files read directly from working tree
- React Router v7 routing patterns — createBrowserRouter, Navigate component
- Zustand store architecture — slice pattern with persist middleware

### Secondary (MEDIUM confidence)
- vaul Drawer library — bottom sheet patterns (verified in existing MobileFilterSheet)

## Metadata

**Confidence breakdown:**
- Standard stack: HIGH - existing codebase uses React + Vite + Tailwind + React Router + Zustand
- Architecture: HIGH - direct codebase analysis, clear component boundaries
- Pitfalls: HIGH - identified from actual code paths and dependencies

**Research date:** 2026-02-25
**Valid until:** 2026-03-25 (stable — no external dependency changes)
