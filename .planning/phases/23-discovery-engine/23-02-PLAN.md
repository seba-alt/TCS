---
phase: 23-discovery-engine
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/components/sidebar/TagCloud.tsx
  - frontend/src/components/sidebar/EverythingIsPossible.tsx
autonomous: true
requirements:
  - DISC-02
  - DISC-03
  - DISC-04

must_haves:
  truths:
    - "TagCloud renders all 30 TOP_TAGS as rounded pill buttons with proximity-based scale on cursor approach"
    - "Cursor approaching (not just hovering over) a tag pill causes it to scale up proportionally — with zero React re-renders"
    - "Selected tags animate to the front of the cloud on toggle via layout reorder"
    - "EverythingIsPossible renders below the cloud with cycling quirky example tags that crossfade every 3.5 seconds"
    - "Each cycling tag is keyboard-navigable (Enter/Space toggles it) and has aria-label"
    - "TagCloud container has role=group and aria-label, each pill has aria-pressed"
  artifacts:
    - path: "frontend/src/components/sidebar/TagCloud.tsx"
      provides: "Proximity-scale animated tag cloud"
      min_lines: 80
      exports: ["TagCloud"]
    - path: "frontend/src/components/sidebar/EverythingIsPossible.tsx"
      provides: "Cycling quirky tag phrase element"
      min_lines: 40
      exports: ["EverythingIsPossible"]
  key_links:
    - from: "frontend/src/components/sidebar/TagCloud.tsx"
      to: "useExplorerStore"
      via: "useFilterSlice() for tags + toggleTag"
      pattern: "useFilterSlice|useExplorerStore"
    - from: "frontend/src/components/sidebar/TagCloud.tsx"
      to: "motion/react"
      via: "useMotionValue, useTransform, useSpring, LayoutGroup, motion"
      pattern: "from 'motion/react'"
    - from: "frontend/src/components/sidebar/TagCloud.tsx"
      to: "frontend/src/constants/tags.ts"
      via: "TOP_TAGS import (30 items)"
      pattern: "TOP_TAGS"
---

<objective>
Create TagCloud.tsx and EverythingIsPossible.tsx — the two new components that replace TagMultiSelect in the sidebar.

Purpose: TagCloud provides proximity-based claymorphic scaling without React re-renders (via motion value graph). EverythingIsPossible adds an explorative "everything is possible" element with cycling quirky tags. Both are created as standalone files here; FilterSidebar wire-up happens in Plan 03.
Output: TagCloud.tsx and EverythingIsPossible.tsx ready to be imported by FilterSidebar.
</objective>

<execution_context>
@/Users/sebastianhamers/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sebastianhamers/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/23-discovery-engine/23-RESEARCH.md
@frontend/src/components/sidebar/TagMultiSelect.tsx
@frontend/src/constants/tags.ts
@frontend/src/store/filterSlice.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TagCloud.tsx with proximity-scale motion values</name>
  <files>frontend/src/components/sidebar/TagCloud.tsx</files>
  <action>
Create `frontend/src/components/sidebar/TagCloud.tsx` implementing the proximity-scale animated tag cloud. Use the exact pattern from RESEARCH.md Pattern 3.

Key implementation rules (NON-NEGOTIABLE — from STATE.md and RESEARCH.md):

1. **Import path**: Always `from 'motion/react'` — never `from 'framer-motion'` (project convention confirmed from SagePanel.tsx)
2. **No useState for proximity scale**: Use `useMotionValue` + `useTransform` + `useSpring` exclusively. Per-pill `useState` would cause 60 re-renders/sec with 30+ pills.
3. **One parent onMouseMove**: Do NOT add `onMouseMove` to each TagPill. One handler on the container div passes shared mouseX/mouseY motion values to pills as props.
4. **No initial/animate on TagPill**: Only `layout="position"` for positional reorder. No `initial={{ opacity: 0 }}` (would animate all 30 pills on every page render).
5. **No AnimatePresence on tag list**: Reserve AnimatePresence for EverythingIsPossible only. Wrapping 30 pills in AnimatePresence causes fade animations on every toggle.
6. **LayoutGroup scope**: Wrap only the `flex flex-wrap gap-2` container, NOT the entire sidebar or FilterControls.

```tsx
// frontend/src/components/sidebar/TagCloud.tsx
import { useRef } from 'react'
import {
  motion,
  useMotionValue,
  useSpring,
  useTransform,
  LayoutGroup,
} from 'motion/react'
import { useExplorerStore } from '../../store'
import { TOP_TAGS } from '../../constants/tags'

// Per-pill hook: reads shared mouse position, measures own DOM rect, derives spring scale
function useProximityScale(
  mouseX: ReturnType<typeof useMotionValue>,
  mouseY: ReturnType<typeof useMotionValue>,
  ref: React.RefObject<HTMLButtonElement | null>,
) {
  const distance = useTransform([mouseX, mouseY], ([mx, my]: number[]) => {
    if (!ref.current) return 999
    const rect = ref.current.getBoundingClientRect()
    const cx = rect.left + rect.width / 2
    const cy = rect.top + rect.height / 2
    return Math.sqrt((mx - cx) ** 2 + (my - cy) ** 2)
  })
  // 1.4 at 0px, 1.15 at 60px, 1.0 at 120px+
  const scaleRaw = useTransform(distance, [0, 60, 120], [1.4, 1.15, 1.0], { clamp: true })
  return useSpring(scaleRaw, { stiffness: 200, damping: 20, mass: 0.5 })
}

function TagPill({
  tag,
  isSelected,
  mouseX,
  mouseY,
  onToggle,
}: {
  tag: string
  isSelected: boolean
  mouseX: ReturnType<typeof useMotionValue>
  mouseY: ReturnType<typeof useMotionValue>
  onToggle: () => void
}) {
  const ref = useRef<HTMLButtonElement>(null)
  const scale = useProximityScale(mouseX, mouseY, ref)

  return (
    <motion.button
      ref={ref}
      layout="position"
      style={{ scale }}
      onClick={onToggle}
      aria-pressed={isSelected}
      className={`
        text-xs px-3 py-1.5 rounded-full border cursor-pointer transition-colors origin-center
        ${isSelected
          ? 'bg-brand-purple text-white border-brand-purple'
          : 'bg-white/80 text-gray-700 border-gray-300 hover:border-brand-purple'
        }
      `}
    >
      {tag}
    </motion.button>
  )
}

export function TagCloud() {
  const toggleTag = useExplorerStore((s) => s.toggleTag)
  const tags = useExplorerStore((s) => s.tags)

  const mouseX = useMotionValue(-999)
  const mouseY = useMotionValue(-999)

  function handleMouseMove(e: React.MouseEvent) {
    mouseX.set(e.clientX)
    mouseY.set(e.clientY)
  }

  function handleMouseLeave() {
    mouseX.set(-999)
    mouseY.set(-999)
  }

  // Selected tags first, then unselected — visual reorder on toggle
  const sortedTags = [
    ...TOP_TAGS.filter((t) => tags.includes(t)),
    ...TOP_TAGS.filter((t) => !tags.includes(t)),
  ]

  return (
    <LayoutGroup>
      <div
        className="flex flex-wrap gap-2"
        onMouseMove={handleMouseMove}
        onMouseLeave={handleMouseLeave}
        role="group"
        aria-label="Domain tags"
      >
        {sortedTags.map((tag) => (
          <TagPill
            key={tag}
            tag={tag}
            isSelected={tags.includes(tag)}
            mouseX={mouseX}
            mouseY={mouseY}
            onToggle={() => toggleTag(tag)}
          />
        ))}
      </div>
    </LayoutGroup>
  )
}
```

TypeScript note: If `useTransform([mouseX, mouseY], ([mx, my]: number[]) => ...)` produces a TS error on the transformer parameter, cast: `([mx, my]) => { const x = mx as number; const y = my as number; ... }`.
  </action>
  <verify>Run `cd /Users/sebastianhamers/Documents/TCS/frontend && npm run build` — must exit 0. Confirm imports: `grep -n "motion/react" /Users/sebastianhamers/Documents/TCS/frontend/src/components/sidebar/TagCloud.tsx` — should show the import line. Confirm no useState for scale: `grep -n "useState" /Users/sebastianhamers/Documents/TCS/frontend/src/components/sidebar/TagCloud.tsx` — should return no results. Confirm LayoutGroup scope: `grep -n "LayoutGroup" /Users/sebastianhamers/Documents/TCS/frontend/src/components/sidebar/TagCloud.tsx` — should appear only inside TagCloud function, not wrapping the entire module.</verify>
  <done>Build exits 0. TagCloud.tsx exports TagCloud function. Uses motion/react imports. No useState. No AnimatePresence on tag list. LayoutGroup scoped to the flex container inside TagCloud.</done>
</task>

<task type="auto">
  <name>Task 2: Create EverythingIsPossible.tsx with cycling crossfade</name>
  <files>frontend/src/components/sidebar/EverythingIsPossible.tsx</files>
  <action>
Create `frontend/src/components/sidebar/EverythingIsPossible.tsx` implementing the cycling quirky-tag phrase element. Use the exact pattern from RESEARCH.md Pattern 4.

```tsx
// frontend/src/components/sidebar/EverythingIsPossible.tsx
import { useState, useEffect, useCallback } from 'react'
import { AnimatePresence, motion } from 'motion/react'
import { useExplorerStore } from '../../store'

const EXAMPLE_TAGS = [
  'underwater basket weaving',
  'time travel consulting',
  'dragon taming',
  'moon logistics',
  'anti-gravity marketing',
  'telepathy training',
  'interdimensional real estate',
  'cloud whispering',
]

const CYCLE_INTERVAL_MS = 3500

export function EverythingIsPossible() {
  const toggleTag = useExplorerStore((s) => s.toggleTag)
  const [index, setIndex] = useState(0)

  useEffect(() => {
    const id = setInterval(() => {
      setIndex((i) => (i + 1) % EXAMPLE_TAGS.length)
    }, CYCLE_INTERVAL_MS)
    return () => clearInterval(id)
  }, [])

  const currentTag = EXAMPLE_TAGS[index]

  const handleActivate = useCallback(() => {
    toggleTag(currentTag)
  }, [currentTag, toggleTag])

  const handleKeyDown = useCallback(
    (e: React.KeyboardEvent) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault()
        handleActivate()
      }
    },
    [handleActivate],
  )

  return (
    <div className="mt-3 px-1">
      <p className="text-xs text-gray-400 mb-1.5">Everything is possible —</p>
      <AnimatePresence mode="wait">
        <motion.button
          key={currentTag}
          initial={{ opacity: 0, y: 4 }}
          animate={{ opacity: 1, y: 0 }}
          exit={{ opacity: 0, y: -4 }}
          transition={{ duration: 0.25 }}
          onClick={handleActivate}
          onKeyDown={handleKeyDown}
          tabIndex={0}
          aria-label={`Add tag: ${currentTag}`}
          className="text-xs text-brand-purple italic hover:underline cursor-pointer bg-transparent border-0 p-0 focus:outline-none focus-visible:ring-2 focus-visible:ring-brand-purple rounded"
        >
          {currentTag}
        </motion.button>
      </AnimatePresence>
    </div>
  )
}
```

`AnimatePresence mode="wait"` ensures the exit animation of the departing tag completes before the entering tag appears — prevents overlap during rapid cycling. The `key={currentTag}` change drives the exit/enter cycle.

The `useExplorerStore` selector for toggleTag uses a direct selector (not useFilterSlice) for consistency with the single-selector pattern used in ExpertCard and TagCloud.
  </action>
  <verify>Run `cd /Users/sebastianhamers/Documents/TCS/frontend && npm run build` — must exit 0. Confirm AnimatePresence import: `grep -n "AnimatePresence" /Users/sebastianhamers/Documents/TCS/frontend/src/components/sidebar/EverythingIsPossible.tsx` — must be present. Confirm aria-label: `grep -n "aria-label" /Users/sebastianhamers/Documents/TCS/frontend/src/components/sidebar/EverythingIsPossible.tsx` — must show `Add tag: \${currentTag}` pattern.</verify>
  <done>Build exits 0. EverythingIsPossible.tsx exports EverythingIsPossible function. AnimatePresence mode="wait" used. Each cycling tag has aria-label and handles Enter/Space keyboard events.</done>
</task>

</tasks>

<verification>
1. `cd /Users/sebastianhamers/Documents/TCS/frontend && npm run build` exits 0
2. `grep -rn "from 'motion/react'" frontend/src/components/sidebar/TagCloud.tsx` — shows import
3. `grep -n "useState" frontend/src/components/sidebar/TagCloud.tsx` — no results (motion values only)
4. `grep -n "AnimatePresence" frontend/src/components/sidebar/EverythingIsPossible.tsx` — present with mode="wait"
5. `grep -n "aria-pressed" frontend/src/components/sidebar/TagCloud.tsx` — present on TagPill
6. `grep -n "role=\"group\"" frontend/src/components/sidebar/TagCloud.tsx` — present on container
</verification>

<success_criteria>
- TagCloud.tsx: exports TagCloud, uses motion value graph (useMotionValue+useTransform+useSpring), layout="position" on pills, LayoutGroup scoped to flex container, no useState for scale, role=group + aria-pressed
- EverythingIsPossible.tsx: exports EverythingIsPossible, AnimatePresence mode="wait", cycling via setInterval, keyboard navigable (Enter/Space), aria-label on each tag button
- Both components build cleanly with zero TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/23-discovery-engine/23-02-SUMMARY.md`
</output>
