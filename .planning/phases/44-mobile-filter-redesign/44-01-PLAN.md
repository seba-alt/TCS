---
phase: 44-mobile-filter-redesign
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/components/marketplace/MobileInlineFilters.tsx
  - frontend/src/pages/MarketplacePage.tsx
  - frontend/src/components/Header.tsx
  - frontend/src/components/sidebar/MobileFilterSheet.tsx
autonomous: false
requirements:
  - MOB-01
  - MOB-02

must_haves:
  truths:
    - "On mobile, tag and sort filter buttons are visible inline below the search bar without any drawer interaction"
    - "Tapping Tags opens a full-screen tag picker showing all 30 tags with checkboxes and search"
    - "Selected tags appear as removable X chips below the filter row with a prominent Clear all button"
    - "Sort dropdown allows choosing between Relevance, Rate low-high, Rate high-low, and Alphabetical"
    - "Changing filters updates the expert grid without API hammering (debounced or AbortController-deduplicated)"
    - "Search bar spans full viewport width on mobile (logo hidden on mobile)"
    - "Sage mobile bottom sheet (Vaul) continues to open and function correctly"
  artifacts:
    - path: "frontend/src/components/marketplace/MobileInlineFilters.tsx"
      provides: "Inline filter row with tag picker, sort sheet, chips, and result count"
      min_lines: 100
    - path: "frontend/src/pages/MarketplacePage.tsx"
      provides: "Rewired marketplace page without MobileFilterSheet"
    - path: "frontend/src/components/Header.tsx"
      provides: "Full-width mobile search bar"
  key_links:
    - from: "frontend/src/components/marketplace/MobileInlineFilters.tsx"
      to: "frontend/src/store/filterSlice.ts"
      via: "useFilterSlice — toggleTag, setSortBy, resetFilters"
      pattern: "toggleTag|setSortBy|resetFilters"
    - from: "frontend/src/pages/MarketplacePage.tsx"
      to: "frontend/src/components/marketplace/MobileInlineFilters.tsx"
      via: "import and render"
      pattern: "MobileInlineFilters"
    - from: "frontend/src/components/sidebar/MobileFilterSheet.tsx"
      to: "DELETED"
      via: "File removed — Vaul drawer replaced by inline controls"
      pattern: "MobileFilterSheet"
---

<objective>
Replace the Vaul bottom-sheet filter drawer on mobile with always-visible inline dropdown controls (Tags + Sort) and make the search bar full-width on mobile.

Purpose: Mobile users currently must open and dismiss a drawer to filter experts. Inline controls eliminate this friction, making filters instantly accessible. The full-width search bar maximizes the most important input on small screens.

Output: MobileInlineFilters component, rewired MarketplacePage, full-width mobile search bar in Header, deleted MobileFilterSheet.
</objective>

<execution_context>
@/Users/sebastianhamers/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sebastianhamers/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/44-mobile-filter-redesign/44-CONTEXT.md
@.planning/phases/44-mobile-filter-redesign/44-RESEARCH.md
@frontend/src/pages/MarketplacePage.tsx
@frontend/src/components/sidebar/MobileFilterSheet.tsx
@frontend/src/components/Header.tsx
@frontend/src/store/filterSlice.ts
@frontend/src/constants/tags.ts
@frontend/src/components/marketplace/FilterChips.tsx
@frontend/src/components/marketplace/EmptyState.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create MobileInlineFilters component with tag picker, sort sheet, and chip row</name>
  <files>frontend/src/components/marketplace/MobileInlineFilters.tsx</files>
  <action>
Create `frontend/src/components/marketplace/MobileInlineFilters.tsx` — the inline mobile filter UI that replaces `MobileFilterSheet`.

**Component structure:**

The component renders three sections (all wrapped in `md:hidden`):

**1. Filter row** — a horizontal row with:
- "Tags" button: shows `Tags (N)` badge count when tags are selected, plain "Tags" otherwise. Icon: `Tag` from lucide-react. On tap: opens TagPickerSheet (full-screen overlay).
- "Sort" button: shows current sort label. Icon: `ArrowUpDown` from lucide-react. On tap: opens SortSheet (bottom panel).
- Saved button: icon + count, only shown when `savedCount > 0`. Mirrors the existing mobile saved button behavior (calls `setSavedFilter(!savedFilter)`). Style matches: `bg-brand-purple text-white` when active, `border border-gray-300 text-gray-700` when inactive.
- Result count: right-aligned, `{total} experts`, `text-xs text-gray-500 shrink-0`.
- Row styling: `flex items-center gap-2 px-4 py-2.5 border-b border-gray-100 overflow-x-auto shrink-0`.

**2. Active tag chips row** — shown only when `tags.length > 0`:
- Each selected tag rendered as a compact chip with an "X" dismiss button that calls `toggleTag(tag)`.
- Chip styling: `inline-flex items-center gap-1 text-xs bg-gray-100 text-gray-700 rounded-full px-2.5 py-1`.
- "Clear all" button: PROMINENT — `bg-brand-purple text-white font-medium text-xs rounded-full px-3 py-1 shadow-sm`. This must visually jump out (per user decision).
- Row styling: `flex gap-1.5 flex-wrap px-4 py-2 border-b border-gray-100`.

**3. Full-screen TagPickerSheet** — rendered when `tagPickerOpen` is true:
- Fixed overlay: `fixed inset-0 z-50 bg-white flex flex-col`.
- Header bar: "Select Tags" title + close button (X icon). Style: `flex items-center justify-between px-4 py-3 border-b border-gray-100`.
- Tag search input: filters tags with `tag.includes(searchTerm.toLowerCase())`. Placed below header.
- Scrollable tag list: each tag is a row with a checkbox-style indicator (filled circle or checkmark when selected). Tapping a tag calls `toggleTag(tag)` directly on the Zustand store (instant apply, no draft buffer). The `useExplore` hook's AbortController already deduplicates rapid requests, so no additional debounce is strictly required (per research). However, if you want a debounce, use a simple `useRef + setTimeout` pattern with 150ms delay.
- Use `TOP_TAGS` from `../../constants/tags` for the tag list.
- Tag row styling: `flex items-center gap-3 px-4 py-3 border-b border-gray-50 text-sm`. Selected indicator: `w-5 h-5 rounded-full bg-brand-purple` (selected) or `w-5 h-5 rounded-full border-2 border-gray-300` (unselected).
- "Done" button at bottom: closes the picker. Style: `bg-brand-purple text-white w-full py-3 font-medium text-sm`.

**4. SortSheet** — rendered when `sortOpen` is true:
- Fixed bottom panel: `fixed bottom-0 left-0 right-0 z-50 bg-white rounded-t-2xl shadow-2xl`.
- Backdrop: `fixed inset-0 z-40 bg-black/30` — tapping dismisses.
- Drag handle: `mx-auto w-10 h-1 rounded-full bg-gray-300 mt-3 mb-2`.
- Four sort options as buttons:
  - "Relevance" -> `setSortBy('relevance')`
  - "Rate: Low to High" -> `setSortBy('rate_asc')`
  - "Rate: High to Low" -> `setSortBy('rate_desc')`
  - "Name: A to Z" -> no `sortBy` value exists for alphabetical in the current filterSlice (only `'relevance' | 'rate_asc' | 'rate_desc'`). Show the button but use `setSortBy('relevance')` as fallback and add a `// TODO: add 'alpha_asc' to FilterSlice.sortBy union when API supports alphabetical sort` comment. Alternatively, omit alphabetical and only show the 3 existing options — use your judgment (the store doesn't support it).
- Currently selected option has `text-brand-purple font-medium` styling.
- Tapping an option calls `setSortBy(value)`, then closes the sheet.

**State management:**
- `tagPickerOpen` and `sortOpen` are local `useState` (ephemeral UI state, not Zustand).
- Filter data comes from `useFilterSlice()`: `tags`, `sortBy`, `toggleTag`, `setSortBy`, `resetFilters`, `savedExperts`, `savedFilter`, `setSavedFilter`.
- Result count from `useResultsSlice()`: `total`.
- Loading state from `useExplorerStore((s) => s.loading)`.

**Props:** The component takes `savedCount` and `savedFilter` / `setSavedFilter` as props, OR reads them from the store directly. Since `useFilterSlice` already exposes them, read from store directly (no props needed). The component is self-contained.

**Important constraints:**
- Do NOT use Vaul for any of these overlays — Vaul is reserved for SageMobileSheet only.
- Do NOT put debounce logic in filterSlice — store actions stay synchronous.
- Do NOT use `useShallow` for tags array in useExplore (existing pitfall, leave as-is).
- Use `motion/react` (AnimatePresence + motion.div) for open/close transitions on TagPickerSheet and SortSheet for polish.
  </action>
  <verify>
    <automated>cd /Users/sebastianhamers/Documents/TCS/frontend && ls -la src/components/marketplace/MobileInlineFilters.tsx && grep -c "toggleTag\|setSortBy\|resetFilters" src/components/marketplace/MobileInlineFilters.tsx</automated>
    <manual>Verify the file exists and references all required store actions</manual>
  </verify>
  <done>MobileInlineFilters.tsx exists with inline filter row, tag chips, full-screen tag picker, sort sheet, and all wired to Zustand store actions</done>
</task>

<task type="auto">
  <name>Task 2: Rewire MarketplacePage — replace MobileFilterSheet with MobileInlineFilters</name>
  <files>frontend/src/pages/MarketplacePage.tsx, frontend/src/components/sidebar/MobileFilterSheet.tsx</files>
  <action>
Modify `frontend/src/pages/MarketplacePage.tsx`:

**Removals:**
1. Remove the `import { MobileFilterSheet } from '../components/sidebar/MobileFilterSheet'` line.
2. Remove the `import { SlidersHorizontal } from 'lucide-react'` (no longer needed — the Filters button is gone). Keep `Bookmark` import if still used by the desktop Saved button.
3. Remove the `const [sheetOpen, setSheetOpen] = useState(false)` state.
4. Remove the entire mobile toolbar div (lines ~98-130 in current code): the `<div className="md:hidden flex items-center justify-between ...">` block that contains the h1 "Experts", Saved button, and Filters button.
5. Remove the `<MobileFilterSheet open={sheetOpen} onClose={() => setSheetOpen(false)} />` render near the bottom.
6. Remove `activeFilterCount` calculation (`const activeFilterCount = tags.length + (query ? 1 : 0)`) since it was only used by the old mobile toolbar badge.
7. Clean up: if `SlidersHorizontal` was the only import from lucide-react, remove the entire lucide import. If `Bookmark` is still needed (for desktop saved button), keep only `Bookmark`.

**Additions:**
1. Add `import { MobileInlineFilters } from '../components/marketplace/MobileInlineFilters'`.
2. Render `<MobileInlineFilters />` inside `<main>` as the FIRST child, before the desktop Saved button div and FilterChips. It should sit directly inside `<main className="flex-1 flex flex-col min-h-0">` as the first element. The component handles its own `md:hidden` visibility.

**Preserved behavior:**
- Desktop layout is unchanged: FilterSidebar, desktop Saved button, FilterChips, ExpertGrid all remain exactly as-is.
- The `useState(false)` for `sheetOpen` is removed — MobileInlineFilters manages its own open/close states internally.
- Newsletter gate modal remains unchanged.
- `useExplore`, `useUrlSync`, and all other hooks remain unchanged.
- The `savedCount` variable is still needed for the desktop Saved button (`savedCount > 0` guard on lines 133-148). Keep it.
- The `savedFilter` and `setSavedFilter` destructuring from `useFilterSlice` is still needed for the desktop Saved button. Keep it.
- `query` may no longer be needed in the destructuring if `activeFilterCount` is removed and nothing else uses it. Check and clean up.

**Delete file:**
Delete `frontend/src/components/sidebar/MobileFilterSheet.tsx` entirely. This file is replaced by `MobileInlineFilters.tsx`. Confirm that NO other file imports `MobileFilterSheet` (only `MarketplacePage.tsx` does).

**Verify vaul stays:** Confirm `vaul` is NOT removed from `package.json`. `SageMobileSheet.tsx` still imports from `vaul`. Do NOT touch `package.json`.
  </action>
  <verify>
    <automated>cd /Users/sebastianhamers/Documents/TCS/frontend && grep -r "MobileFilterSheet" src/ ; echo "---" ; grep "MobileInlineFilters" src/pages/MarketplacePage.tsx ; echo "---" ; grep "vaul" package.json</automated>
    <manual>MobileFilterSheet references should be gone (except possibly in git history). MobileInlineFilters should appear in MarketplacePage. vaul should still be in package.json.</manual>
  </verify>
  <done>MarketplacePage renders MobileInlineFilters instead of MobileFilterSheet. MobileFilterSheet.tsx is deleted. No orphaned imports. vaul remains in package.json for SageMobileSheet.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Make Header search bar full-width on mobile + visual verification</name>
  <files>frontend/src/components/Header.tsx</files>
  <action>
Modify `frontend/src/components/Header.tsx` to make the search bar span full viewport width on mobile (MOB-02).

**Change:** The logo `<div className="relative shrink-0">` wrapper (lines 69-97) should be hidden on mobile:
- Add `hidden md:block` to the logo wrapper div: `<div className="relative shrink-0 hidden md:block">`.
- This hides the logo (and its particle burst) on mobile, allowing the search bar (`flex-1 max-w-2xl`) to take the full header width.
- On desktop (`md:` and up), the logo remains visible as before.

**Alternative (if hiding the logo feels too aggressive):** Instead of hiding the logo entirely, make the search bar wrapper `max-w-2xl md:max-w-2xl max-w-none` — but `hidden md:block` on the logo is cleaner and was recommended in the research.

**Also consider:** The `max-w-2xl` on the search bar wrapper div (line 100: `<div className="relative flex-1 max-w-2xl">`) constrains width on all screens. On mobile with the logo hidden, this should be relaxed. Change to `<div className="relative flex-1 max-w-full md:max-w-2xl">` so the search bar actually fills the available space on mobile.

**Expert count:** The expert count div (line 202: `<div className="hidden md:block shrink-0 ...">`) is already hidden on mobile. No change needed.
  </action>
  <what-built>Complete mobile filter redesign: inline filter controls (Tags + Sort dropdowns), active tag chips with Clear all, full-width search bar, and removed MobileFilterSheet drawer</what-built>
  <how-to-verify>
    1. Run `cd /Users/sebastianhamers/Documents/TCS/frontend && npm run build` — confirm no build errors
    2. Run `cd /Users/sebastianhamers/Documents/TCS/frontend && npm run dev` — open http://localhost:5173/explore
    3. Open Chrome DevTools, toggle device toolbar (Ctrl+Shift+M), select a mobile viewport (e.g. iPhone 14)
    4. Verify: search bar spans the full width of the viewport (no logo visible on mobile)
    5. Verify: below the search bar, a filter row is visible with "Tags" and "Sort" buttons, plus a result count
    6. Tap "Tags" — a full-screen tag picker should open with all tags listed and a search box
    7. Select 2-3 tags, tap "Done" — chips should appear below the filter row with "X" dismiss buttons and a prominent purple "Clear all" button
    8. Tap "Sort" — a bottom sheet with sort options should appear
    9. Tap "Clear all" — all tag chips should disappear
    10. Resize to desktop (>768px) — the sidebar filters and logo should reappear, no inline filter row should be visible
    11. On mobile, tap the Sage FAB — the Sage bottom sheet (Vaul) should open normally
  </how-to-verify>
  <verify>
    <automated>cd /Users/sebastianhamers/Documents/TCS/frontend && npm run build 2>&1 | tail -5</automated>
    <manual>Visual check on mobile viewport: inline filters visible, tag picker works, sort works, search bar full-width, Sage FAB opens</manual>
  </verify>
  <done>Header search bar spans full viewport width on mobile. Build succeeds. All mobile filter controls verified visually.</done>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
1. `cd /Users/sebastianhamers/Documents/TCS/frontend && npm run build` — no TypeScript or build errors
2. `grep -r "MobileFilterSheet" frontend/src/` returns no results (file fully removed)
3. `grep "vaul" frontend/package.json` returns a match (vaul package preserved)
4. `wc -l frontend/src/components/marketplace/MobileInlineFilters.tsx` returns 100+ lines
5. Mobile viewport in browser: inline filter row visible, tag picker works, sort works, search bar full-width
6. Desktop viewport: sidebar filters present, no inline filter row visible, logo visible
7. Sage FAB on mobile: opens Vaul bottom sheet normally (not broken)
</verification>

<success_criteria>
- MobileInlineFilters component exists and renders inline filters on mobile only
- MarketplacePage uses MobileInlineFilters (not MobileFilterSheet)
- MobileFilterSheet.tsx is deleted
- Header search bar is full-width on mobile (logo hidden on mobile)
- Tags dropdown opens a full-screen picker with all 30 tags
- Sort dropdown opens a bottom panel with sort options
- Selected tags appear as dismissable chips with a prominent Clear all button
- Tags button shows badge count when tags are selected
- Result count displayed near filter row
- vaul package remains for SageMobileSheet
- No build errors
</success_criteria>

<output>
After completion, create `.planning/phases/44-mobile-filter-redesign/44-01-SUMMARY.md`
</output>
