---
phase: 40.2-uat-fixes-and-browse-explorer-enhancements
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/components/browse/BrowseCard.tsx
  - frontend/src/components/browse/BrowseRow.tsx
  - frontend/src/components/browse/HeroBanner.tsx
  - frontend/src/pages/BrowsePage.tsx
autonomous: true
requirements: [UAT-BROWSE-CARDS, UAT-HERO-TAGLINES, UAT-EMAIL-GATE, UAT-SAGE-FIX]

must_haves:
  truths:
    - "BrowseCard name, rate, and tags are pinned to the bottom of every card — alignment is consistent across all cards in a row regardless of photo vs monogram"
    - "First card in each BrowseRow has visible spacing from the left edge"
    - "HeroBanner displays a category-relevant tagline that fills the open gradient space"
    - "Browse page shows email gate modal when user tries to open an expert profile without having submitted email"
    - "Sage discovery search on Browse finds results via hybrid search and navigates to Explorer"
  artifacts:
    - path: "frontend/src/components/browse/BrowseCard.tsx"
      provides: "Bottom-pinned name/rate/tags with consistent alignment"
    - path: "frontend/src/components/browse/HeroBanner.tsx"
      provides: "Category-specific taglines in hero gradient"
    - path: "frontend/src/pages/BrowsePage.tsx"
      provides: "Email gate modal integration + profile view handler"
  key_links:
    - from: "frontend/src/pages/BrowsePage.tsx"
      to: "frontend/src/components/marketplace/NewsletterGateModal.tsx"
      via: "import and conditional render with useNltrStore"
      pattern: "NewsletterGateModal"
    - from: "frontend/src/components/browse/BrowseCard.tsx"
      to: "frontend/src/pages/BrowsePage.tsx"
      via: "onViewProfile callback prop"
      pattern: "onViewProfile"
---

<objective>
Fix Browse page UAT issues: BrowseCard bottom alignment, hero banner taglines, email gate, and Sage search behavior.

Purpose: Address four Browse page issues from UAT testing — cards with inconsistent text alignment, empty hero banner gradient space, missing email gate, and Sage search not working properly.
Output: BrowsePage with consistent card layout, informative hero taglines, email-gated profile access, and reliable Sage discovery.
</objective>

<execution_context>
@/Users/sebastianhamers/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sebastianhamers/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/phases/40.2-uat-fixes-and-browse-explorer-enhancements/40.2-CONTEXT.md
@.planning/phases/40.2-uat-fixes-and-browse-explorer-enhancements/40.2-RESEARCH.md
@frontend/src/components/browse/BrowseCard.tsx
@frontend/src/components/browse/BrowseRow.tsx
@frontend/src/components/browse/HeroBanner.tsx
@frontend/src/pages/BrowsePage.tsx
@frontend/src/pages/MarketplacePage.tsx
@frontend/src/hooks/useSage.ts
@frontend/src/store/nltrStore.ts
@frontend/src/components/marketplace/NewsletterGateModal.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix BrowseCard alignment + BrowseRow first-card spacing</name>
  <files>frontend/src/components/browse/BrowseCard.tsx, frontend/src/components/browse/BrowseRow.tsx</files>
  <action>
**BrowseCard.tsx — Bottom-pin name/rate/tags:**
The current overlay div (absolute bottom-0) already pins to bottom, but the content inside can shift vertically depending on whether tags are visible. Ensure consistent alignment by:
1. Keep the overlay div as-is (absolute bottom-0 left-0 right-0 p-3 with gradient).
2. Inside the overlay, use `flex flex-col justify-end` so content stacks from the bottom regardless of tag visibility.
3. The name line (`<p>` with `text-sm font-semibold`), rate line, and tags div should remain in order, all pinned to the bottom of the overlay.

**BrowseCard.tsx — Add onViewProfile callback prop:**
1. Add `onViewProfile?: (url: string) => void` to `BrowseCardProps` interface.
2. In the `handleClick` function, when `expanded` is true (second tap): instead of directly calling `window.open`, call `onViewProfile(expert.profile_url)` if the callback exists, otherwise fall back to `window.open`.
3. This enables the parent (BrowsePage) to intercept profile opens for email gating.

**BrowseRow.tsx — First card left spacing:**
The scroll container already has `px-4 md:px-8` (16px/32px). The left fade overlay is `w-16` (64px) which may partially cover the first card. Fix:
1. Increase scroll container left padding to `pl-8 md:pl-16` (32px/64px) so the first card sits clearly past the fade edge.
2. Keep right padding as `pr-4 md:pr-8` — asymmetric is fine since the right fade provides visual continuity.
3. Update the class string from `px-4 md:px-8` to `pl-8 md:pl-16 pr-4 md:pr-8`.
  </action>
  <verify>Run `cd frontend && npx tsc --noEmit` — zero type errors. Visually: cards in a row should show name/rate at the same vertical position. First card should not be hidden under the left fade.</verify>
  <done>BrowseCard name/rate/tags are bottom-pinned consistently. BrowseCard accepts onViewProfile callback. First card in each row has clear left spacing past the fade overlay.</done>
</task>

<task type="auto">
  <name>Task 2: Add hero banner taglines + email gate on Browse + Sage search reliability</name>
  <files>frontend/src/components/browse/HeroBanner.tsx, frontend/src/pages/BrowsePage.tsx, frontend/src/hooks/useSage.ts</files>
  <action>
**HeroBanner.tsx — Category-specific taglines:**
The HeroBanner currently shows featured expert name/title/company in the gradient. The gradient has open space. Add a tagline above or near the expert info that relates to the featured expert's category/domain.

1. Add a `CATEGORY_TAGLINES` map at the top of the file:
```typescript
const CATEGORY_TAGLINES: Record<string, string> = {
  'ai': 'Find your next AI innovator',
  'blockchain': 'Connect with blockchain pioneers',
  'cybersecurity': 'Secure your future with top defenders',
  'data-science': 'Unlock insights with data experts',
  'cloud': 'Scale with cloud architecture leaders',
  'devops': 'Streamline your pipeline with DevOps pros',
  'mobile': 'Build brilliant mobile experiences',
  'design': 'Elevate your product with design talent',
  'marketing': 'Amplify your brand with marketing minds',
  'finance': 'Navigate complexity with financial experts',
  'default': 'Discover world-class expertise',
}
```
2. Derive the tagline from the current featured expert's `category` field (or first tag as fallback):
```typescript
const taglineKey = current.category?.toLowerCase() ?? current.tags[0]?.toLowerCase() ?? 'default'
const tagline = CATEGORY_TAGLINES[taglineKey] ?? CATEGORY_TAGLINES['default']
```
3. Render the tagline in the expert info area (bottom left), ABOVE the expert name `<h2>`:
```tsx
<p className="text-xs md:text-sm font-medium text-purple-200 uppercase tracking-wider mb-2">
  {tagline}
</p>
```

**BrowsePage.tsx — Email gate integration:**
Replicate the exact email gate pattern from MarketplacePage.tsx:

1. Import `NewsletterGateModal` from `../components/marketplace/NewsletterGateModal`
2. Import `useNltrStore` from `../store/nltrStore`
3. Add the same state and handlers as MarketplacePage:
   - `const { subscribed, setSubscribed } = useNltrStore()`
   - `legacyUnlocked` check (same two localStorage keys)
   - `isUnlocked = subscribed || legacyUnlocked`
   - `showGate` and `pendingProfileUrl` state
   - `handleViewProfile(url: string)` function — checks isUnlocked, shows gate or opens profile
   - `handleSubscribe(email: string)` function — same fire-and-forget pattern with API_URL
   - `handleDismiss()` function — closes modal without clearing pending URL
4. Pass `onViewProfile={handleViewProfile}` to each `<BrowseCard>` in BrowseRow via a new prop on BrowseRow, OR pass it directly from BrowsePage.

Since BrowseRow renders BrowseCards, add `onViewProfile` to BrowseRowProps and pass it through:
- Add `onViewProfile?: (url: string) => void` to BrowseRowProps
- Pass it to each `<BrowseCard onViewProfile={onViewProfile} />`
- In BrowsePage, pass `onViewProfile={handleViewProfile}` to each `<BrowseRow>`

5. Add `<NewsletterGateModal>` at the bottom of BrowsePage JSX (same as MarketplacePage).
6. Add `const API_URL = import.meta.env.VITE_API_URL ?? 'http://localhost:8000'` at top.

**useSage.ts — Sage search reliability on Browse:**
Review the current Browse path in useSage. The backend pipeline already uses hybrid search (pilot_service.py calls run_explore). The issue may be that `current_filters` sent from the store could confuse Gemini when on Browse. No structural changes needed to the search pipeline itself. However, add a small improvement:

1. When NOT on Explorer (`!isExplorer`), send `current_filters` as empty/reset state to the API to avoid confusing Gemini with stale filter state from a previous Explorer session:
```typescript
const currentFilters = isExplorer ? {
  query: storeState.query,
  rate_min: storeState.rateMin,
  rate_max: storeState.rateMax,
  tags: storeState.tags,
} : { query: '', rate_min: 0, rate_max: 5000, tags: [] }
```
This ensures Gemini on Browse always sees a clean filter state and is more likely to call `search_experts` (discovery) rather than `apply_filters` (refinement).
  </action>
  <verify>Run `cd frontend && npx tsc --noEmit` — zero type errors. Check: HeroBanner shows tagline text above expert name. BrowsePage email gate modal appears when clicking a card without email. Sage on Browse sends empty filters to API.</verify>
  <done>HeroBanner displays category-relevant taglines. Browse page has email gate matching Explorer behavior. Sage on Browse sends clean filter state for reliable discovery searches.</done>
</task>

</tasks>

<verification>
- [ ] BrowseCard text alignment is consistent across all cards in a row
- [ ] First card in each BrowseRow has visible spacing from the left edge
- [ ] HeroBanner shows a tagline related to the featured expert's domain
- [ ] Clicking a BrowseCard without email shows the newsletter gate modal
- [ ] After submitting email, BrowseCard clicks open profiles directly
- [ ] Sage discovery search on Browse triggers search_experts reliably
- [ ] TypeScript compilation passes with zero errors
</verification>

<success_criteria>
All four Browse UAT issues resolved: card alignment, hero taglines, email gate, Sage search. TypeScript compiles cleanly. No regressions in existing Browse functionality.
</success_criteria>

<output>
After completion, create `.planning/phases/40.2-uat-fixes-and-browse-explorer-enhancements/40.2-01-SUMMARY.md`
</output>
