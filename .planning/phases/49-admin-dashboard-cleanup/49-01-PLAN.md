---
phase: 49-admin-dashboard-cleanup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/main.tsx
  - frontend/src/admin/pages/OverviewPage.tsx
autonomous: true
requirements:
  - ADM-04

must_haves:
  truths:
    - "Navigating to /admin/search-lab, /admin/score-explainer, /admin/index, /admin/searches, or /admin/marketplace redirects to /admin (overview)"
    - "Navigating to any unknown /admin/xyz route redirects to /admin (overview), not a 404"
    - "All 8 existing admin pages (Overview, Gaps, Intelligence, Data, Tools, Experts, Leads, Settings) still load correctly"
    - "The overview page shows a Recent Leads section with 5 items and a 'View all' link to /admin/leads"
    - "The overview page shows a Recent Searches section with 5 items and a 'View all' link to /admin/data"
    - "Overview data loads on page visit only — no polling or auto-refresh for the new sections"
  artifacts:
    - path: "frontend/src/main.tsx"
      provides: "Clean admin route children without legacy redirects, with catch-all"
      contains: "path: '*'"
    - path: "frontend/src/admin/pages/OverviewPage.tsx"
      provides: "Overview page with Recent Leads and Recent Searches cards"
      contains: "RecentLeadsCard"
  key_links:
    - from: "frontend/src/admin/pages/OverviewPage.tsx"
      to: "/api/admin/leads"
      via: "adminFetch in RecentLeadsCard useEffect"
      pattern: "adminFetch.*'/leads'"
    - from: "frontend/src/admin/pages/OverviewPage.tsx"
      to: "/api/admin/searches"
      via: "adminFetch in RecentSearchesCard useEffect"
      pattern: "adminFetch.*'/searches'"
---

<objective>
Remove legacy redirect routes from the admin router, add a catch-all redirect for unknown admin paths, and consolidate the overview page with recent leads and recent searches sections.

Purpose: Simplify admin navigation so unknown/old bookmarks gracefully redirect to the overview, and surface the most important marketplace signals (recent leads, recent searches) on the overview without requiring navigation to sub-pages.
Output: Updated main.tsx (route cleanup) and OverviewPage.tsx (new data sections).
</objective>

<execution_context>
@/Users/sebastianhamers/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sebastianhamers/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/49-admin-dashboard-cleanup/49-RESEARCH.md

@frontend/src/main.tsx
@frontend/src/admin/pages/OverviewPage.tsx
@frontend/src/admin/hooks/useAdminData.ts
@frontend/src/admin/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove legacy redirect routes and add catch-all in main.tsx</name>
  <files>frontend/src/main.tsx</files>
  <action>
In `frontend/src/main.tsx`, inside the `/admin` route's children array (within the `AdminApp` element wrapper):

1. **Delete these 5 redirect route entries** (currently lines 105-109):
   ```tsx
   { path: 'search-lab',      element: <Navigate to="/admin/tools" replace /> },
   { path: 'score-explainer', element: <Navigate to="/admin/tools" replace /> },
   { path: 'index',           element: <Navigate to="/admin/tools" replace /> },
   { path: 'searches',        element: <Navigate to="/admin/data" replace /> },
   { path: 'marketplace',     element: <Navigate to="/admin/data" replace /> },
   ```

2. **Add a catch-all route as the LAST entry** in the same children array:
   ```tsx
   { path: '*', element: <Navigate to="/admin" replace /> },
   ```
   This must be the final entry after `{ path: 'data', element: <DataPage /> }`. The catch-all uses `<Navigate>` (not `<RedirectWithParams>`) since no query params need preservation for unknown admin routes. The `replace` prop prevents back-button loops.

3. **Remove the comment** `// Redirects from old standalone URLs` since the redirects are gone.

Do NOT touch:
- The `{ index: true, element: <OverviewPage /> }` entry (this is the index route, different from `{ path: 'index', ... }`)
- Any of the 8 active page routes (overview, gaps, leads, experts, settings, intelligence, tools, data)
- The `RedirectWithParams` component or any top-level legacy redirects (/explore, /browse, /marketplace, /chat)
  </action>
  <verify>
    <automated>cd /Users/sebastianhamers/Documents/TCS/frontend && npx vite build 2>&1 | tail -5</automated>
    <manual>Verify main.tsx no longer contains 'search-lab', 'score-explainer', path 'index', 'searches', or 'marketplace' in admin children, and contains path '*' as the last child</manual>
  </verify>
  <done>The 5 legacy redirect routes are removed from the admin children array, a catch-all `{ path: '*' }` route redirects unknown admin paths to /admin, and all 8 active page routes remain intact. Build succeeds.</done>
</task>

<task type="auto">
  <name>Task 2: Add Recent Leads and Recent Searches cards to the overview page</name>
  <files>frontend/src/admin/pages/OverviewPage.tsx</files>
  <action>
In `frontend/src/admin/pages/OverviewPage.tsx`, add two new self-contained card components and render them in a new section below the existing content.

**1. Add `RecentLeadsCard` component** (above the `export default function OverviewPage()` line):

Follow the exact same pattern as the existing `TopZeroResultsCard`:
- Uses `useState` + `useEffect` with `adminFetch` (already imported).
- Fetches from `/leads` (the existing leads endpoint, same as `useAdminLeads`).
- Shows 5 most recent leads in a compact table format.
- Each row shows: email (truncated), total searches count, and relative time of last search.
- Loading state: `<p className="text-slate-500 text-sm animate-pulse">Loading…</p>`
- Empty state: `<p className="text-slate-500 text-sm">No leads yet</p>`
- Header row with "Recent Leads" title and a `<Link to="/admin/leads">View all →</Link>` (same style as TopZeroResultsCard's "See all →" link: `text-xs text-purple-400 hover:text-purple-300 transition-colors`).
- Import `LeadsResponse` type from `'../types'`.

Sort leads by `last_search_at` descending (most recent first) and slice to 5. Format `last_search_at` as a relative time string using a simple helper (e.g., "2h ago", "3d ago") — create a small `timeAgo(isoString: string)` helper function within the file.

```tsx
function RecentLeadsCard() {
  const [data, setData] = useState<LeadsResponse | null>(null)
  const [loading, setLoading] = useState(true)

  useEffect(() => {
    adminFetch<LeadsResponse>('/leads')
      .then(setData)
      .catch(() => setData(null))
      .finally(() => setLoading(false))
  }, [])

  const rows = (data?.leads ?? [])
    .filter(l => l.last_search_at)
    .sort((a, b) => new Date(b.last_search_at!).getTime() - new Date(a.last_search_at!).getTime())
    .slice(0, 5)

  return (
    <div className="bg-slate-800/60 border border-slate-700/60 rounded-xl p-5">
      <div className="flex items-center justify-between mb-4">
        <h2 className="text-sm font-semibold text-white">Recent Leads</h2>
        <Link to="/admin/leads" className="text-xs text-purple-400 hover:text-purple-300 transition-colors">
          View all →
        </Link>
      </div>
      {loading ? (
        <p className="text-slate-500 text-sm animate-pulse">Loading…</p>
      ) : rows.length === 0 ? (
        <p className="text-slate-500 text-sm">No leads yet</p>
      ) : (
        <div className="space-y-2">
          {rows.map((row) => (
            <div key={row.email} className="flex items-center justify-between">
              <span className="text-sm text-slate-300 truncate max-w-[60%]" title={row.email}>{row.email}</span>
              <div className="flex items-center gap-3 flex-shrink-0 ml-2">
                <span className="text-xs text-slate-500">{row.total_searches} searches</span>
                <span className="text-xs text-slate-500">{timeAgo(row.last_search_at!)}</span>
              </div>
            </div>
          ))}
        </div>
      )}
    </div>
  )
}
```

**2. Add `RecentSearchesCard` component** (similar pattern):

- Fetches from `/searches` with `{ page: 0, page_size: 5 }` params (uses pagination to limit server response).
- Import `SearchesResponse` type from `'../types'`.
- Shows 5 most recent searches.
- Each row shows: query text (truncated), source badge ("sage" / "chat"), and relative time.
- Same header pattern with "Recent Searches" title and `<Link to="/admin/data">View all →</Link>`.

```tsx
function RecentSearchesCard() {
  const [data, setData] = useState<SearchesResponse | null>(null)
  const [loading, setLoading] = useState(true)

  useEffect(() => {
    adminFetch<SearchesResponse>('/searches', { page: 0, page_size: 5 })
      .then(setData)
      .catch(() => setData(null))
      .finally(() => setLoading(false))
  }, [])

  const rows = data?.rows ?? []

  return (
    <div className="bg-slate-800/60 border border-slate-700/60 rounded-xl p-5">
      <div className="flex items-center justify-between mb-4">
        <h2 className="text-sm font-semibold text-white">Recent Searches</h2>
        <Link to="/admin/data" className="text-xs text-purple-400 hover:text-purple-300 transition-colors">
          View all →
        </Link>
      </div>
      {loading ? (
        <p className="text-slate-500 text-sm animate-pulse">Loading…</p>
      ) : rows.length === 0 ? (
        <p className="text-slate-500 text-sm">No searches yet</p>
      ) : (
        <div className="space-y-2">
          {rows.map((row) => (
            <div key={row.id} className="flex items-center justify-between">
              <span className="text-sm text-slate-300 truncate max-w-[60%]" title={row.query}>{row.query}</span>
              <div className="flex items-center gap-3 flex-shrink-0 ml-2">
                <span className={`text-xs px-1.5 py-0.5 rounded font-medium ${
                  row.source === 'sage' ? 'bg-cyan-900/50 text-cyan-400' : 'bg-indigo-900/50 text-indigo-400'
                }`}>{row.source}</span>
                <span className="text-xs text-slate-500">{timeAgo(row.created_at)}</span>
              </div>
            </div>
          ))}
        </div>
      )}
    </div>
  )
}
```

**3. Add `timeAgo` helper** (at the top of the file, after imports):

```tsx
function timeAgo(iso: string): string {
  const seconds = Math.floor((Date.now() - new Date(iso).getTime()) / 1000)
  if (seconds < 60) return 'just now'
  const minutes = Math.floor(seconds / 60)
  if (minutes < 60) return `${minutes}m ago`
  const hours = Math.floor(minutes / 60)
  if (hours < 24) return `${hours}h ago`
  const days = Math.floor(hours / 24)
  return `${days}d ago`
}
```

**4. Render the new cards** in the OverviewPage component:

Add a new section BELOW the existing "Section 2" (the `TopZeroResultsCard` + `SageSparklineCard` grid). Insert between the existing Section 2 and Section 3:

```tsx
{/* Section 2.5: Recent activity — leads + searches */}
<div className="grid grid-cols-1 xl:grid-cols-2 gap-6">
  <RecentLeadsCard />
  <RecentSearchesCard />
</div>
```

**5. Update the type import** at the top of the file:

Add `LeadsResponse` and `SearchesResponse` to the existing import from `'../types'`:
```tsx
import type { DemandResponse, LeadsResponse, SearchesResponse } from '../types'
```

Do NOT add polling or auto-refresh for these sections. Data loads once on mount via `useEffect([], [])`.
  </action>
  <verify>
    <automated>cd /Users/sebastianhamers/Documents/TCS/frontend && npx vite build 2>&1 | tail -5</automated>
    <manual>Check OverviewPage.tsx contains RecentLeadsCard and RecentSearchesCard components, both with adminFetch calls and "View all" links</manual>
  </verify>
  <done>OverviewPage shows Recent Leads (5 items, sorted by recency, with "View all" linking to /admin/leads) and Recent Searches (5 items with source badge, with "View all" linking to /admin/data) below the existing insight cards. No polling — data loads once on page visit.</done>
</task>

</tasks>

<verification>
1. `cd frontend && npx vite build` succeeds with no errors
2. In main.tsx: grep confirms no `search-lab`, `score-explainer`, path `index`, `searches`, or `marketplace` entries in admin children
3. In main.tsx: grep confirms `path: '*'` exists as the catch-all inside admin children
4. In OverviewPage.tsx: grep confirms `RecentLeadsCard` and `RecentSearchesCard` components exist
5. In OverviewPage.tsx: grep confirms `adminFetch` calls to `/leads` and `/searches`
6. In OverviewPage.tsx: grep confirms `Link to="/admin/leads"` and `Link to="/admin/data"` ("View all" links)
7. All 8 active admin page routes still present in main.tsx (overview, gaps, leads, experts, settings, intelligence, tools, data)
</verification>

<success_criteria>
- Legacy redirect routes removed: navigating to /admin/search-lab (or any of the 5) redirects to /admin
- Catch-all active: navigating to /admin/anything-unknown redirects to /admin
- All 8 admin pages still accessible from sidebar
- Overview page surfaces recent leads and recent searches with compact rows and "View all" links
- No auto-refresh or polling on the new overview sections
- Vite build succeeds with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/49-admin-dashboard-cleanup/49-01-SUMMARY.md`
</output>
