---
phase: 17-expert-grid-cards
plan: "02"
type: execute
wave: 2
depends_on: ["17-01"]
files_modified:
  - frontend/src/components/marketplace/ExpertCard.tsx
  - frontend/src/components/marketplace/EmptyState.tsx
  - frontend/src/components/marketplace/ExpertGrid.tsx
  - frontend/src/pages/MarketplacePage.tsx
autonomous: true
requirements: [MARKET-02, MARKET-03, MARKET-04, MARKET-05]

must_haves:
  truths:
    - "Expert cards display name, job title, company, hourly rate with currency, domain tag pills, findability badge (text label), and match reason when a search query is active"
    - "Cards animate on mount with slide-up + fade in; stagger delay is index-based with 50ms per card capped at 400ms; NO exit prop on card motion component"
    - "Clicking a domain tag pill on a card adds that tag to sidebar filters and triggers re-fetch"
    - "VirtuosoGrid renders the expert list with 2 columns on mobile, 3 on desktop, 16px gap, padding not margin"
    - "When useExplore returns zero experts and is not loading, the empty state illustration + co-pilot CTA placeholder is shown"
    - "VirtuosoGrid endReached calls loadNextPage; a skeleton footer row appears while isFetchingMore is true"
    - "MarketplacePage replaces the Phase 16 placeholder div with ExpertGrid"
  artifacts:
    - path: "frontend/src/components/marketplace/ExpertCard.tsx"
      provides: "Expert card with motion animation, tag pills, findability badge, match reason"
      min_lines: 60
    - path: "frontend/src/components/marketplace/EmptyState.tsx"
      provides: "Zero-results state with illustration and co-pilot CTA placeholder"
      min_lines: 15
    - path: "frontend/src/components/marketplace/ExpertGrid.tsx"
      provides: "VirtuosoGrid wrapper with infinite scroll and skeleton footer"
      min_lines: 40
    - path: "frontend/src/pages/MarketplacePage.tsx"
      provides: "MarketplacePage wired with ExpertGrid replacing placeholder"
      contains: "ExpertGrid"
  key_links:
    - from: "frontend/src/components/marketplace/ExpertCard.tsx"
      to: "frontend/src/store"
      via: "useExplorerStore toggleTag selector"
      pattern: "toggleTag"
    - from: "frontend/src/components/marketplace/ExpertGrid.tsx"
      to: "frontend/src/hooks/useExplore.ts"
      via: "endReached={onEndReached} prop"
      pattern: "endReached"
    - from: "frontend/src/pages/MarketplacePage.tsx"
      to: "frontend/src/components/marketplace/ExpertGrid.tsx"
      via: "JSX render replacing placeholder div"
      pattern: "ExpertGrid"
---

<objective>
Build the ExpertCard, EmptyState, and ExpertGrid components, then wire ExpertGrid into MarketplacePage — replacing the Phase 16 placeholder div with the live expert browsing experience.

Purpose: This is the core browsing interface of the marketplace. Users can finally see all experts, browse with infinite scroll, click tag pills to filter, and see animated entry of each card.

Output: Three new marketplace components (ExpertCard, EmptyState, ExpertGrid) and an updated MarketplacePage that renders the real grid.
</objective>

<execution_context>
@/Users/sebastianhamers/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sebastianhamers/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@frontend/src/store/resultsSlice.ts
@frontend/src/hooks/useExplore.ts
@frontend/src/store/index.ts
@frontend/src/pages/MarketplacePage.tsx
@frontend/src/components/marketplace/SkeletonGrid.tsx
@.planning/phases/17-expert-grid-cards/17-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ExpertCard and EmptyState components</name>
  <files>
    frontend/src/components/marketplace/ExpertCard.tsx
    frontend/src/components/marketplace/EmptyState.tsx
  </files>
  <action>
Create frontend/src/components/marketplace/ExpertCard.tsx:

The ExpertCard uses the Expert type from resultsSlice.ts (snake_case fields from Plan 01 fix). It uses motion/react for entry animation — entry only, NO exit prop.

```tsx
// KEY CONSTRAINTS (from STATE.md and RESEARCH.md):
// - Import from 'motion/react' (new package name, NOT 'framer-motion')
// - NO exit prop on motion.div — entry-only animation (exit prop breaks VirtuosoGrid virtualization)
// - Use index prop for stagger: delay: Math.min(index * 0.05, 0.4)
// - Card uses PADDING not margin on outer div (Virtuoso measures contentRect excluding margin)
// - toggleTag from useExplorerStore (individual selector, not useShallow) for tag pill onClick

import type { Expert } from '../../store/resultsSlice'
import { motion } from 'motion/react'
import { useExplorerStore } from '../../store'

interface ExpertCardProps {
  expert: Expert
  index: number  // Required for stagger delay
}

// Findability badge label — thresholds from Phase 14 (score range 50-100, neutral at 75)
function findabilityLabel(score: number | null): 'Top Match' | 'Good Match' | null {
  if (score === null) return null
  if (score >= 88) return 'Top Match'
  if (score >= 75) return 'Good Match'
  return null
}

export function ExpertCard({ expert, index }: ExpertCardProps) {
  const toggleTag = useExplorerStore((s) => s.toggleTag)
  const badgeLabel = findabilityLabel(expert.findability_score)

  return (
    <motion.div
      initial={{ opacity: 0, y: 12 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{
        duration: 0.3,
        delay: Math.min(index * 0.05, 0.4),
        ease: 'easeOut',
      }}
      // NO exit prop — entry-only animation (see STATE.md Phase 17 architectural constraint)
      className="bg-white rounded-xl shadow-sm border border-gray-100 p-4 flex flex-col gap-2 h-[180px] overflow-hidden"
    >
      {/* Primary hierarchy: name (large) + job title + company */}
      <div className="min-w-0">
        <h3 className="font-semibold text-gray-900 text-sm leading-snug truncate">
          {expert.first_name} {expert.last_name}
        </h3>
        <p className="text-xs text-gray-500 truncate">{expert.job_title}</p>
        <p className="text-xs text-gray-400 truncate">{expert.company}</p>
      </div>

      {/* Rate + Findability badge (text label, not numeric score — per CONTEXT.md decision) */}
      <div className="flex items-center gap-2 flex-wrap">
        <span className="text-xs font-semibold text-brand-purple whitespace-nowrap">
          {expert.currency} {expert.hourly_rate}/hr
        </span>
        {badgeLabel && (
          <span className="text-xs bg-green-50 text-green-700 rounded-full px-2 py-0.5 whitespace-nowrap">
            {badgeLabel}
          </span>
        )}
      </div>

      {/* Domain tag pills — clicking adds tag to sidebar filters (MARKET-04 locked decision) */}
      <div className="flex flex-wrap gap-1 overflow-hidden">
        {expert.tags.slice(0, 3).map((tag) => (
          <button
            key={tag}
            onClick={() => toggleTag(tag)}
            className="text-xs bg-gray-100 text-gray-600 rounded-full px-2 py-0.5 hover:bg-brand-purple hover:text-white transition-colors whitespace-nowrap"
          >
            {tag}
          </button>
        ))}
      </div>

      {/* Match reason — shown only when present (active search query produces match_reason) */}
      {expert.match_reason && (
        <p className="text-xs text-gray-500 line-clamp-2 border-t border-gray-100 pt-1.5 mt-auto">
          {expert.match_reason}
        </p>
      )}
    </motion.div>
  )
}
```

Create frontend/src/components/marketplace/EmptyState.tsx:

Shown when experts array is empty and loading is false. Shows a simple illustration (use a search/person SVG icon from lucide-react), short message, and a placeholder CTA pointing toward where the AI co-pilot will be (Phase 18 wires this up).

```tsx
import { Search } from 'lucide-react'

export function EmptyState() {
  return (
    <div className="flex flex-col items-center justify-center h-full min-h-[400px] gap-4 text-center px-8">
      <div className="w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center">
        <Search className="w-8 h-8 text-gray-400" />
      </div>
      <div>
        <h3 className="font-semibold text-gray-700 text-base mb-1">No experts found</h3>
        <p className="text-sm text-gray-500 max-w-xs">
          Try adjusting your filters, or describe what you need to the AI co-pilot.
        </p>
      </div>
      {/* Phase 18 will wire this CTA to open the co-pilot panel */}
      <button
        className="text-sm text-brand-purple font-medium border border-brand-purple rounded-lg px-4 py-2 hover:bg-brand-purple hover:text-white transition-colors"
        onClick={() => {/* co-pilot CTA — will be wired in Phase 18 */}}
      >
        Try the AI Co-Pilot
      </button>
    </div>
  )
}
```

After creating both files, run npm run build from frontend/ and fix any TypeScript errors.
  </action>
  <verify>
    npm run build from frontend/ passes with no TypeScript errors.
    Confirm ExpertCard uses motion/react (not framer-motion): grep -n "motion/react" frontend/src/components/marketplace/ExpertCard.tsx
    Confirm NO exit prop: grep -n "exit=" frontend/src/components/marketplace/ExpertCard.tsx must return nothing.
    Confirm toggleTag wired: grep -n "toggleTag" frontend/src/components/marketplace/ExpertCard.tsx returns a hit.
    Confirm snake_case field access: grep -n "first_name\|job_title\|hourly_rate" frontend/src/components/marketplace/ExpertCard.tsx returns hits.
  </verify>
  <done>
    ExpertCard renders with: motion/react slide-up+fade animation (entry only, no exit), name+title+company, rate with currency, findability badge (text label), up to 3 clickable tag pills, match reason when present.
    EmptyState renders with illustration, message, and placeholder co-pilot CTA.
    npm run build passes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ExpertGrid and wire into MarketplacePage</name>
  <files>
    frontend/src/components/marketplace/ExpertGrid.tsx
    frontend/src/pages/MarketplacePage.tsx
  </files>
  <action>
Create frontend/src/components/marketplace/ExpertGrid.tsx:

Uses VirtuosoGrid from react-virtuoso. CRITICAL constraints from RESEARCH.md:
- Use listClassName for CSS grid (not margin on items — breaks Virtuoso scroll height calculation)
- itemClassName="min-h-0" to prevent grid blowout
- overscan={200} to help endReached fire on small datasets
- computeItemKey uses expert.username (stable key)
- Footer component shows skeleton while isFetchingMore
- No AnimatePresence on card items — VirtuosoGrid controls the DOM

```tsx
import { VirtuosoGrid } from 'react-virtuoso'
import type { Expert } from '../../store/resultsSlice'
import { ExpertCard } from './ExpertCard'
import { EmptyState } from './EmptyState'
import { SkeletonGrid } from './SkeletonGrid'

interface ExpertGridProps {
  experts: Expert[]
  loading: boolean
  isFetchingMore: boolean
  onEndReached: () => void
}

// Skeleton footer row — 3 pulsing cards shown while next page loads
function SkeletonFooter() {
  return (
    <div className="grid grid-cols-2 md:grid-cols-3 gap-4 px-4 pb-4">
      {[0, 1, 2].map((i) => (
        <div key={i} className="bg-white rounded-xl border border-gray-100 h-[180px] animate-pulse" />
      ))}
    </div>
  )
}

export function ExpertGrid({ experts, loading, isFetchingMore, onEndReached }: ExpertGridProps) {
  // Initial load: show skeleton grid (already built in Phase 16)
  if (loading && experts.length === 0) {
    return <SkeletonGrid />
  }

  // Zero results after load completes
  if (!loading && experts.length === 0) {
    return <EmptyState />
  }

  return (
    <VirtuosoGrid
      data={experts}
      endReached={onEndReached}
      overscan={200}
      // listClassName: CSS grid — 2 cols mobile (CONTEXT.md decision), 3 cols desktop
      // gap-4 = 16px (within 16-20px decision). Padding on container, NOT margin on items.
      listClassName="grid grid-cols-2 md:grid-cols-3 gap-4 p-4"
      // itemClassName: min-h-0 prevents grid row blowout on fixed card height
      itemClassName="min-h-0"
      computeItemKey={(_, expert) => expert.username}
      itemContent={(index, expert) => (
        <ExpertCard expert={expert} index={index} />
      )}
      components={{
        // Footer renders skeleton row while fetching next page (col-span-full on inner wrapper)
        Footer: () => isFetchingMore ? <SkeletonFooter /> : null,
      }}
      style={{ height: '100%' }}
    />
  )
}
```

Then update frontend/src/pages/MarketplacePage.tsx:

1. Import ExpertGrid.
2. Import isFetchingMore and loadNextPage from the useExplore hook (they were added in Plan 01).
3. Replace the Phase 16 placeholder div (the one that says something like "grid coming in Phase 17" or an empty results area) with:
   ```tsx
   <ExpertGrid
     experts={experts}
     loading={loading}
     isFetchingMore={isFetchingMore}
     onEndReached={loadNextPage}
   />
   ```
4. The main content area (the flex-1 div to the right of the sidebar) must have height:100% or flex-col with overflow so VirtuosoGrid can measure its height correctly. If the main content div uses overflow-y-auto or overflow-hidden, ensure ExpertGrid fills the full height of that container. VirtuosoGrid requires a container with a known height to virtualize — wrap in a div with style={{ height: '100%' }} if needed.

After editing, run npm run build from frontend/ and fix any TypeScript errors.

Important — read MarketplacePage.tsx carefully before editing. Preserve all existing layout (FilterSidebar, FilterChips, the flex structure). Only replace the placeholder div that holds results. The useExplore hook call at the top of MarketplacePage already provides experts, loading, total — now it also provides isFetchingMore and loadNextPage. Destructure them from the useExplore return value.
  </action>
  <verify>
    npm run build from frontend/ passes with no TypeScript errors.
    grep -n "VirtuosoGrid" frontend/src/components/marketplace/ExpertGrid.tsx returns a hit.
    grep -n "ExpertGrid" frontend/src/pages/MarketplacePage.tsx returns a hit (showing it is used in JSX).
    grep -n "endReached\|onEndReached" frontend/src/components/marketplace/ExpertGrid.tsx returns hits.
    grep -n "overscan" frontend/src/components/marketplace/ExpertGrid.tsx returns overscan={200}.
    grep -n "listClassName.*grid" frontend/src/components/marketplace/ExpertGrid.tsx confirms the CSS grid classes.
  </verify>
  <done>
    ExpertGrid wraps VirtuosoGrid with 2-column mobile / 3-column desktop grid layout using CSS grid on listClassName.
    ExpertGrid shows SkeletonGrid on initial load, EmptyState on zero results, VirtuosoGrid when data is present.
    VirtuosoGrid endReached is wired to onEndReached prop.
    SkeletonFooter renders while isFetchingMore is true.
    MarketplacePage renders ExpertGrid with correct props in place of the Phase 16 placeholder.
    npm run build passes with zero TypeScript errors.
  </done>
</task>

</tasks>

<verification>
Run from frontend/ directory: npm run build — must exit 0 with zero TypeScript errors.
Confirm all four files exist: ls frontend/src/components/marketplace/
Confirm ExpertCard has no exit prop: grep -rn "exit=" frontend/src/components/marketplace/ExpertCard.tsx — must return empty.
Confirm grid uses padding not margin on items: grep -n "itemClassName" frontend/src/components/marketplace/ExpertGrid.tsx — should show "min-h-0".
Confirm listClassName has CSS grid classes: grep -n "listClassName" frontend/src/components/marketplace/ExpertGrid.tsx returns grid classes.
Confirm toggleTag wiring: grep -rn "toggleTag" frontend/src/components/marketplace/ExpertCard.tsx returns hit.
</verification>

<success_criteria>
- ExpertCard: renders all 7 data fields (name, title, company, rate+currency, tag pills, findability badge, match reason), uses motion/react entry-only animation, tag pill click calls toggleTag
- EmptyState: shows when experts.length === 0 and not loading
- ExpertGrid: VirtuosoGrid with 2-col mobile / 3-col desktop CSS grid, endReached wired to onEndReached, skeleton footer while isFetchingMore, SkeletonGrid on initial load
- MarketplacePage: renders ExpertGrid in place of the Phase 16 placeholder
- npm run build passes with zero TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/17-expert-grid-cards/17-02-SUMMARY.md`
</output>
