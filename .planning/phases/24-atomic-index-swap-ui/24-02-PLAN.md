---
phase: 24-atomic-index-swap-ui
plan: 02
type: execute
wave: 2
depends_on:
  - 24-01
files_modified:
  - frontend/src/admin/pages/IndexPage.tsx
  - frontend/src/main.tsx
  - frontend/src/admin/components/AdminSidebar.tsx
autonomous: false
requirements:
  - IDX-01
  - IDX-04

must_haves:
  truths:
    - "Admin navigates to /admin/index and sees a page with a Rebuild Index button"
    - "The Rebuild Index button is disabled while status is running"
    - "The page shows a color-coded status badge: yellow/pulsing for running, green for done, red for error, slate for idle"
    - "Completed rebuilds show last_rebuild_at as a formatted timestamp and expert_count_at_rebuild as a number"
    - "Status persists across page refresh (polling fires on mount via useIngestStatus)"
    - "An Index nav link appears in the AdminSidebar pointing to /admin/index"
  artifacts:
    - path: "frontend/src/admin/pages/IndexPage.tsx"
      provides: "Full IndexPage component consuming useIngestStatus hook"
      min_lines: 60
    - path: "frontend/src/main.tsx"
      provides: "Route registration for /admin/index"
      contains: "path: 'index'"
    - path: "frontend/src/admin/components/AdminSidebar.tsx"
      provides: "Index nav item in NAV_ITEMS"
      contains: "/admin/index"
  key_links:
    - from: "frontend/src/admin/pages/IndexPage.tsx"
      to: "frontend/src/admin/hooks/useAdminData.ts (useIngestStatus)"
      via: "import and destructure ingest + triggerRun"
      pattern: "useIngestStatus"
    - from: "frontend/src/main.tsx"
      to: "frontend/src/admin/pages/IndexPage.tsx"
      via: "React Router route path index"
      pattern: "IndexPage"
    - from: "frontend/src/admin/components/AdminSidebar.tsx (NAV_ITEMS)"
      to: "/admin/index"
      via: "NavLink to /admin/index"
      pattern: "admin/index"
---

<objective>
Create the IndexPage admin UI that surfaces the existing useIngestStatus hook as a polished status card with rebuild trigger, wire it into the router, and add it to the sidebar.

Purpose: Fulfills IDX-01 (admin can trigger rebuild) and IDX-04 (rebuild status visible). The page consumes the already-complete useIngestStatus hook — this is assembly, not invention.

Output: IndexPage.tsx, route registration in main.tsx, nav item in AdminSidebar.tsx, human verification.
</objective>

<execution_context>
@/Users/sebastianhamers/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sebastianhamers/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/24-atomic-index-swap-ui/24-RESEARCH.md
@.planning/phases/24-atomic-index-swap-ui/24-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create IndexPage.tsx + register route in main.tsx + add sidebar nav item</name>
  <files>
    frontend/src/admin/pages/IndexPage.tsx,
    frontend/src/main.tsx,
    frontend/src/admin/components/AdminSidebar.tsx
  </files>
  <action>
    THREE FILES to create/modify. Implement all three in sequence.

    ---

    FILE 1: Create frontend/src/admin/pages/IndexPage.tsx (new file)

    This page consumes the existing useIngestStatus hook from useAdminData.ts. Key rules:
    - Call triggerRun('/ingest/run') on button click — NOT triggerRun('/experts/tag-all') (that is for tag-only runs, wrong endpoint)
    - Disable the button (HTML disabled attribute) when ingest.status === 'running'
    - Map all four statuses to color tokens: idle=slate-400/slate-700, running=yellow-400/yellow-500+animate-pulse, done=green-400/green-500, error=red-400/red-500
    - Display last_rebuild_at as a formatted date string using new Date(ts * 1000).toLocaleString() — show dash when null
    - Display expert_count_at_rebuild as a number — show dash when null
    - Do NOT render ingest.log anywhere — it contains thousands of subprocess lines (performance hazard)
    - Do NOT use a confirmation dialog before triggering (CONTEXT.md: no confirmation required)

    Structure:
    - STATUS_CONFIG lookup object mapping 'idle'|'running'|'done'|'error' to label + Tailwind classes
    - formatTs(ts: number | null) helper returning formatted string or em-dash
    - Default export IndexPage component
    - Rebuild Status card with: status badge (top right), two metadata rows (last rebuild, experts at rebuild), optional started_at row when not null, error box when status=error and error is set, Rebuild Index button + running message
    - About Index Rebuilds info card below with three bullet points explaining the process

    The RESEARCH.md file (referenced in context) contains a complete implementation example. Use it as the authoritative reference for the exact component shape.

    ---

    FILE 2: Modify frontend/src/main.tsx

    Add import after the existing IntelligenceDashboardPage import line:
      import IndexPage from './admin/pages/IndexPage.tsx'

    Add route inside the admin children array, after the intelligence route entry:
      { path: 'index', element: <IndexPage /> },

    ---

    FILE 3: Modify frontend/src/admin/components/AdminSidebar.tsx

    Add a new entry to NAV_ITEMS array, positioned after the intelligence entry (before search-lab):
      {
        to: '/admin/index',
        label: 'Index',
        end: false,
        icon: (
          <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
            <path strokeLinecap="round" strokeLinejoin="round"
              d="M4 7v10c0 2 1 3 3 3h10c2 0 3-1 3-3V7M9 3h6M12 3v4M8 11h8M8 15h5" />
          </svg>
        ),
      },

    Use the existing NAV_ITEMS entry shape as the template — every entry has: to, label, end, icon.
  </action>
  <verify>
    Run: `cd /Users/sebastianhamers/Documents/TCS/frontend && npx tsc --noEmit 2>&1 | head -20` — zero errors.
    Check: `ls /Users/sebastianhamers/Documents/TCS/frontend/src/admin/pages/IndexPage.tsx` — file exists.
    Grep: `grep "IndexPage" /Users/sebastianhamers/Documents/TCS/frontend/src/main.tsx` — import present.
    Grep: `grep "path.*index" /Users/sebastianhamers/Documents/TCS/frontend/src/main.tsx` — route registered.
    Grep: `grep "admin/index" /Users/sebastianhamers/Documents/TCS/frontend/src/admin/components/AdminSidebar.tsx` — nav item present.
  </verify>
  <done>
    IndexPage.tsx exists with STATUS_CONFIG map, formatTs helper, handleRebuild calling triggerRun with /ingest/run path, color-coded status badge, Rebuild Index button disabled when running, last_rebuild_at and expert_count_at_rebuild displayed. Route registered at /admin/index. Sidebar nav item Index present. TypeScript compiles without errors.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Visual verification of IndexPage at /admin/index</name>
  <action>Pause for human visual verification of the IndexPage UI in the browser. All automated work is complete — dev server should be started before verifying.</action>
  <verify>Human approval received via resume-signal after checking all items in how-to-verify.</verify>
  <done>Human types "approved" confirming the page renders correctly with correct status badge colors, disabled button behavior, and metadata display.</done>
  <what-built>
    IndexPage admin UI at /admin/index: status badge (idle/running/done/error with distinct colors), Rebuild Index button (disabled + gray when running, purple when idle/done/error), last rebuild timestamp, expert count at rebuild, error display on failure, and an About Index Rebuilds info card. Sidebar has Index nav link.
  </what-built>
  <how-to-verify>
    1. Start the dev server: cd /Users/sebastianhamers/Documents/TCS/frontend and run npm run dev
    2. Open http://localhost:5173/admin in the browser and log in with your admin key.
    3. Click Index in the sidebar — you should land on /admin/index.
    4. Verify the page shows: heading Index, description text, a Rebuild Status card with Idle badge (slate colored), two metadata rows (Last rebuild and Experts at rebuild) both showing em-dash, and a purple Rebuild Index button.
    5. Click Rebuild Index — no confirmation dialog should appear. The button should shift to Rebuilding... (disabled, slate colored) and the badge should turn yellow and pulse.
    6. Verify the message This typically takes 2-10 minutes. Live search is unaffected. appears below the button while running.
    7. Verify the About Index Rebuilds info card is present below the status card.
    8. Verify no log output (raw subprocess text) is displayed anywhere on the page.
    9. Navigate to another admin page and back to /admin/index — status should reload on mount.
  </how-to-verify>
  <resume-signal>Type "approved" when page looks correct, or describe any visual issues.</resume-signal>
</task>

</tasks>

<verification>
1. `ls /Users/sebastianhamers/Documents/TCS/frontend/src/admin/pages/IndexPage.tsx` — file exists
2. `grep "IndexPage" /Users/sebastianhamers/Documents/TCS/frontend/src/main.tsx` — import and route registered
3. `grep "admin/index" /Users/sebastianhamers/Documents/TCS/frontend/src/admin/components/AdminSidebar.tsx` — nav item present
4. `cd /Users/sebastianhamers/Documents/TCS/frontend && npx tsc --noEmit` — zero TypeScript errors
5. Human confirmation that page renders correctly at /admin/index
</verification>

<success_criteria>
- /admin/index route renders IndexPage without crash
- Status badge maps idle to slate, running to yellow+animate-pulse, done to green, error to red
- Rebuild Index button has HTML disabled attribute when status is running
- last_rebuild_at and expert_count_at_rebuild display as formatted string or number (em-dash when null)
- Sidebar Index nav link highlights when on /admin/index
- No subprocess log output rendered anywhere on the page
- TypeScript compiles clean
</success_criteria>

<output>
After completion, create `.planning/phases/24-atomic-index-swap-ui/24-02-SUMMARY.md`
</output>
