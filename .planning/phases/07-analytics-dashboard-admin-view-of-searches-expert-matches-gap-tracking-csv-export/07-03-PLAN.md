---
phase: 07-analytics-dashboard-admin-view-of-searches-expert-matches-gap-tracking-csv-export
plan: 03
type: execute
wave: 2
depends_on: ["07-02"]
files_modified:
  - frontend/src/admin/pages/OverviewPage.tsx
  - frontend/src/admin/pages/SearchesPage.tsx
  - frontend/src/admin/pages/GapsPage.tsx
  - frontend/src/admin/components/StatCard.tsx
  - frontend/src/admin/components/SearchesTable.tsx
  - frontend/src/admin/components/GapsTable.tsx
  - frontend/src/admin/components/ExportDialog.tsx
  - frontend/src/admin/components/ExpandedExpertRow.tsx
autonomous: true
requirements: [ANAL-01]

must_haves:
  truths:
    - "OverviewPage shows 4 stat cards: total searches, match count, match rate, gap count"
    - "SearchesPage renders a table with columns: query, timestamp, email, match count, top score, gap badge — with filter panel and pagination controls"
    - "Clicking a searches table row expands it inline to show the full expert match list with names"
    - "SearchesPage has an Export CSV button that opens a dialog asking filtered vs all data before downloading"
    - "GapsPage shows a table of gap queries ranked by frequency with best score, resolved status badge, and Mark Resolved button per row"
    - "GapsPage has its own Export CSV button that downloads gaps data"
    - "Pagination controls allow switching between 25 and 50 rows per page"
  artifacts:
    - path: "frontend/src/admin/pages/OverviewPage.tsx"
      provides: "Overview page with StatCard grid"
      min_lines: 30
    - path: "frontend/src/admin/pages/SearchesPage.tsx"
      provides: "Searches page with filter panel, SearchesTable, and ExportDialog"
      min_lines: 60
    - path: "frontend/src/admin/pages/GapsPage.tsx"
      provides: "Gaps page with GapsTable and ExportDialog"
      min_lines: 40
    - path: "frontend/src/admin/components/SearchesTable.tsx"
      provides: "TanStack Table with expandable rows, gap badges, pagination"
      min_lines: 100
    - path: "frontend/src/admin/components/GapsTable.tsx"
      provides: "Gaps table with frequency ranking, resolve action"
      min_lines: 60
    - path: "frontend/src/admin/components/ExportDialog.tsx"
      provides: "Dialog asking filtered vs all before CSV download"
      min_lines: 40
  key_links:
    - from: "frontend/src/admin/pages/SearchesPage.tsx"
      to: "frontend/src/admin/hooks/useAdminData.ts useAdminSearches"
      via: "import { useAdminSearches } from '../hooks/useAdminData'"
      pattern: "useAdminSearches"
    - from: "frontend/src/admin/pages/GapsPage.tsx"
      to: "frontend/src/admin/hooks/useAdminData.ts useAdminGaps"
      via: "import { useAdminGaps } from '../hooks/useAdminData'"
      pattern: "useAdminGaps"
    - from: "frontend/src/admin/components/SearchesTable.tsx"
      to: "@tanstack/react-table"
      via: "useReactTable with getCoreRowModel, getPaginationRowModel, getFilteredRowModel"
      pattern: "useReactTable"
    - from: "frontend/src/admin/pages/GapsPage.tsx"
      to: "/api/admin/gaps/{id}/resolve"
      via: "adminFetch POST call on Mark Resolved button click"
      pattern: "adminFetch"
---

<objective>
Build the three admin pages (Overview, Searches, Gaps) and their supporting components (StatCard, SearchesTable with TanStack Table, GapsTable, ExportDialog, ExpandedExpertRow). These pages replace the stub files created in Plan 02.

Purpose: Completes the visible admin dashboard UI. Plan 01 built the backend data; Plan 02 built the routing and data layer. This plan delivers everything the admin sees and interacts with.
Output: Full admin UI — stats overview, searchable/filterable/paginated searches table with expandable expert rows, gap frequency table with resolve action, and CSV export dialogs for both sections.
</objective>

<execution_context>
@/Users/sebastianhamers/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sebastianhamers/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/07-analytics-dashboard-admin-view-of-searches-expert-matches-gap-tracking-csv-export/07-RESEARCH.md
@.planning/phases/07-analytics-dashboard-admin-view-of-searches-expert-matches-gap-tracking-csv-export/07-02-SUMMARY.md
@frontend/src/admin/types.ts
@frontend/src/admin/hooks/useAdminData.ts
@frontend/src/admin/hooks/useAdminExport.ts
@frontend/src/admin/AdminApp.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build StatCard, ExportDialog, ExpandedExpertRow, and OverviewPage</name>
  <files>
    frontend/src/admin/components/StatCard.tsx
    frontend/src/admin/components/ExportDialog.tsx
    frontend/src/admin/components/ExpandedExpertRow.tsx
    frontend/src/admin/pages/OverviewPage.tsx
  </files>
  <action>
**frontend/src/admin/components/StatCard.tsx:**

A simple presentational card showing a metric label and value:

```typescript
interface StatCardProps {
  label: string
  value: string | number
  sub?: string   // Optional sub-label (e.g., "of 120 total")
  highlight?: boolean  // true → brand-purple accent border
}

export default function StatCard({ label, value, sub, highlight }: StatCardProps) {
  return (
    <div className={`bg-white rounded-lg border p-6 shadow-sm ${highlight ? 'border-brand-purple' : 'border-gray-200'}`}>
      <p className="text-sm font-medium text-gray-500">{label}</p>
      <p className="mt-2 text-3xl font-bold text-gray-900">{value}</p>
      {sub && <p className="mt-1 text-xs text-gray-400">{sub}</p>}
    </div>
  )
}
```

**frontend/src/admin/components/ExportDialog.tsx:**

A modal dialog that appears when user clicks Export CSV. Asks "Export filtered results or all data?" with two buttons. Calls onExport(filtered: boolean) on selection, then closes.

```typescript
interface ExportDialogProps {
  section: 'searches' | 'gaps'
  onExport: (filtered: boolean) => void
  onClose: () => void
  hasFilters: boolean   // If false, "filtered" option is greyed out / hidden
}

export default function ExportDialog({ section, onExport, onClose, hasFilters }: ExportDialogProps) {
  return (
    // Backdrop
    <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/40" onClick={onClose}>
      <div className="bg-white rounded-xl shadow-xl p-6 w-full max-w-sm" onClick={e => e.stopPropagation()}>
        <h2 className="text-lg font-semibold text-gray-900 mb-1">Export {section === 'searches' ? 'Searches' : 'Gaps'}</h2>
        <p className="text-sm text-gray-500 mb-5">Choose what to include in the CSV download.</p>

        <div className="space-y-3">
          {hasFilters && (
            <button
              onClick={() => { onExport(true); onClose() }}
              className="w-full text-left px-4 py-3 rounded-lg border border-brand-purple bg-brand-purple/5 hover:bg-brand-purple/10 transition-colors"
            >
              <p className="text-sm font-medium text-brand-purple">Filtered results only</p>
              <p className="text-xs text-gray-500 mt-0.5">Export rows matching current filters</p>
            </button>
          )}
          <button
            onClick={() => { onExport(false); onClose() }}
            className="w-full text-left px-4 py-3 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors"
          >
            <p className="text-sm font-medium text-gray-800">All data</p>
            <p className="text-xs text-gray-500 mt-0.5">Export complete {section} history</p>
          </button>
        </div>

        <button onClick={onClose} className="mt-4 w-full text-sm text-gray-400 hover:text-gray-600">Cancel</button>
      </div>
    </div>
  )
}
```

**frontend/src/admin/components/ExpandedExpertRow.tsx:**

Renders the expert list inline when a search row is expanded. Receives the `response_experts` JSON string parsed into an array. Shows name, title, company, hourly_rate, and profile_url as a clickable link if present. Handle JSON parse failure gracefully.

```typescript
interface Expert {
  name: string
  title: string
  company: string
  hourly_rate: string
  profile_url: string | null
  why_them?: string
}

interface ExpandedExpertRowProps {
  responseExperts: string  // Raw JSON string from DB column
  colSpan: number
}

export default function ExpandedExpertRow({ responseExperts, colSpan }: ExpandedExpertRowProps) {
  let experts: Expert[] = []
  try { experts = JSON.parse(responseExperts) } catch { experts = [] }

  if (experts.length === 0) {
    return (
      <tr>
        <td colSpan={colSpan} className="px-6 py-3 bg-gray-50 text-sm text-gray-400 italic">
          No expert matches for this query.
        </td>
      </tr>
    )
  }

  return (
    <tr>
      <td colSpan={colSpan} className="px-6 py-4 bg-gray-50">
        <div className="space-y-2">
          {experts.map((e, i) => (
            <div key={i} className="flex items-start justify-between text-sm">
              <div>
                <span className="font-medium text-gray-900">{e.name}</span>
                <span className="text-gray-500 mx-1">—</span>
                <span className="text-gray-600">{e.title} @ {e.company}</span>
                {e.why_them && <p className="text-xs text-gray-400 mt-0.5 italic">{e.why_them}</p>}
              </div>
              <div className="flex items-center gap-3 ml-4 flex-shrink-0">
                <span className="text-gray-500">{e.hourly_rate}</span>
                {e.profile_url && (
                  <a href={e.profile_url} target="_blank" rel="noopener noreferrer"
                    className="text-brand-purple hover:underline text-xs">Profile ↗</a>
                )}
              </div>
            </div>
          ))}
        </div>
      </td>
    </tr>
  )
}
```

**frontend/src/admin/pages/OverviewPage.tsx** (replaces stub):

```typescript
import StatCard from '../components/StatCard'
import { useAdminStats } from '../hooks/useAdminData'

export default function OverviewPage() {
  const { stats, loading, error } = useAdminStats()

  if (loading) return <div className="text-gray-400 text-sm">Loading stats...</div>
  if (error) return <div className="text-red-500 text-sm">Error: {error}</div>
  if (!stats) return null

  return (
    <div>
      <h1 className="text-2xl font-bold text-gray-900 mb-6">Overview</h1>
      <div className="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4">
        <StatCard label="Total Searches" value={stats.total_searches} />
        <StatCard label="Matches" value={stats.match_count} sub={`${(stats.match_rate * 100).toFixed(1)}% match rate`} highlight />
        <StatCard label="Match Rate" value={`${(stats.match_rate * 100).toFixed(1)}%`} />
        <StatCard label="Gaps" value={stats.gap_count} sub="queries needing improvement" />
      </div>
    </div>
  )
}
```
  </action>
  <verify>
`cd /Users/sebastianhamers/Documents/TCS/frontend && npx tsc --noEmit`
Expected: No errors from the new files.

`grep -l "StatCard\|ExportDialog\|ExpandedExpertRow" /Users/sebastianhamers/Documents/TCS/frontend/src/admin/components/`
Expected: All three component files listed.
  </verify>
  <done>StatCard, ExportDialog, ExpandedExpertRow components created. OverviewPage shows 4 stat cards using live useAdminStats hook. tsc clean.</done>
</task>

<task type="auto">
  <name>Task 2: Build SearchesTable, GapsTable, SearchesPage, and GapsPage</name>
  <files>
    frontend/src/admin/components/SearchesTable.tsx
    frontend/src/admin/components/GapsTable.tsx
    frontend/src/admin/pages/SearchesPage.tsx
    frontend/src/admin/pages/GapsPage.tsx
  </files>
  <action>
**frontend/src/admin/components/SearchesTable.tsx:**

Uses TanStack Table v8 for client-side pagination. Expandable rows managed via `useState<Set<number>>`.

```typescript
import { useState } from 'react'
import {
  useReactTable,
  getCoreRowModel,
  getPaginationRowModel,
  getFilteredRowModel,
  flexRender,
  type ColumnDef,
} from '@tanstack/react-table'
import type { SearchRow } from '../types'
import ExpandedExpertRow from './ExpandedExpertRow'

interface SearchesTableProps {
  data: SearchRow[]
  pageSize: number
  onPageSizeChange: (size: number) => void
}

export default function SearchesTable({ data, pageSize, onPageSizeChange }: SearchesTableProps) {
  const [expandedRows, setExpandedRows] = useState<Set<number>>(new Set())

  function toggleRow(id: number) {
    setExpandedRows(prev => {
      const next = new Set(prev)
      next.has(id) ? next.delete(id) : next.add(id)
      return next
    })
  }

  const columns: ColumnDef<SearchRow>[] = [
    {
      accessorKey: 'query',
      header: 'Query',
      cell: ({ getValue }) => (
        <span className="block max-w-xs truncate text-sm text-gray-900" title={getValue<string>()}>
          {getValue<string>()}
        </span>
      ),
    },
    {
      accessorKey: 'created_at',
      header: 'Timestamp',
      cell: ({ getValue }) => (
        <span className="text-xs text-gray-500 whitespace-nowrap">
          {new Date(getValue<string>()).toLocaleString()}
        </span>
      ),
    },
    {
      accessorKey: 'email',
      header: 'User',
      cell: ({ getValue }) => <span className="text-xs text-gray-600">{getValue<string>()}</span>,
    },
    {
      accessorKey: 'match_count',
      header: 'Matches',
      cell: ({ getValue }) => <span className="text-sm text-gray-700">{getValue<number>()}</span>,
    },
    {
      accessorKey: 'top_match_score',
      header: 'Top Score',
      cell: ({ getValue }) => {
        const v = getValue<number | null>()
        return <span className="text-sm text-gray-700">{v != null ? v.toFixed(3) : '—'}</span>
      },
    },
    {
      accessorKey: 'is_gap',
      header: 'Gap',
      cell: ({ getValue }) =>
        getValue<boolean>() ? (
          <span className="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-700">Gap</span>
        ) : null,
    },
  ]

  const table = useReactTable({
    data,
    columns,
    getCoreRowModel: getCoreRowModel(),
    getPaginationRowModel: getPaginationRowModel(),
    getFilteredRowModel: getFilteredRowModel(),
    initialState: { pagination: { pageSize } },
    autoResetPageIndex: true,
  })

  // Keep pageSize in sync when parent changes it
  if (table.getState().pagination.pageSize !== pageSize) {
    table.setPageSize(pageSize)
  }

  const allRows = table.getRowModel().rows
  const COLS = columns.length

  return (
    <div>
      <div className="overflow-x-auto rounded-lg border border-gray-200">
        <table className="min-w-full divide-y divide-gray-200">
          <thead className="bg-gray-50">
            {table.getHeaderGroups().map(hg => (
              <tr key={hg.id}>
                {hg.headers.map(h => (
                  <th key={h.id} className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    {flexRender(h.column.columnDef.header, h.getContext())}
                  </th>
                ))}
              </tr>
            ))}
          </thead>
          <tbody className="bg-white divide-y divide-gray-200">
            {allRows.length === 0 ? (
              <tr>
                <td colSpan={COLS} className="px-6 py-10 text-center text-sm text-gray-400">
                  No searches found.
                </td>
              </tr>
            ) : (
              allRows.map(row => {
                const original = row.original
                const isExpanded = expandedRows.has(original.id)
                return [
                  <tr
                    key={row.id}
                    onClick={() => toggleRow(original.id)}
                    className="hover:bg-gray-50 cursor-pointer transition-colors"
                  >
                    {row.getVisibleCells().map(cell => (
                      <td key={cell.id} className="px-6 py-3 whitespace-nowrap">
                        {flexRender(cell.column.columnDef.cell, cell.getContext())}
                      </td>
                    ))}
                  </tr>,
                  isExpanded && (
                    <ExpandedExpertRow
                      key={`exp-${row.id}`}
                      responseExperts={(original as SearchRow & { response_experts?: string }).response_experts ?? '[]'}
                      colSpan={COLS}
                    />
                  ),
                ]
              })
            )}
          </tbody>
        </table>
      </div>

      {/* Pagination controls */}
      <div className="mt-4 flex items-center justify-between text-sm text-gray-600">
        <div className="flex items-center gap-2">
          <span>Rows per page:</span>
          <select
            value={pageSize}
            onChange={e => onPageSizeChange(Number(e.target.value))}
            className="border border-gray-300 rounded px-2 py-1 text-sm"
          >
            <option value={25}>25</option>
            <option value={50}>50</option>
          </select>
        </div>
        <div className="flex items-center gap-2">
          <span>
            Page {table.getState().pagination.pageIndex + 1} of {table.getPageCount()}
          </span>
          <button
            onClick={() => table.previousPage()}
            disabled={!table.getCanPreviousPage()}
            className="px-3 py-1 rounded border border-gray-300 disabled:opacity-40 hover:bg-gray-100"
          >
            ←
          </button>
          <button
            onClick={() => table.nextPage()}
            disabled={!table.getCanNextPage()}
            className="px-3 py-1 rounded border border-gray-300 disabled:opacity-40 hover:bg-gray-100"
          >
            →
          </button>
        </div>
      </div>
    </div>
  )
}
```

Note: The `response_experts` field is not in the `SearchRow` type (it's the raw JSON string from DB). The backend `/api/admin/searches` endpoint must include it in the response for the expand feature to work. Update the backend endpoint in Plan 01 if it does not already return this field, OR the executor can choose to add it to the SearchRow type and backend response. Recommendation: Add `response_experts: string` to `SearchRow` in `frontend/src/admin/types.ts` and ensure the backend `/api/admin/searches` rows include it. This is a minor addition within scope.

**frontend/src/admin/components/GapsTable.tsx:**

```typescript
import type { GapRow } from '../types'
import { adminFetch } from '../hooks/useAdminData'

interface GapsTableProps {
  data: GapRow[]
  onResolved: () => void  // refetch callback after resolve action
}

export default function GapsTable({ data, onResolved }: GapsTableProps) {
  async function handleResolve(gap: GapRow) {
    try {
      await adminFetch(`/gaps/${encodeURIComponent(gap.query)}/resolve`, undefined)
      onResolved()
    } catch (e) {
      console.error('Resolve failed:', e)
    }
  }

  return (
    <div className="overflow-x-auto rounded-lg border border-gray-200">
      <table className="min-w-full divide-y divide-gray-200">
        <thead className="bg-gray-50">
          <tr>
            {['Query', 'Occurrences', 'Best Score', 'Status', ''].map(h => (
              <th key={h} className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                {h}
              </th>
            ))}
          </tr>
        </thead>
        <tbody className="bg-white divide-y divide-gray-200">
          {data.length === 0 ? (
            <tr>
              <td colSpan={5} className="px-6 py-10 text-center text-sm text-gray-400">
                No gaps detected.
              </td>
            </tr>
          ) : (
            data.map((gap, i) => (
              <tr key={i} className="hover:bg-gray-50">
                <td className="px-6 py-3 max-w-xs">
                  <span className="block truncate text-sm text-gray-900" title={gap.query}>{gap.query}</span>
                </td>
                <td className="px-6 py-3 text-sm text-gray-700">{gap.frequency}</td>
                <td className="px-6 py-3 text-sm text-gray-700">
                  {gap.best_score != null ? gap.best_score.toFixed(3) : '—'}
                </td>
                <td className="px-6 py-3">
                  {gap.resolved ? (
                    <span className="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-700">Resolved</span>
                  ) : (
                    <span className="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-700">Open</span>
                  )}
                </td>
                <td className="px-6 py-3 text-right">
                  {!gap.resolved && (
                    <button
                      onClick={() => handleResolve(gap)}
                      className="text-xs font-medium text-brand-purple hover:underline"
                    >
                      Mark Resolved
                    </button>
                  )}
                </td>
              </tr>
            ))
          )}
        </tbody>
      </table>
    </div>
  )
}
```

Note on adminFetch call for resolve: The `/gaps/{gap_query}/resolve` endpoint expects a POST with body. Update `adminFetch` in `useAdminData.ts` to support POST with body, OR call `fetch` directly in GapsTable. The simplest approach: call fetch directly in the component since this is the only POST call in the frontend:

```typescript
async function handleResolve(gap: GapRow) {
  const ADMIN_KEY = import.meta.env.VITE_ADMIN_KEY ?? ''
  const API_URL = import.meta.env.VITE_API_URL ?? 'http://localhost:8000'
  try {
    await fetch(`${API_URL}/api/admin/gaps/${encodeURIComponent(gap.query)}/resolve`, {
      method: 'POST',
      headers: { 'X-Admin-Key': ADMIN_KEY, 'Content-Type': 'application/json' },
      body: JSON.stringify({ resolved: true }),
    })
    onResolved()
  } catch (e) {
    console.error('Resolve failed:', e)
  }
}
```

**frontend/src/admin/pages/SearchesPage.tsx** (replaces stub):

```typescript
import { useState } from 'react'
import { useAdminSearches } from '../hooks/useAdminData'
import { useAdminExport } from '../hooks/useAdminExport'
import SearchesTable from '../components/SearchesTable'
import ExportDialog from '../components/ExportDialog'
import type { SearchFilters } from '../types'

export default function SearchesPage() {
  const [filters, setFilters] = useState<SearchFilters>({ page: 0, page_size: 25 })
  const [pageSize, setPageSize] = useState(25)
  const [showExport, setShowExport] = useState(false)
  const { data, loading, error } = useAdminSearches(filters)
  const { downloadCsv, exporting } = useAdminExport()

  // Filter panel state
  const [emailFilter, setEmailFilter] = useState('')
  const [gapFilter, setGapFilter] = useState<'' | 'true' | 'false'>('')
  const [dateFrom, setDateFrom] = useState('')
  const [dateTo, setDateTo] = useState('')

  function applyFilters() {
    setFilters({
      email: emailFilter || undefined,
      gap_flag: gapFilter !== '' ? gapFilter === 'true' : undefined,
      date_from: dateFrom || undefined,
      date_to: dateTo || undefined,
      page: 0,
      page_size: pageSize,
    })
  }

  function clearFilters() {
    setEmailFilter(''); setGapFilter(''); setDateFrom(''); setDateTo('')
    setFilters({ page: 0, page_size: pageSize })
  }

  const hasFilters = !!(emailFilter || gapFilter || dateFrom || dateTo)

  return (
    <div>
      <div className="flex items-center justify-between mb-6">
        <h1 className="text-2xl font-bold text-gray-900">Searches</h1>
        <button
          onClick={() => setShowExport(true)}
          disabled={exporting}
          className="px-4 py-2 text-sm font-medium text-white bg-brand-purple rounded-lg hover:bg-brand-purple/90 disabled:opacity-50"
        >
          {exporting ? 'Exporting…' : 'Export CSV'}
        </button>
      </div>

      {/* Filter panel */}
      <div className="bg-white rounded-lg border border-gray-200 p-4 mb-4">
        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3">
          <div>
            <label className="block text-xs font-medium text-gray-500 mb-1">User email</label>
            <input
              type="text"
              value={emailFilter}
              onChange={e => setEmailFilter(e.target.value)}
              placeholder="user@example.com"
              className="w-full border border-gray-300 rounded px-3 py-1.5 text-sm"
            />
          </div>
          <div>
            <label className="block text-xs font-medium text-gray-500 mb-1">Gap flag</label>
            <select
              value={gapFilter}
              onChange={e => setGapFilter(e.target.value as '' | 'true' | 'false')}
              className="w-full border border-gray-300 rounded px-3 py-1.5 text-sm"
            >
              <option value="">All</option>
              <option value="true">Gaps only</option>
              <option value="false">Non-gaps only</option>
            </select>
          </div>
          <div>
            <label className="block text-xs font-medium text-gray-500 mb-1">From date</label>
            <input
              type="date"
              value={dateFrom}
              onChange={e => setDateFrom(e.target.value)}
              className="w-full border border-gray-300 rounded px-3 py-1.5 text-sm"
            />
          </div>
          <div>
            <label className="block text-xs font-medium text-gray-500 mb-1">To date</label>
            <input
              type="date"
              value={dateTo}
              onChange={e => setDateTo(e.target.value)}
              className="w-full border border-gray-300 rounded px-3 py-1.5 text-sm"
            />
          </div>
        </div>
        <div className="mt-3 flex gap-2">
          <button onClick={applyFilters} className="px-3 py-1.5 text-sm font-medium text-white bg-gray-800 rounded hover:bg-gray-700">
            Apply Filters
          </button>
          {hasFilters && (
            <button onClick={clearFilters} className="px-3 py-1.5 text-sm font-medium text-gray-600 border border-gray-300 rounded hover:bg-gray-50">
              Clear
            </button>
          )}
        </div>
      </div>

      {loading && <div className="text-gray-400 text-sm">Loading searches…</div>}
      {error && <div className="text-red-500 text-sm">Error: {error}</div>}
      {data && (
        <SearchesTable
          data={data.rows}
          pageSize={pageSize}
          onPageSizeChange={size => { setPageSize(size); setFilters(f => ({ ...f, page_size: size })) }}
        />
      )}

      {showExport && (
        <ExportDialog
          section="searches"
          hasFilters={hasFilters}
          onExport={filtered => downloadCsv('searches', filtered, filters)}
          onClose={() => setShowExport(false)}
        />
      )}
    </div>
  )
}
```

**frontend/src/admin/pages/GapsPage.tsx** (replaces stub):

```typescript
import { useState } from 'react'
import { useAdminGaps } from '../hooks/useAdminData'
import { useAdminExport } from '../hooks/useAdminExport'
import GapsTable from '../components/GapsTable'
import ExportDialog from '../components/ExportDialog'

export default function GapsPage() {
  const { data, loading, error, refetch } = useAdminGaps()
  const [showExport, setShowExport] = useState(false)
  const { downloadCsv, exporting } = useAdminExport()

  return (
    <div>
      <div className="flex items-center justify-between mb-6">
        <div>
          <h1 className="text-2xl font-bold text-gray-900">Gaps</h1>
          <p className="text-sm text-gray-500 mt-1">Queries where the system couldn't find a confident match — ranked by frequency.</p>
        </div>
        <button
          onClick={() => setShowExport(true)}
          disabled={exporting}
          className="px-4 py-2 text-sm font-medium text-white bg-brand-purple rounded-lg hover:bg-brand-purple/90 disabled:opacity-50"
        >
          {exporting ? 'Exporting…' : 'Export CSV'}
        </button>
      </div>

      {loading && <div className="text-gray-400 text-sm">Loading gaps…</div>}
      {error && <div className="text-red-500 text-sm">Error: {error}</div>}
      {data && <GapsTable data={data.gaps} onResolved={refetch} />}

      {showExport && (
        <ExportDialog
          section="gaps"
          hasFilters={false}
          onExport={filtered => downloadCsv('gaps', filtered)}
          onClose={() => setShowExport(false)}
        />
      )}
    </div>
  )
}
```

Finally, update `frontend/src/admin/types.ts` to add `response_experts` to `SearchRow` (needed for ExpandedExpertRow):
```typescript
// Add to SearchRow interface:
response_experts: string  // Raw JSON string — parsed by ExpandedExpertRow component
```

And ensure the backend `/api/admin/searches` response includes `response_experts` in each row dict (if the Plan 01 executor did not include it, add it now — it is a field on the Conversation model, just add it to the row dict alongside the other fields).
  </action>
  <verify>
Run TypeScript check:
`cd /Users/sebastianhamers/Documents/TCS/frontend && npx tsc --noEmit`
Expected: No errors.

Run Vite build:
`cd /Users/sebastianhamers/Documents/TCS/frontend && npm run build`
Expected: Build succeeds.

Grep for TanStack import:
`grep "useReactTable" /Users/sebastianhamers/Documents/TCS/frontend/src/admin/components/SearchesTable.tsx`
Expected: Found.

Check all stub pages are replaced (no more `<div>Overview</div>` stub):
`grep -l "return <div>Overview</div>" /Users/sebastianhamers/Documents/TCS/frontend/src/admin/pages/`
Expected: No files found (stubs replaced).
  </verify>
  <done>All three pages fully implemented. SearchesTable uses TanStack Table with pagination controls (25/50 rows per page) and expandable rows showing expert details. GapsTable shows frequency-ranked gaps with Mark Resolved action. ExportDialog used by both pages. tsc and npm run build both pass.</done>
</task>

</tasks>

<verification>
- `cd /Users/sebastianhamers/Documents/TCS/frontend && npm run build` — succeeds
- `cd /Users/sebastianhamers/Documents/TCS/frontend && npx tsc --noEmit` — no errors
- `grep "useReactTable" /Users/sebastianhamers/Documents/TCS/frontend/src/admin/components/SearchesTable.tsx` — found
- `grep "ExportDialog" /Users/sebastianhamers/Documents/TCS/frontend/src/admin/pages/SearchesPage.tsx` — found
- `grep "ExportDialog" /Users/sebastianhamers/Documents/TCS/frontend/src/admin/pages/GapsPage.tsx` — found
- `grep "ExpandedExpertRow" /Users/sebastianhamers/Documents/TCS/frontend/src/admin/components/SearchesTable.tsx` — found
</verification>

<success_criteria>
- All admin pages are fully implemented (no stubs remaining)
- SearchesTable uses TanStack Table v8 with getCoreRowModel + getPaginationRowModel + getFilteredRowModel
- Expandable rows show parsed expert matches from response_experts JSON column
- ExportDialog appears on both Searches and GapsPage export buttons with filtered/all choice
- GapsTable shows frequency-ranked gaps, resolved status badge, and Mark Resolved action
- Pagination allows 25 and 50 rows per page on Searches table
- Full Vite build and TypeScript check pass with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/07-analytics-dashboard-admin-view-of-searches-expert-matches-gap-tracking-csv-export/07-03-SUMMARY.md`
</output>
