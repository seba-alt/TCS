---
phase: 21-documentation-cleanup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/phases/16-marketplace-page-sidebar/16-VERIFICATION.md
  - .planning/phases/19-extended-features/19-VERIFICATION.md
  - .planning/phases/17-expert-grid-cards/17-VERIFICATION.md
  - .planning/REQUIREMENTS.md
autonomous: true
requirements:
  - MARKET-05
  - LEAD-03

must_haves:
  truths:
    - "VERIFICATION.md exists for Phase 16 and accurately describes faceted sidebar, mobile sheet, and useExplore hook"
    - "VERIFICATION.md exists for Phase 19 and accurately describes email gate, URL sync, suggestions, and no-results state"
    - "Phase 17 VERIFICATION.md no longer mentions motion/react stagger animation; tags.slice count reads (0, 2)"
    - "MARKET-05 in REQUIREMENTS.md describes CSS hover animation (not Framer Motion mount); checkbox is [x]"
    - "LEAD-03 deferral in REQUIREMENTS.md is confirmed accurate and consistent across all three reference points"
  artifacts:
    - path: ".planning/phases/16-marketplace-page-sidebar/16-VERIFICATION.md"
      provides: "Retroactive phase verification record for Marketplace Page & Sidebar"
      contains: "phase: 16"
    - path: ".planning/phases/19-extended-features/19-VERIFICATION.md"
      provides: "Retroactive phase verification record for Extended Features"
      contains: "phase: 19"
    - path: ".planning/phases/17-expert-grid-cards/17-VERIFICATION.md"
      provides: "Corrected verification record (animation + slice count fixed)"
      contains: "CSS hover"
    - path: ".planning/REQUIREMENTS.md"
      provides: "Updated MARKET-05 requirement text + confirmed LEAD-03 deferral"
      contains: "[x] **MARKET-05**"
  key_links:
    - from: ".planning/REQUIREMENTS.md"
      to: ".planning/phases/17-expert-grid-cards/17-VERIFICATION.md"
      via: "MARKET-05 requirement description matches VERIFICATION.md animation section"
      pattern: "CSS hover|expert-card"
    - from: ".planning/REQUIREMENTS.md"
      to: "frontend/src/index.css"
      via: "MARKET-05 text describes the actual .expert-card:hover CSS"
      pattern: "expert-card:hover"
---

<objective>
Write retroactive VERIFICATION.md files for Phase 16 and Phase 19, correct Phase 17 VERIFICATION.md (stale animation description + tags.slice count), update MARKET-05 requirement text to match actual CSS hover implementation, and confirm LEAD-03 deferral accuracy.

Purpose: The v2.0 milestone audit cannot pass with missing VERIFICATION.md files and inaccurate requirement text. This plan closes all five documentation gaps identified in the audit.

Output: Three VERIFICATION.md files (Phase 16 created, Phase 19 created, Phase 17 corrected) + one updated REQUIREMENTS.md. All committed in a single docs commit.
</objective>

<execution_context>
@/Users/sebastianhamers/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sebastianhamers/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/21-documentation-cleanup/21-CONTEXT.md
@.planning/phases/21-documentation-cleanup/21-RESEARCH.md

# Phase SUMMARY evidence for retroactive VERIFICATION.md content
@.planning/phases/16-marketplace-page-sidebar/16-01-SUMMARY.md
@.planning/phases/16-marketplace-page-sidebar/16-02-SUMMARY.md
@.planning/phases/16-marketplace-page-sidebar/16-03-SUMMARY.md
@.planning/phases/19-extended-features/19-01-SUMMARY.md
@.planning/phases/19-extended-features/19-02-SUMMARY.md
@.planning/phases/19-extended-features/19-03-SUMMARY.md
@.planning/phases/19-extended-features/19-04-SUMMARY.md
@.planning/phases/19-extended-features/19-05-SUMMARY.md
@.planning/phases/19-extended-features/19-06-SUMMARY.md

# Existing VERIFICATION.md files — use Phase 17 format as the reference template
@.planning/phases/17-expert-grid-cards/17-VERIFICATION.md
@.planning/phases/18-floating-ai-co-pilot/18-VERIFICATION.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Write Phase 16 and Phase 19 VERIFICATION.md files</name>
  <files>
    .planning/phases/16-marketplace-page-sidebar/16-VERIFICATION.md
    .planning/phases/19-extended-features/19-VERIFICATION.md
  </files>
  <action>
    Before writing, spot-check the following source files to confirm facts (do not invent from memory):
    - `frontend/src/hooks/useExplore.ts` — confirm AbortController pattern, filter selectors, result writes
    - `frontend/src/components/sidebar/FilterSidebar.tsx` — confirm sticky/collapsible behavior, icon strip
    - `frontend/src/components/sidebar/MobileFilterSheet.tsx` — confirm vaul Drawer, snap points, h-full max-h-[97%]
    - `frontend/src/components/marketplace/FilterChips.tsx` — confirm chip strip with dismiss and clear-all
    - `frontend/src/hooks/useUrlSync.ts` — confirm bidirectional URL↔Zustand sync, replace:true
    - `frontend/src/components/marketplace/ProfileGateModal.tsx` — confirm AnimatePresence + EmailGate wrapper
    - `frontend/src/components/sidebar/SearchInput.tsx` — confirm suggestions dropdown, onMouseDown prevent, AbortController
    - `app/routers/suggest.py` — confirm _safe_prefix_query, /api/suggest endpoint, 8 results
    - `frontend/src/components/marketplace/EmptyState.tsx` — confirm 6 tag suggestions, Sage CTA, clear all

    Use Phase 17's VERIFICATION.md as the format template (YAML frontmatter, Phase Goal, Requirement Coverage table, Must-Haves Verification sections, Artifact Spot-Checks table, Build Status, Commits, Summary).

    For Phase 16 VERIFICATION.md:
    - frontmatter: phase: 16, status: passed, verified: 2026-02-21, verifier: automated
    - Phase Goal: "Users see a professional marketplace layout with a functional faceted sidebar that filters the expert pool"
    - Requirement Coverage table: MARKET-01 (✓) and MARKET-06 (✓)
    - Must-Haves Verification: one section per success criterion from ROADMAP Phase 16:
      1. Sidebar with rate slider, tag multi-select, text search, filter chips — verify FilterSidebar, SearchInput, RateSlider, TagMultiSelect, FilterChips present with described behavior
      2. Filter controls trigger debounced fetch — verify useExplore debounce + onValueCommit pattern
      3. Clear filters resets state — verify FilterChips clear-all path
      4. Mobile sidebar as bottom-sheet — verify MobileFilterSheet vaul Drawer, snap points, h-full max-h-[97%] fix
    - Artifact Spot-Checks table: useExplore.ts, FilterSidebar.tsx, MobileFilterSheet.tsx, FilterChips.tsx, RateSlider.tsx, SearchInput.tsx, TagMultiSelect.tsx, MarketplacePage.tsx
    - Build Status: npm run build exits 0
    - Commits from 16-01 SUMMARY (b117b2c), 16-02 SUMMARY (c74b51a), 16-03 SUMMARY (vaul fix)
    - Summary: All N success criteria verified. MARKET-01 and MARKET-06 satisfied.

    For Phase 19 VERIFICATION.md:
    - frontmatter: phase: 19, status: passed, verified: 2026-02-21, verifier: automated
    - Phase Goal: "Users can share filtered views, get fuzzy search help, and never hit a dead end"
    - Requirement Coverage table: LEAD-01 (✓), LEAD-02 (✓), LEAD-04 (✓), ROBUST-01 (✓), ROBUST-02 (✓), ROBUST-03 (✓); LEAD-03 (deferred — not implemented)
    - Must-Haves Verification: one section per success criterion from ROADMAP Phase 19:
      1. Free browsing without email gate — verify gate only fires on "View Full Profile"
      2. Email gate on "View Full Profile" + bypass for returning visitors — verify ProfileGateModal, useEmailGate, STORAGE_KEY='tcs_gate_email'
      3. (LEAD-03 in-app report: DEFERRED — not implemented in v2.0)
      4. URL reflects filters as query params — verify useUrlSync replace:true, bidirectional sync
      5. No-results shows suggestions — verify EmptyState 6 tag pills + Sage CTA + clear all
    - Artifact Spot-Checks table: suggest.py, useUrlSync.ts, ProfileGateModal.tsx, EmptyState.tsx, SearchInput.tsx, constants/tags.ts, FilterSidebar.tsx (Copy link)
    - Build Status: npm run build exits 0; /api/suggest returns 8 results
    - Commits: reference plan 19-01 through 19-06
    - Summary: All implemented success criteria verified. LEAD-03 explicitly deferred to v2.1.

    Every factual claim (component exists, key prop/pattern present) must be confirmed by reading the actual file before writing it into VERIFICATION.md.
  </action>
  <verify>
    - `ls .planning/phases/16-marketplace-page-sidebar/16-VERIFICATION.md` — file exists
    - `ls .planning/phases/19-extended-features/19-VERIFICATION.md` — file exists
    - `grep "status: passed" .planning/phases/16-marketplace-page-sidebar/16-VERIFICATION.md` — frontmatter correct
    - `grep "status: passed" .planning/phases/19-extended-features/19-VERIFICATION.md` — frontmatter correct
    - `grep "MARKET-01\|MARKET-06" .planning/phases/16-marketplace-page-sidebar/16-VERIFICATION.md` — requirements present
    - `grep "LEAD-03" .planning/phases/19-extended-features/19-VERIFICATION.md` — deferral noted
  </verify>
  <done>
    Two VERIFICATION.md files exist with status: passed, cover the correct requirement IDs for each phase, and all factual claims are confirmed against actual source files.
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix Phase 17 VERIFICATION.md and update MARKET-05 in REQUIREMENTS.md</name>
  <files>
    .planning/phases/17-expert-grid-cards/17-VERIFICATION.md
    .planning/REQUIREMENTS.md
  </files>
  <action>
    PART A — Fix Phase 17 VERIFICATION.md (two known errors):

    Before editing, read `frontend/src/components/marketplace/ExpertCard.tsx` to confirm:
    - tags.slice count (should be 0, 2 — not 0, 3)
    - No motion/react import present
    - No stagger delay or motion.div in the component

    Fix 1 — tags.slice count (line 33 in current file):
    Change: `tags.slice(0,3)` → `tags.slice(0, 2)`

    Fix 2 — Success Criteria 4: Entry animations, no exit animations (lines 41–45):
    Replace the four stale motion/react bullet points with accurate description:
    - Expert cards use CSS hover animation only (no mount animation): `.expert-card` class applies `transition: transform 0.2s ease-out, box-shadow 0.2s ease-out` on `:hover` (defined in `frontend/src/index.css`)
    - No `motion` import in `ExpertCard.tsx` — mount stagger animation was removed during Phase 17 development
    - `AnimatePresence` from `motion/react` is used in `MarketplacePage.tsx` for: Sage FAB show/hide, Sage panel slide-in, ProfileGateModal enter/exit
    - Status: PASS

    Fix 3 — Artifact Spot-Checks table: change "motion/react, no exit prop, toggleTag" to "CSS hover animation (.expert-card class), toggleTag" for the ExpertCard.tsx row.

    Also check the Requirement Coverage table — MARKET-05 row currently says "Cards animate into view on mount; no exit animations on virtualized items" — update this description to match what was actually shipped (CSS hover animation).

    PART B — Update MARKET-05 in REQUIREMENTS.md:

    Read REQUIREMENTS.md line 29 (MARKET-05 entry). Current text is substantially wrong (Framer Motion mount animation vs CSS hover). Rewrite to accurately describe what was shipped:

    Change from:
    `- [ ] **MARKET-05**: Cards animate on mount via Framer Motion; `AnimatePresence` used only on sidebar and modal transitions *(gap closure Phase 21: accepting CSS hover animation — requirement will be updated)*`

    Change to:
    `- [x] **MARKET-05**: Expert cards have a CSS hover animation (lift + purple glow via `.expert-card` class in `index.css`); `AnimatePresence` from `motion/react` is used for Sage FAB show/hide, Sage panel slide-in, and ProfileGateModal enter/exit transitions`

    Also update the traceability table (around line 88): change MARKET-05 row from `Phase 21 (gap closure) | Pending` to `Phase 21 (gap closure) | Complete`.

    Update the coverage count (around line 105): change `Pending (gap closure): 3 (MARKET-01, MARKET-02, MARKET-05)` to `Pending (gap closure): 0` and `Complete: 20` to `Complete: 23` (MARKET-01 and MARKET-02 were closed in Phase 20, MARKET-05 closes now).

    PART C — Confirm LEAD-03 deferral is accurate:

    Read REQUIREMENTS.md LEAD-03 entry (line ~42), the Deferred to v2.1+ section (lines ~53-55), and the traceability table (line ~95). Confirm all three reference points consistently say "deferred to v2.1" with the correct reason. If any inconsistency is found, make the minimal fix to align them. If already consistent (which research confirms), no change needed — document that fact in the task output.
  </action>
  <verify>
    - `grep "slice(0, 2)" .planning/phases/17-expert-grid-cards/17-VERIFICATION.md` — count corrected
    - `grep "CSS hover\|expert-card" .planning/phases/17-expert-grid-cards/17-VERIFICATION.md` — animation description updated
    - `grep "\[x\] \*\*MARKET-05\*\*" .planning/REQUIREMENTS.md` — checkbox now checked
    - `grep "CSS hover\|expert-card" .planning/REQUIREMENTS.md` — requirement text updated
    - `grep "MARKET-05.*Complete" .planning/REQUIREMENTS.md` — traceability updated
    - `grep "LEAD-03.*Deferred" .planning/REQUIREMENTS.md` — deferral consistent
  </verify>
  <done>
    Phase 17 VERIFICATION.md no longer contains stale motion/react animation claims; tags.slice reads (0, 2). MARKET-05 in REQUIREMENTS.md is checked [x] with accurate CSS hover animation description. LEAD-03 deferral is confirmed consistent across all three reference points in REQUIREMENTS.md.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
1. Four files written/updated: 16-VERIFICATION.md (new), 19-VERIFICATION.md (new), 17-VERIFICATION.md (corrected), REQUIREMENTS.md (MARKET-05 fixed)
2. `grep "status: passed" .planning/phases/16-marketplace-page-sidebar/16-VERIFICATION.md` — passes
3. `grep "status: passed" .planning/phases/19-extended-features/19-VERIFICATION.md` — passes
4. `grep "slice(0, 2)" .planning/phases/17-expert-grid-cards/17-VERIFICATION.md` — passes
5. `grep "\[x\] \*\*MARKET-05\*\*" .planning/REQUIREMENTS.md` — passes
6. Commit: one doc commit covering all four files
</verification>

<success_criteria>
- Phase 16 VERIFICATION.md exists with status: passed and covers MARKET-01 + MARKET-06
- Phase 19 VERIFICATION.md exists with status: passed and covers LEAD-01, LEAD-02, LEAD-04, ROBUST-01, ROBUST-02, ROBUST-03; notes LEAD-03 deferred
- Phase 17 VERIFICATION.md Success Criteria 4 describes CSS hover animation and contains no motion/react stagger references; tags.slice reads (0, 2) in Success Criteria 2
- MARKET-05 checkbox is [x] and description matches actual CSS hover + AnimatePresence usage
- LEAD-03 deferral is consistent across REQUIREMENTS.md (all three reference points agree)
- All documentation changes committed as one docs commit
</success_criteria>

<output>
After completion, create `.planning/phases/21-documentation-cleanup/21-01-SUMMARY.md`
</output>
