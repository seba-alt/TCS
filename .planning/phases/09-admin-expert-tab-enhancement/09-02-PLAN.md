---
phase: 09-admin-expert-tab-enhancement
plan: "02"
type: execute
wave: 2
depends_on:
  - "09-01"
files_modified:
  - frontend/src/admin/types.ts
  - frontend/src/admin/hooks/useAdminData.ts
autonomous: true
requirements:
  - ADMIN-04
  - ADMIN-05
  - SEARCH-07

must_haves:
  truths:
    - "ExpertRow TypeScript interface includes tags (string array) and findability_score (number or null)"
    - "useAdminDomainMap hook exists and can lazily fetch GET /api/admin/domain-map"
    - "DomainMapEntry and DomainMapResponse interfaces are exported from types.ts"
  artifacts:
    - path: "frontend/src/admin/types.ts"
      provides: "Updated ExpertRow interface, DomainMapEntry, DomainMapResponse interfaces"
      contains: "tags: string\\[\\]"
    - path: "frontend/src/admin/hooks/useAdminData.ts"
      provides: "useAdminDomainMap hook with lazy fetchData pattern"
      contains: "useAdminDomainMap"
  key_links:
    - from: "frontend/src/admin/types.ts ExpertRow"
      to: "app/routers/admin.py _serialize_expert()"
      via: "tags: string[] and findability_score: number | null matching API response shape"
      pattern: "tags.*string\\[\\]"
    - from: "frontend/src/admin/hooks/useAdminData.ts useAdminDomainMap"
      to: "/api/admin/domain-map"
      via: "adminFetch('/domain-map') called lazily via exposed fetchData()"
      pattern: "domain-map"
---

<objective>
Update the TypeScript type system and hook layer to match the enriched API responses from Plan 01. Add `tags` and `findability_score` to `ExpertRow`. Add `DomainMapEntry` and `DomainMapResponse` interfaces. Add a `useAdminDomainMap` hook with lazy fetch pattern.

Purpose: The ExpertsPage.tsx overhaul in Plan 03 can only be written type-safely if these types and hooks exist first. This plan is the minimal glue between the API (Plan 01) and the UI (Plan 03).
Output: Updated `frontend/src/admin/types.ts` and `frontend/src/admin/hooks/useAdminData.ts`.
</objective>

<execution_context>
@/Users/sebastianhamers/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sebastianhamers/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/phases/09-admin-expert-tab-enhancement/09-01-SUMMARY.md
@frontend/src/admin/types.ts
@frontend/src/admin/hooks/useAdminData.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update ExpertRow and add domain-map types</name>
  <files>frontend/src/admin/types.ts</files>
  <action>
    Two changes to frontend/src/admin/types.ts:

    CHANGE 1 — Add two new fields to the existing `ExpertRow` interface:
    ```typescript
    tags: string[]                   // NEW — parsed tag array from API, always present (empty array if untagged)
    findability_score: number | null // NEW — null if not yet computed by batch script
    ```

    The complete updated ExpertRow must be:
    ```typescript
    export interface ExpertRow {
      username: string
      first_name: string
      last_name: string
      job_title: string
      company: string
      bio: string
      hourly_rate: number
      profile_url: string
      category: string | null
      tags: string[]
      findability_score: number | null
    }
    ```

    Keep all existing fields exactly as-is — only add the two new fields at the bottom of the interface. Do NOT remove or rename existing fields (they may be used by other components like ExpandedExpertRow.tsx).

    CHANGE 2 — Add two new interfaces for the domain-map endpoint response:
    ```typescript
    export interface DomainMapEntry {
      domain: string
      count: number
    }

    export interface DomainMapResponse {
      domains: DomainMapEntry[]
    }
    ```

    Place these two interfaces after ExpertRow in the file. Export both with the `export` keyword.
  </action>
  <verify>
    Run TypeScript compilation check from the frontend directory:
    ```
    cd /Users/sebastianhamers/Documents/TCS/frontend && npx tsc --noEmit 2>&1 | head -30
    ```
    Expected: No type errors related to ExpertRow, DomainMapEntry, or DomainMapResponse. Existing components that use ExpertRow (ExpandedExpertRow.tsx, ExpertsPage.tsx) may show errors about the new required fields — this is expected and will be fixed in Plan 03.
  </verify>
  <done>
    ExpertRow interface has `tags: string[]` and `findability_score: number | null`. DomainMapEntry and DomainMapResponse are exported from types.ts. No syntax errors in the file.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add useAdminDomainMap hook</name>
  <files>frontend/src/admin/hooks/useAdminData.ts</files>
  <action>
    Add a new exported hook `useAdminDomainMap` to frontend/src/admin/hooks/useAdminData.ts.

    First, add the import at the top of useAdminData.ts (if DomainMapResponse is not already imported from types.ts):
    ```typescript
    import type { ..., DomainMapResponse } from '../types'
    ```
    Add `DomainMapResponse` to the existing types import — do NOT create a separate import statement.

    Then add the hook at the bottom of the file:

    ```typescript
    export function useAdminDomainMap() {
      const [data, setData] = useState<DomainMapResponse | null>(null)
      const [loading, setLoading] = useState(false)
      const [error, setError] = useState<string | null>(null)

      const fetchData = useCallback(() => {
        setLoading(true)
        adminFetch<DomainMapResponse>('/domain-map')
          .then(setData)
          .catch((e: Error) => setError(e.message))
          .finally(() => setLoading(false))
      }, [])

      return { data, loading, error, fetchData }
    }
    ```

    Key implementation notes:
    - `loading` starts as `false` — the domain-map section is lazy-loaded (not fetched on mount).
    - `fetchData` is exposed and called manually by ExpertsPage when the domain-map section is first opened.
    - Do NOT add a `useEffect` auto-fetch in this hook — the lazy pattern is intentional.
    - `useCallback` must be imported if not already in the file. Check existing imports — it is likely already imported since other hooks in the file use it.
    - `adminFetch` is the existing helper function in useAdminData.ts — use it directly, do NOT reimplement.
    - The `/domain-map` path is relative to the admin base URL that `adminFetch` already knows about.
  </action>
  <verify>
    Run TypeScript compilation check:
    ```
    cd /Users/sebastianhamers/Documents/TCS/frontend && npx tsc --noEmit 2>&1 | grep -i "useAdminDomainMap\|domain-map\|DomainMap" | head -20
    ```
    Expected: No errors mentioning useAdminDomainMap, DomainMapResponse, or DomainMapEntry.

    Also verify the hook is exported:
    ```
    grep -n "useAdminDomainMap" /Users/sebastianhamers/Documents/TCS/frontend/src/admin/hooks/useAdminData.ts
    ```
    Expected: At least two lines — the export function declaration and the return.
  </verify>
  <done>
    `useAdminDomainMap` is exported from useAdminData.ts, returns `{ data, loading, error, fetchData }`, starts with loading=false, and exposes a `fetchData()` function that fetches `/domain-map` via `adminFetch`. TypeScript compilation produces no errors related to the new hook.
  </done>
</task>

</tasks>

<verification>
```
cd /Users/sebastianhamers/Documents/TCS/frontend && npx tsc --noEmit 2>&1 | head -40
```
Expected: Compilation errors may exist in ExpertsPage.tsx (it references ExpertRow fields not yet aligned to the new shape) but NO errors in types.ts or useAdminData.ts themselves. The two new files must be clean.
</verification>

<success_criteria>
- `ExpertRow` has `tags: string[]` and `findability_score: number | null`
- `DomainMapEntry` and `DomainMapResponse` are exported from types.ts
- `useAdminDomainMap` hook is exported from useAdminData.ts with lazy-fetch pattern (no auto-useEffect)
- No syntax or type errors introduced in the two modified files themselves
</success_criteria>

<output>
After completion, create `.planning/phases/09-admin-expert-tab-enhancement/09-02-SUMMARY.md`
</output>
