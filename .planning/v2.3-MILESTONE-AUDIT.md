---
milestone: v2.3
milestone_name: Sage Evolution & Marketplace Intelligence
audited: 2026-02-22
status: tech_debt
scores:
  requirements: 13/13
  phases: 4/4
  integration: 4/4
  flows: 4/4
gaps: []
tech_debt:
  - phase: 30-behavior-tracking
    items:
      - "TRACK-02 data quality: clarifying-question responses (search_performed=false, total=null) emit zero_results:true sage_query events, polluting Phase 31 demand table with false positives. Fix: guard trackEvent in useSage.ts on data.search_performed being defined."
      - "TRACK-03 events collected but no Phase 31 aggregation consumer. Data available for future phase."
  - phase: 28-sage-search-engine
    items:
      - "Phase 28 SUMMARY.md files missing requirements-completed frontmatter field (SAGE-01–04 not listed). Tracking discrepancy only — requirements are verified in VERIFICATION.md."
  - phase: 29-sage-personality-fab-reactions
    items:
      - "Phase 29 SUMMARY.md files missing requirements-completed frontmatter field (SAGE-05, FAB-01 not listed). Tracking discrepancy only — requirements are verified in VERIFICATION.md."
  - phase: 30-behavior-tracking
    items:
      - "Phase 30 SUMMARY.md files have requirements-completed: [] (empty) instead of listing TRACK-01–03. Tracking discrepancy only — requirements verified in VERIFICATION.md and confirmed by integration checker."
---

# Milestone v2.3 Audit: Sage Evolution & Marketplace Intelligence

**Audited:** 2026-02-22
**Status:** tech_debt (no blockers — all 13 requirements satisfied)

## Scores

| Area | Score | Notes |
|------|-------|-------|
| Requirements | 13/13 | All v1 requirements satisfied |
| Phases | 4/4 | All phases verified (28–31) |
| Integration | 4/4 | All cross-phase wiring confirmed |
| E2E Flows | 4/4 | All user flows complete |

## Requirements Coverage

| Req ID | Description | Phase | VERIFICATION | REQUIREMENTS.md | Status |
|--------|-------------|-------|-------------|-----------------|--------|
| SAGE-01 | search_experts Gemini function calls /api/explore in-process | 28 | PASSED | [x] | ✓ satisfied |
| SAGE-02 | Sage search updates grid via filterSlice | 28 | PASSED | [x] | ✓ satisfied |
| SAGE-03 | Sage narrates after every function call | 28 | PASSED | [x] | ✓ satisfied |
| SAGE-04 | Zero-result acknowledgement with alternatives | 28 | PASSED | [x] | ✓ satisfied |
| SAGE-05 | Warmer/wittier prompt, max 1 clarifying question | 29 | PASSED | [x] | ✓ satisfied |
| FAB-01 | FAB animated boxShadow glow, no animation conflict | 29 | PASSED | [x] | ✓ satisfied |
| TRACK-01 | Expert card click events tracked (fire-and-forget) | 30 | PASSED | [x] | ✓ satisfied |
| TRACK-02 | Sage query events tracked | 30 | PASSED | [x] | ✓ satisfied (data quality note below) |
| TRACK-03 | Filter change events tracked | 30 | PASSED | [x] | ✓ satisfied |
| INTEL-01 | Marketplace: unmet demand table | 31 | PASSED | [x] | ✓ satisfied |
| INTEL-02 | Marketplace: expert exposure table | 31 | PASSED | [x] | ✓ satisfied |
| INTEL-03 | Marketplace: daily Sage trend BarChart | 31 | PASSED | [x] | ✓ satisfied |
| INTEL-04 | Marketplace: cold-start empty state | 31 | PASSED | [x] | ✓ satisfied |

## Phase Verifications

| Phase | Status | Score | Notes |
|-------|--------|-------|-------|
| 28 Sage Search Engine | passed | 4/4 SC | SC1-SC4 all passed |
| 29 Sage Personality + FAB Reactions | passed | 4/4 SC | SC1-SC4 all passed |
| 30 Behavior Tracking | passed | 8/8 must-haves | All artifacts verified |
| 31 Admin Marketplace Intelligence | human_needed→approved | 10/10 must-haves | Rate display bug found+fixed, human-verified |

## Integration Findings

### API Route Coverage

| Route | Caller | Status |
|-------|--------|--------|
| POST /api/pilot | useSage.ts | ✓ wired |
| POST /api/events | tracking.ts | ✓ wired |
| GET /api/admin/events/demand | useMarketplaceDemand | ✓ wired |
| GET /api/admin/events/exposure | useMarketplaceExposure | ✓ wired |
| GET /api/admin/events/trend | useMarketplaceTrend | ✓ wired |
| GET /api/admin/export/demand.csv | downloadMarketplaceCsv | ✓ wired |
| GET /api/admin/export/exposure.csv | downloadMarketplaceCsv | ✓ wired |

### E2E Flows

| Flow | Status | Path |
|------|--------|------|
| Sage discovery search → grid update | ✓ complete | useSage → /api/pilot → pilot_service → run_explore → filterSlice → useExplore → grid |
| FAB glow on activity | ✓ complete | isStreaming/filterKey → useEffect → setGlowType → motion.div boxShadow |
| FAB hide / Panel show | ✓ complete | isOpen store → AnimatePresence → FAB/Panel toggle |
| Phase 30 events → Phase 31 aggregation | ✓ complete | trackEvent → /api/events → user_events → json_extract queries |

### CORS Verification

All request types confirmed allowed:
- `POST /api/events` with `Content-Type: application/json` ✓
- `POST /api/pilot` with `Content-Type: application/json` ✓
- `GET /api/admin/*` with `X-Admin-Key` ✓

## Tech Debt

### Data Quality Issue (non-blocking)

**GAP-01 — TRACK-02: Clarifying questions emit misleading demand signals**

When Gemini returns a clarifying question (no function called), `useSage.ts` fires:
```typescript
void trackEvent('sage_query', {
  function_called: 'apply_filters',  // wrong — no function was called
  result_count: 0,
  zero_results: true,  // wrong — no search was attempted
})
```

The Phase 31 demand table surfaces `zero_results=1` sage_query events as unmet demand. Clarifying question exchanges pollute this table with false positives.

**Fix:** Guard `trackEvent` in `useSage.ts` to only fire when `data.search_performed !== undefined` (i.e., a function was actually called).

### Frontmatter Tracking Discrepancies (cosmetic)

- Phase 28 SUMMARY.md: `requirements-completed` field missing (SAGE-01–04 verified but not listed)
- Phase 29 SUMMARY.md: `requirements-completed` field missing (SAGE-05, FAB-01 verified but not listed)
- Phase 30 SUMMARY.md: `requirements-completed: []` instead of `[TRACK-01, TRACK-02, TRACK-03]`

These are cosmetic — VERIFICATION.md files confirm all requirements pass. REQUIREMENTS.md traceability table corrected as part of this audit.

### filter_change Events — No Phase 31 Consumer

TRACK-03 filter_change events are stored in `user_events` but Phase 31 aggregation endpoints only consume `sage_query` and `card_click`. Intentional per Phase 30-02 SUMMARY. Data available for future phase.

## Known UI Bugs (reported by user — to be investigated)

- Phases 28 and 29 features not working properly in production (user-reported — details pending)

---
*Audit run: 2026-02-22*
*Auditor: automated + integration-checker + human review*
